// fa2d85e
var a;if(!Array.prototype.map)Array.prototype.map=function(b,c){for(var d=this.length,f=new Array(d),g=0;g<d;g++)if(g in this)f[g]=b.call(c,this[g],g,this);return f};if(!Array.prototype.filter)Array.prototype.filter=function(b,c){for(var d=this.length,f=[],g=0;g<d;g++)if(g in this){var i=this[g];b.call(c,i,g,this)&&f.push(i)}return f};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,c){for(var d=this.length>>>0,f=0;f<d;f++)f in this&&b.call(c,this[f],f,this)};
if(!Array.prototype.reduce)Array.prototype.reduce=function(b,c){var d=this.length;if(!d&&arguments.length==1)throw new Error("reduce: empty array, no initial value");var f=0;if(arguments.length<2)for(;;){if(f in this){c=this[f++];break}if(++f>=d)throw new Error("reduce: no values, no initial value");}for(;f<d;f++)if(f in this)c=b(c,this[f],f,this);return c};var pv={};pv.version={major:3,minor:2};pv.identity=function(b){return b};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};
pv.parent=function(){return this.parent.index};pv.extend=function(b){function c(){}c.prototype=b.prototype||b;return new c};
try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(b){for(var c=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),d,f,g=0,i="";d=c.exec(b);){d=d.index+d[0].length;if(b.charAt(d)!="{"){i+=b.substring(g,d)+"{return ";g=d;for(var j=0;j>=0&&d<b.length;d++){var k=b.charAt(d);switch(k){case '"':case "'":for(;++d<b.length&&(f=b.charAt(d))!=k;)f=="\\"&&d++;break;case "[":case "(":j++;break;case "]":case ")":j--;break;case ";":case ",":j==0&&j--;break}}i+=pv.parse(b.substring(g,--d))+
";}";g=d}c.lastIndex=d}i+=b.substring(g);return i}}pv.css=function(b,c){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(c):b.currentStyle[c]};pv.error=function(b){typeof console=="undefined"?alert(b):console.error(b)};pv.listen=function(b,c,d){d=pv.listener(d);return b.addEventListener?b.addEventListener(c,d,false):b.attachEvent("on"+c,d)};pv.listener=function(b){return b.$listener||(b.$listener=function(c){try{pv.event=c;return b.call(this,c)}finally{delete pv.event}})};
pv.ancestor=function(b,c){for(;c;){if(c==b)return true;c=c.parentNode}return false};pv.id=function(){var b=1;return function(){return b++}}();pv.functor=function(b){return typeof b=="function"?b:function(){return b}};pv.Format={};pv.Format.re=function(b){return b.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(b,c,d){c=c-String(d).length;return c<1?d:(new Array(c+1)).join(b)+d};
pv.Format.date=function(b){function c(f){return b.replace(/%[a-zA-Z0-9]/g,function(g){switch(g){case "%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][f.getDay()];case "%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][f.getDay()];case "%h":case "%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][f.getMonth()];case "%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][f.getMonth()];
case "%c":return f.toLocaleString();case "%C":return d("0",2,Math.floor(f.getFullYear()/100)%100);case "%d":return d("0",2,f.getDate());case "%x":case "%D":return d("0",2,f.getMonth()+1)+"/"+d("0",2,f.getDate())+"/"+d("0",2,f.getFullYear()%100);case "%e":return d(" ",2,f.getDate());case "%H":return d("0",2,f.getHours());case "%I":return(g=f.getHours()%12)?d("0",2,g):12;case "%m":return d("0",2,f.getMonth()+1);case "%M":return d("0",2,f.getMinutes());case "%n":return"\n";case "%p":return f.getHours()<
12?"AM":"PM";case "%T":case "%X":case "%r":g=f.getHours()%12;return(g?d("0",2,g):12)+":"+d("0",2,f.getMinutes())+":"+d("0",2,f.getSeconds())+" "+(f.getHours()<12?"AM":"PM");case "%R":return d("0",2,f.getHours())+":"+d("0",2,f.getMinutes());case "%S":return d("0",2,f.getSeconds());case "%Q":return d("0",3,f.getMilliseconds());case "%t":return"\t";case "%u":return(g=f.getDay())?g:1;case "%w":return f.getDay();case "%y":return d("0",2,f.getFullYear()%100);case "%Y":return f.getFullYear();case "%%":return"%"}return g})}
var d=pv.Format.pad;c.parse=function(f){var g=1970,i=0,j=1,k=0,p=0,l=0,n=[function(){}],q=pv.Format.re(b).replace(/%[a-zA-Z0-9]/g,function(m){switch(m){case "%b":n.push(function(o){i={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[o]});return"([A-Za-z]+)";case "%h":case "%B":n.push(function(o){i={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[o]});return"([A-Za-z]+)";case "%e":case "%d":n.push(function(o){j=
o});return"([0-9]+)";case "%I":case "%H":n.push(function(o){k=o});return"([0-9]+)";case "%m":n.push(function(o){i=o-1});return"([0-9]+)";case "%M":n.push(function(o){p=o});return"([0-9]+)";case "%p":n.push(function(o){if(k==12){if(o=="am")k=0}else if(o=="pm")k=Number(k)+12});return"(am|pm)";case "%S":n.push(function(o){l=o});return"([0-9]+)";case "%y":n.push(function(o){o=Number(o);g=o+(0<=o&&o<69?2E3:o>=69&&o<100?1900:0)});return"([0-9]+)";case "%Y":n.push(function(o){g=o});return"([0-9]+)";case "%%":n.push(function(){});
return"%"}return m});(f=f.match(q))&&f.forEach(function(m,o){n[o](m)});return new Date(g,i,j,k,p,l)};return c};
pv.Format.time=function(b){function c(f){f=Number(f);switch(b){case "short":if(f>=31536E6)return(f/31536E6).toFixed(1)+" years";else if(f>=6048E5)return(f/6048E5).toFixed(1)+" weeks";else if(f>=864E5)return(f/864E5).toFixed(1)+" days";else if(f>=36E5)return(f/36E5).toFixed(1)+" hours";else if(f>=6E4)return(f/6E4).toFixed(1)+" minutes";return(f/1E3).toFixed(1)+" seconds";case "long":var g=[],i=f%36E5/6E4>>0;g.push(d("0",2,f%6E4/1E3>>0));if(f>=36E5){var j=f%864E5/36E5>>0;g.push(d("0",2,i));if(f>=864E5){g.push(d("0",
2,j));g.push(Math.floor(f/864E5).toFixed())}else g.push(j.toFixed())}else g.push(i.toFixed());return g.reverse().join(":")}}var d=pv.Format.pad;c.parse=function(f){switch(b){case "short":for(var g=/([0-9,.]+)\s*([a-z]+)/g,i,j=0;i=g.exec(f);){var k=parseFloat(i[0].replace(",","")),p=0;switch(i[2].toLowerCase()){case "year":case "years":p=31536E6;break;case "week":case "weeks":p=6048E5;break;case "day":case "days":p=864E5;break;case "hour":case "hours":p=36E5;break;case "minute":case "minutes":p=6E4;
break;case "second":case "seconds":p=1E3;break}j+=k*p}return j;case "long":i=f.replace(",","").split(":").reverse();j=0;if(i.length)j+=parseFloat(i[0])*1E3;if(i.length>1)j+=parseFloat(i[1])*6E4;if(i.length>2)j+=parseFloat(i[2])*36E5;if(i.length>3)j+=parseFloat(i[3])*864E5;return j}};return c};
pv.Format.number=function(){function b(m){if(Infinity>i)m=Math.round(m*j)/j;var o=String(Math.abs(m)).split("."),s=o[0];m=m<0?"-":"";if(s.length>d)s=s.substring(s.length-d);if(l&&s.length<c)s=m+(new Array(c-s.length+1)).join(k)+s;if(s.length>3)s=s.replace(/\B(?=(?:\d{3})+(?!\d))/g,q);if(!l&&s.length<f)s=(new Array(f-s.length+1)).join(k)+m+s;o[0]=s;s=o[1]||"";if(s.length<g)o[1]=s+(new Array(g-s.length+1)).join(p);return o.join(n)}var c=0,d=Infinity,f=0,g=0,i=0,j=1,k="0",p="0",l=true,n=".",q=",";b.parse=
function(m){var o=pv.Format.re;m=String(m).replace(new RegExp("^("+o(k)+")*"),"").replace(new RegExp("("+o(p)+")*$"),"").split(n);o=m[0].replace(new RegExp(o(q),"g"),"");if(o.length>d)o=o.substring(o.length-d);m=m[1]?Number("0."+m[1]):0;if(Infinity>i)m=Math.round(m*j)/j;return Math.round(o)+m};b.integerDigits=function(m,o){if(arguments.length){c=Number(m);d=arguments.length>1?Number(o):c;f=c+Math.floor(c/3)*q.length;return this}return[c,d]};b.fractionDigits=function(m,o){if(arguments.length){g=Number(m);
i=arguments.length>1?Number(o):g;j=Math.pow(10,i);return this}return[g,i]};b.integerPad=function(m){if(arguments.length){k=String(m);l=/\d/.test(k);return this}return k};b.fractionPad=function(m){if(arguments.length){p=String(m);return this}return p};b.decimal=function(m){if(arguments.length){n=String(m);return this}return n};b.group=function(m){if(arguments.length){q=m?String(m):"";f=c+Math.floor(c/3)*q.length;return this}return q};return b};pv.Format.csv=function(){return new pv.CsvFormat};
pv.CsvFormat=function(){};pv.CsvFormat.prototype.header=function(b){if(arguments.length){this.$header=b;return this}return this.$header};
pv.CsvFormat.prototype.parse=function(b){function c(){if(i.lastIndex==b.length)return f;if(k){k=false;return d}var q=i.lastIndex;if(b.charAt(q)=='"'){var m=q;a:for(;m++<b.length;)switch(b.charAt(m)){case '"':if(b.charAt(m+1)=='"'){m++;break}break a}if(b.charAt(m+1)=="\n")k=true;i.lastIndex=m+2;return b.substring(q+1,m).replace(/""/g,'"')}if(m=i.exec(b)){if(m[0]=="\n")k=true;return b.substring(q,m.index)}i.lastIndex=b.length;return b.substring(q)}var d={},f={},g=[],i=/[,\n]/g,j,k;if(this.$header){for(var p=
[];(j=c())!==d&&j!==f;)p.push(j);for(;(j=c())!==f;){var l={},n=0;for(g.push(l);j!==d&&j!==f;){l[p[n++]]=j;j=c()}}}else for(;(j=c())!==f;){p=[];for(g.push(p);j!==d&&j!==f;){p.push(j);j=c()}}return g};
pv.CsvFormat.prototype.format=function(b){if(!b.length)return"";var c=[];if(this.$header){var d=pv.keys(b[0]);c.push(d.map(pv.CsvFormat.quote).join(","));for(var f=0;f<b.length;f++)c.push(d.map(function(g){return pv.CsvFormat.quote(b[f][g])}).join(","))}else for(f=0;f<b.length;f++)c.push(b[f].map(pv.CsvFormat.quote).join(","));return c.join("\n")};pv.CsvFormat.quote=function(b){return/[",\n]/.test(b)?'"'+b.replace(/\"/g,'""')+'"':b};
pv.map=function(b,c){var d={};return c?b.map(function(f,g){d.index=g;return c.call(d,f)}):b.slice()};pv.repeat=function(b,c){if(arguments.length==1)c=2;return pv.blend(pv.range(c).map(function(){return b}))};pv.cross=function(b,c){for(var d=[],f=0,g=b.length,i=c.length;f<g;f++)for(var j=0,k=b[f];j<i;j++)d.push([k,c[j]]);return d};pv.blend=function(b){return Array.prototype.concat.apply([],b)};
pv.transpose=function(b){var c=b.length,d=pv.max(b,function(j){return j.length});if(d>c){b.length=d;for(var f=c;f<d;f++)b[f]=new Array(c);for(f=0;f<c;f++)for(var g=f+1;g<d;g++){var i=b[f][g];b[f][g]=b[g][f];b[g][f]=i}}else{for(f=0;f<d;f++)b[f].length=c;for(f=0;f<c;f++)for(g=0;g<f;g++){i=b[f][g];b[f][g]=b[g][f];b[g][f]=i}}b.length=d;for(f=0;f<d;f++)b[f].length=c;return b};pv.normalize=function(b,c){b=pv.map(b,c);c=pv.sum(b);for(var d=0;d<b.length;d++)b[d]/=c;return b};
pv.permute=function(b,c,d){if(!d)d=pv.identity;var f=new Array(c.length),g={};c.forEach(function(i,j){g.index=i;f[j]=d.call(g,b[i])});return f};pv.numerate=function(b,c){if(!c)c=pv.identity;var d={},f={};b.forEach(function(g,i){f.index=i;d[c.call(f,g)]=i});return d};pv.naturalOrder=function(b,c){return b<c?-1:b>c?1:0};pv.reverseOrder=function(b,c){return c<b?-1:c>b?1:0};
pv.search=function(b,c,d){if(!d)d=pv.identity;for(var f=0,g=b.length-1;f<=g;){var i=f+g>>1,j=d(b[i]);if(j<c)f=i+1;else if(j>c)g=i-1;else return i}return-f-1};pv.search.index=function(b,c,d){b=pv.search(b,c,d);return b<0?-b-1:b};pv.range=function(b,c,d){if(arguments.length==1){c=b;b=0}if(d==undefined)d=1;if((c-b)/d==Infinity)throw new Error("range must be finite");var f=[],g=0,i;if(d<0)for(;(i=b+d*g++)>c;)f.push(i);else for(;(i=b+d*g++)<c;)f.push(i);return f};
pv.random=function(b,c,d){if(arguments.length==1){c=b;b=0}if(d==undefined)d=1;return d?Math.floor(Math.random()*(c-b)/d)*d+b:Math.random()*(c-b)+b};pv.sum=function(b,c){var d={};return b.reduce(c?function(f,g,i){d.index=i;return f+c.call(d,g)}:function(f,g){return f+g},0)};pv.max=function(b,c){if(c==pv.index)return b.length-1;return Math.max.apply(null,c?pv.map(b,c):b)};
pv.max.index=function(b,c){if(!b.length)return-1;if(c==pv.index)return b.length-1;if(!c)c=pv.identity;for(var d=0,f=-Infinity,g={},i=0;i<b.length;i++){g.index=i;var j=c.call(g,b[i]);if(j>f){f=j;d=i}}return d};pv.min=function(b,c){if(c==pv.index)return 0;return Math.min.apply(null,c?pv.map(b,c):b)};pv.min.index=function(b,c){if(!b.length)return-1;if(c==pv.index)return 0;if(!c)c=pv.identity;for(var d=0,f=Infinity,g={},i=0;i<b.length;i++){g.index=i;var j=c.call(g,b[i]);if(j<f){f=j;d=i}}return d};
pv.mean=function(b,c){return pv.sum(b,c)/b.length};pv.median=function(b,c){if(c==pv.index)return(b.length-1)/2;b=pv.map(b,c).sort(pv.naturalOrder);if(b.length%2)return b[Math.floor(b.length/2)];c=b.length/2;return(b[c-1]+b[c])/2};pv.variance=function(b,c){if(b.length<1)return NaN;if(b.length==1)return 0;var d=pv.mean(b,c),f=0,g={};if(!c)c=pv.identity;for(var i=0;i<b.length;i++){g.index=i;var j=c.call(g,b[i])-d;f+=j*j}return f};
pv.deviation=function(b,c){return Math.sqrt(pv.variance(b,c)/(b.length-1))};pv.log=function(b,c){return Math.log(b)/Math.log(c)};pv.logSymmetric=function(b,c){return b==0?0:b<0?-pv.log(-b,c):pv.log(b,c)};pv.logAdjusted=function(b,c){if(!isFinite(b))return b;var d=b<0;if(b<c)b+=(c-b)/c;return d?-pv.log(b,c):pv.log(b,c)};pv.logFloor=function(b,c){return b>0?Math.pow(c,Math.floor(pv.log(b,c))):-Math.pow(c,-Math.floor(-pv.log(-b,c)))};
pv.logCeil=function(b,c){return b>0?Math.pow(c,Math.ceil(pv.log(b,c))):-Math.pow(c,-Math.ceil(-pv.log(-b,c)))};(function(){var b=Math.PI/180,c=180/Math.PI;pv.radians=function(d){return b*d};pv.degrees=function(d){return c*d}})();pv.keys=function(b){var c=[];for(var d in b)c.push(d);return c};pv.entries=function(b){var c=[];for(var d in b)c.push({key:d,value:b[d]});return c};pv.values=function(b){var c=[];for(var d in b)c.push(b[d]);return c};
pv.dict=function(b,c){for(var d={},f={},g=0;g<b.length;g++)if(g in b){var i=b[g];f.index=g;d[i]=c.call(f,i)}return d};pv.dom=function(b){return new pv.Dom(b)};pv.Dom=function(b){this.$map=b};pv.Dom.prototype.$leaf=function(b){return typeof b!="object"};pv.Dom.prototype.leaf=function(b){if(arguments.length){this.$leaf=b;return this}return this.$leaf};
pv.Dom.prototype.root=function(b){function c(g){var i=new pv.Dom.Node;for(var j in g){var k=g[j];i.appendChild(d(k)?new pv.Dom.Node(k):c(k)).nodeName=j}return i}var d=this.$leaf,f=c(this.$map);f.nodeName=b;return f};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(b){this.nodeValue=b;this.childNodes=[]};a=pv.Dom.Node.prototype;a.parentNode=null;a.firstChild=null;a.lastChild=null;a.previousSibling=null;a.nextSibling=null;
a.removeChild=function(b){var c=this.childNodes.indexOf(b);if(c==-1)throw new Error("child not found");this.childNodes.splice(c,1);if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};
a.appendChild=function(b){b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;if(b.previousSibling=this.lastChild)this.lastChild.nextSibling=b;else this.firstChild=b;this.lastChild=b;this.childNodes.push(b);return b};
a.insertBefore=function(b,c){if(!c)return this.appendChild(b);var d=this.childNodes.indexOf(c);if(d==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=c;if(b.previousSibling=c.previousSibling)c.previousSibling.nextSibling=b;else{if(c==this.lastChild)this.lastChild=b;this.firstChild=b}this.childNodes.splice(d,0,b);return b};
a.replaceChild=function(b,c){var d=this.childNodes.indexOf(c);if(d==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=c.nextSibling;if(b.previousSibling=c.previousSibling)c.previousSibling.nextSibling=b;else this.firstChild=b;if(c.nextSibling)c.nextSibling.previousSibling=b;else this.lastChild=b;this.childNodes[d]=b;return c};a.visitBefore=function(b){function c(d,f){b(d,f);for(d=d.firstChild;d;d=d.nextSibling)c(d,f+1)}c(this,0)};
a.visitAfter=function(b){function c(d,f){for(var g=d.firstChild;g;g=g.nextSibling)c(g,f+1);b(d,f)}c(this,0)};a.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var c=this.firstChild=this.childNodes[0],d;delete c.previousSibling;for(var f=1;f<this.childNodes.length;f++){c.sort(b);d=this.childNodes[f];d.previousSibling=c;c=c.nextSibling=d}this.lastChild=c;delete c.nextSibling;c.sort(b)}return this};
a.reverse=function(){var b=[];this.visitAfter(function(c){for(;c.lastChild;)b.push(c.removeChild(c.lastChild));for(var d;d=b.pop();)c.insertBefore(d,c.firstChild)});return this};a.nodes=function(){function b(d){c.push(d);d.childNodes.forEach(b)}var c=[];b(this,c);return c};
a.toggle=function(b){if(b)return this.toggled?this.visitBefore(function(d){d.toggled&&d.toggle()}):this.visitAfter(function(d){d.toggled||d.toggle()});b=this;if(b.toggled){for(var c;c=b.toggled.pop();)b.appendChild(c);delete b.toggled}else if(b.lastChild)for(b.toggled=[];b.lastChild;)b.toggled.push(b.removeChild(b.lastChild))};pv.nodes=function(b){for(var c=new pv.Dom.Node,d=0;d<b.length;d++)c.appendChild(new pv.Dom.Node(b[d]));return c.nodes()};pv.tree=function(b){return new pv.Tree(b)};
pv.Tree=function(b){this.array=b};pv.Tree.prototype.keys=function(b){this.k=b;return this};pv.Tree.prototype.value=function(b){this.v=b;return this};pv.Tree.prototype.map=function(){for(var b={},c={},d=0;d<this.array.length;d++){c.index=d;for(var f=this.array[d],g=this.k.call(c,f),i=b,j=0;j<g.length-1;j++)i=i[g[j]]||(i[g[j]]={});i[g[j]]=this.v?this.v.call(c,f):f}return b};pv.nest=function(b){return new pv.Nest(b)};pv.Nest=function(b){this.array=b;this.keys=[]};a=pv.Nest.prototype;
a.key=function(b){this.keys.push(b);return this};a.sortKeys=function(b){this.keys[this.keys.length-1].order=b||pv.naturalOrder;return this};a.sortValues=function(b){this.order=b||pv.naturalOrder;return this};a.map=function(){for(var b={},c=[],d,f=0;f<this.array.length;f++){var g=this.array[f],i=b;for(d=0;d<this.keys.length-1;d++){var j=this.keys[d](g);i[j]||(i[j]={});i=i[j]}j=this.keys[d](g);if(!i[j]){d=[];c.push(d);i[j]=d}i[j].push(g)}if(this.order)for(d=0;d<c.length;d++)c[d].sort(this.order);return b};
a.entries=function(){function b(d){var f=[];for(var g in d){var i=d[g];f.push({key:g,values:i instanceof Array?i:b(i)})}return f}function c(d,f){var g=this.keys[f].order;g&&d.sort(function(j,k){return g(j.key,k.key)});if(++f<this.keys.length)for(var i=0;i<d.length;i++)c.call(this,d[i].values,f);return d}return c.call(this,b(this.map()),0)};a.rollup=function(b){function c(d){for(var f in d){var g=d[f];if(g instanceof Array)d[f]=b(g);else c(g)}return d}return c(this.map())};pv.flatten=function(b){return new pv.Flatten(b)};
pv.Flatten=function(b){this.map=b;this.keys=[]};pv.Flatten.prototype.key=function(b,c){this.keys.push({name:b,value:c});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(b){this.keys.length=0;this.$leaf=b;return this};
pv.Flatten.prototype.array=function(){function b(j,k){if(k<f.length-1)for(var p in j){d.push(p);b(j[p],k+1);d.pop()}else c.push(d.concat(j))}var c=[],d=[],f=this.keys,g=this.$leaf;if(g){function i(j,k){if(g(j))c.push({keys:d.slice(),value:j});else for(var p in j){d.push(p);i(j[p],k+1);d.pop()}}i(this.map,0);return c}b(this.map,0);return c.map(function(j){for(var k={},p=0;p<f.length;p++){var l=f[p],n=j[p];k[l.name]=l.value?l.value.call(null,n):n}return k})};
pv.vector=function(b,c){return new pv.Vector(b,c)};pv.Vector=function(b,c){this.x=b;this.y=c};a=pv.Vector.prototype;a.perp=function(){return new pv.Vector(-this.y,this.x)};a.norm=function(){var b=this.length();return this.times(b?1/b:1)};a.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.times=function(b){return new pv.Vector(this.x*b,this.y*b)};a.plus=function(b,c){return arguments.length==1?new pv.Vector(this.x+b.x,this.y+b.y):new pv.Vector(this.x+b,this.y+c)};
a.minus=function(b,c){return arguments.length==1?new pv.Vector(this.x-b.x,this.y-b.y):new pv.Vector(this.x-b,this.y-c)};a.dot=function(b,c){return arguments.length==1?this.x*b.x+this.y*b.y:this.x*b+this.y*c};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(b,c){var d=new pv.Transform;d.k=this.k;d.x=this.k*b+this.x;d.y=this.k*c+this.y;return d};
pv.Transform.prototype.scale=function(b){var c=new pv.Transform;c.k=this.k*b;c.x=this.x;c.y=this.y;return c};pv.Transform.prototype.invert=function(){var b=new pv.Transform,c=1/this.k;b.k=c;b.x=-this.x*c;b.y=-this.y*c;return b};pv.Transform.prototype.times=function(b){var c=new pv.Transform;c.k=this.k*b.k;c.x=this.k*b.x+this.x;c.y=this.k*b.y+this.y;return c};pv.Scale=function(){};
pv.Scale.interpolator=function(b,c){if(typeof b=="number")return function(d){return d*(c-b)+b};b=pv.color(b).rgb();c=pv.color(c).rgb();return function(d){var f=b.a*(1-d)+c.a*d;if(f<1.0E-5)f=0;return b.a==0?pv.rgb(c.r,c.g,c.b,f):c.a==0?pv.rgb(b.r,b.g,b.b,f):pv.rgb(Math.round(b.r*(1-d)+c.r*d),Math.round(b.g*(1-d)+c.g*d),Math.round(b.b*(1-d)+c.b*d),f)}};
pv.Scale.quantitative=function(){function b(q){return new Date(q)}function c(q){var m=pv.search(d,q);if(m<0)m=-m-2;m=Math.max(0,Math.min(i.length-1,m));return i[m]((p(q)-f[m])/(f[m+1]-f[m]))}var d=[0,1],f=[0,1],g=[0,1],i=[pv.identity],j=Number,k=false,p=pv.identity,l=pv.identity,n=String;c.transform=function(q,m){p=function(o){return k?-q(-o):q(o)};l=function(o){return k?-m(-o):m(o)};f=d.map(p);return this};c.domain=function(q,m,o){if(arguments.length){var s;if(q instanceof Array){if(arguments.length<
2)m=pv.identity;if(arguments.length<3)o=m;s=q.length&&m(q[0]);d=q.length?[pv.min(q,m),pv.max(q,o)]:[]}else{s=q;d=Array.prototype.slice.call(arguments).map(Number)}if(d.length){if(d.length==1)d=[d[0],d[0]]}else d=[-Infinity,Infinity];k=(d[0]||d[d.length-1])<0;f=d.map(p);j=s instanceof Date?b:Number;return this}return d.map(j)};c.range=function(){if(arguments.length){g=Array.prototype.slice.call(arguments);if(g.length){if(g.length==1)g=[g[0],g[0]]}else g=[-Infinity,Infinity];i=[];for(var q=0;q<g.length-
1;q++)i.push(pv.Scale.interpolator(g[q],g[q+1]));return this}return g};c.invert=function(q){var m=pv.search(g,q);if(m<0)m=-m-2;m=Math.max(0,Math.min(i.length-1,m));return j(l(f[m]+(q-g[m])/(g[m+1]-g[m])*(f[m+1]-f[m])))};c.ticks=function(q){var m=d[0],o=d[d.length-1],s=o<m,t=s?o:m;o=s?m:o;var u=o-t;if(!u||!isFinite(u)){if(j==b)n=pv.Format.date("%x");return[j(t)]}if(j==b){function z(x,A){switch(A){case 31536E6:x.setMonth(0);case 2592E6:x.setDate(1);case 6048E5:A==6048E5&&x.setDate(x.getDate()-x.getDay());
case 864E5:x.setHours(0);case 36E5:x.setMinutes(0);case 6E4:x.setSeconds(0);case 1E3:x.setMilliseconds(0)}}var y,r,v=1;if(u>=63072E6){y=31536E6;r="%Y";m=function(x){x.setFullYear(x.getFullYear()+v)}}else if(u>=5184E6){y=2592E6;r="%m/%Y";m=function(x){x.setMonth(x.getMonth()+v)}}else if(u>=12096E5){y=6048E5;r="%m/%d";m=function(x){x.setDate(x.getDate()+7*v)}}else if(u>=1728E5){y=864E5;r="%m/%d";m=function(x){x.setDate(x.getDate()+v)}}else if(u>=72E5){y=36E5;r="%I:%M %p";m=function(x){x.setHours(x.getHours()+
v)}}else if(u>=18E4){y=6E4;r="%I:%M %p";m=function(x){x.setMinutes(x.getMinutes()+v)}}else if(u>=3E3){y=1E3;r="%I:%M:%S";m=function(x){x.setSeconds(x.getSeconds()+v)}}else{y=1;r="%S.%Qs";m=function(x){x.setTime(x.getTime()+v)}}n=pv.Format.date(r);t=new Date(t);r=[];z(t,y);u=u/y;if(u>10)switch(y){case 36E5:v=u>20?6:3;t.setHours(Math.floor(t.getHours()/v)*v);break;case 2592E6:v=3;t.setMonth(Math.floor(t.getMonth()/v)*v);break;case 6E4:v=u>30?15:u>15?10:5;t.setMinutes(Math.floor(t.getMinutes()/v)*v);
break;case 1E3:v=u>90?15:u>60?10:5;t.setSeconds(Math.floor(t.getSeconds()/v)*v);break;case 1:v=u>1E3?250:u>200?100:u>100?50:u>50?25:5;t.setMilliseconds(Math.floor(t.getMilliseconds()/v)*v);break;default:v=pv.logCeil(u/15,10);if(u/v<2)v/=5;else if(u/v<5)v/=2;t.setFullYear(Math.floor(t.getFullYear()/v)*v);break}for(;;){m(t);if(t>o)break;r.push(new Date(t))}return s?r.reverse():r}arguments.length||(q=10);v=pv.logFloor(u/q,10);m=q/(u/v);if(m<=0.15)v*=10;else if(m<=0.35)v*=5;else if(m<=0.75)v*=2;m=Math.ceil(t/
v)*v;o=Math.floor(o/v)*v;y=Math.max(0,-Math.floor(pv.log(v,10)+0.01));n=function(x){return x.toFixed(y)};o=pv.range(m,o+v,v);return s?o.reverse():o};c.tickFormat=function(q){return n(q)};c.nice=function(){if(d.length!=2)return this;var q=d[0],m=d[d.length-1],o=m<q,s=o?m:q;q=o?q:m;m=q-s;if(!m||!isFinite(m))return this;m=Math.pow(10,Math.round(Math.log(m)/Math.log(10))-1);d=[Math.floor(s/m)*m,Math.ceil(q/m)*m];o&&d.reverse();f=d.map(p);return this};c.by=function(q){function m(){return c(q.apply(this,
arguments))}for(var o in c)m[o]=c[o];return m};c.domain.apply(c,arguments);return c};pv.Scale.linear=function(){var b=pv.Scale.quantitative();b.domain.apply(b,arguments);return b};
pv.Scale.log=function(){var b=pv.Scale.quantitative(1,10),c,d,f=function(i){return Math.log(i)/d},g=function(i){return Math.pow(c,i)};b.ticks=function(){var i=b.domain(),j=i[0]<0,k=Math.floor(j?-f(-i[0]):f(i[0])),p=Math.ceil(j?-f(-i[1]):f(i[1])),l=[];if(j)for(l.push(-g(-k));k++<p;)for(j=c-1;j>0;j--)l.push(-g(-k)*j);else{for(;k<p;k++)for(j=1;j<c;j++)l.push(g(k)*j);l.push(g(k))}for(k=0;l[k]<i[0];k++);for(p=l.length;l[p-1]>i[1];p--);return l.slice(k,p)};b.tickFormat=function(i){return i.toPrecision(1)};
b.nice=function(){var i=b.domain();return b.domain(pv.logFloor(i[0],c),pv.logCeil(i[1],c))};b.base=function(i){if(arguments.length){c=Number(i);d=Math.log(c);b.transform(f,g);return this}return c};b.domain.apply(b,arguments);return b.base(10)};pv.Scale.root=function(){var b=pv.Scale.quantitative();b.power=function(c){if(arguments.length){var d=Number(c),f=1/d;b.transform(function(g){return Math.pow(g,f)},function(g){return Math.pow(g,d)});return this}return d};b.domain.apply(b,arguments);return b.power(2)};
pv.Scale.ordinal=function(){function b(g){g in d||(d[g]=c.push(g)-1);return f[d[g]%f.length]}var c=[],d={},f=[];b.domain=function(g,i){if(arguments.length){g=g instanceof Array?arguments.length>1?pv.map(g,i):g:Array.prototype.slice.call(arguments);c=[];for(var j={},k=0;k<g.length;k++){var p=g[k];if(!(p in j)){j[p]=true;c.push(p)}}d=pv.numerate(c);return this}return c};b.range=function(g,i){if(arguments.length){f=g instanceof Array?arguments.length>1?pv.map(g,i):g:Array.prototype.slice.call(arguments);
if(typeof f[0]=="string")f=f.map(pv.color);return this}return f};b.split=function(g,i){var j=(i-g)/this.domain().length;f=pv.range(g+j/2,i,j);return this};b.splitFlush=function(g,i){var j=this.domain().length,k=(i-g)/(j-1);f=j==1?[(g+i)/2]:pv.range(g,i+k/2,k);return this};b.splitBanded=function(g,i,j){if(arguments.length<3)j=1;if(j<0){var k=this.domain().length;k=(i-g- -j*k)/(k+1);f=pv.range(g+k,i,k-j);f.band=-j}else{k=(i-g)/(this.domain().length+(1-j));f=pv.range(g+k*(1-j),i,k);f.band=k*j}return this};
b.by=function(g){function i(){return b(g.apply(this,arguments))}for(var j in b)i[j]=b[j];return i};b.domain.apply(b,arguments);return b};
pv.histogram=function(b,c){var d=true;return{bins:function(f){var g=pv.map(b,c),i=[];arguments.length||(f=pv.Scale.linear(g).ticks());for(var j=0;j<f.length-1;j++){var k=i[j]=[];k.x=f[j];k.dx=f[j+1]-f[j];k.y=0}for(j=0;j<g.length;j++){k=pv.search.index(f,g[j])-1;k=i[Math.max(0,Math.min(i.length-1,k))];k.y++;k.push(b[j])}if(!d)for(j=0;j<i.length;j++)i[j].y/=g.length;return i},frequency:function(f){if(arguments.length){d=Boolean(f);return this}return d}}};
pv.color=function(b){if(b.rgb)return b.rgb();var c=/([a-z]+)\((.*)\)/i.exec(b);if(c){var d=c[2].split(","),f=1;switch(c[1]){case "hsla":case "rgba":f=parseFloat(d[3]);if(!f)return pv.Color.transparent;break}switch(c[1]){case "hsla":case "hsl":b=parseFloat(d[0]);var g=parseFloat(d[1])/100;d=parseFloat(d[2])/100;return(new pv.Color.Hsl(b,g,d,f)).rgb();case "rgba":case "rgb":function i(p){var l=parseFloat(p);return p[p.length-1]=="%"?Math.round(l*2.55):l}g=i(d[0]);var j=i(d[1]),k=i(d[2]);return pv.rgb(g,
j,k,f)}}if(f=pv.Color.names[b])return f;if(b.charAt(0)=="#"){if(b.length==4){g=b.charAt(1);g+=g;j=b.charAt(2);j+=j;k=b.charAt(3);k+=k}else if(b.length==7){g=b.substring(1,3);j=b.substring(3,5);k=b.substring(5,7)}return pv.rgb(parseInt(g,16),parseInt(j,16),parseInt(k,16),1)}return new pv.Color(b,1)};pv.Color=function(b,c){this.color=b;this.opacity=c};pv.Color.prototype.brighter=function(b){return this.rgb().brighter(b)};pv.Color.prototype.darker=function(b){return this.rgb().darker(b)};
pv.rgb=function(b,c,d,f){return new pv.Color.Rgb(b,c,d,arguments.length==4?f:1)};pv.Color.Rgb=function(b,c,d,f){pv.Color.call(this,f?"rgb("+b+","+c+","+d+")":"none",f);this.r=b;this.g=c;this.b=d;this.a=f};pv.Color.Rgb.prototype=pv.extend(pv.Color);a=pv.Color.Rgb.prototype;a.red=function(b){return pv.rgb(b,this.g,this.b,this.a)};a.green=function(b){return pv.rgb(this.r,b,this.b,this.a)};a.blue=function(b){return pv.rgb(this.r,this.g,b,this.a)};
a.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};a.rgb=function(){return this};a.brighter=function(b){b=Math.pow(0.7,arguments.length?b:1);var c=this.r,d=this.g,f=this.b;if(!c&&!d&&!f)return pv.rgb(30,30,30,this.a);if(c&&c<30)c=30;if(d&&d<30)d=30;if(f&&f<30)f=30;return pv.rgb(Math.min(255,Math.floor(c/b)),Math.min(255,Math.floor(d/b)),Math.min(255,Math.floor(f/b)),this.a)};
a.darker=function(b){b=Math.pow(0.7,arguments.length?b:1);return pv.rgb(Math.max(0,Math.floor(b*this.r)),Math.max(0,Math.floor(b*this.g)),Math.max(0,Math.floor(b*this.b)),this.a)};pv.hsl=function(b,c,d,f){return new pv.Color.Hsl(b,c,d,arguments.length==4?f:1)};pv.Color.Hsl=function(b,c,d,f){pv.Color.call(this,"hsl("+b+","+c*100+"%,"+d*100+"%)",f);this.h=b;this.s=c;this.l=d;this.a=f};pv.Color.Hsl.prototype=pv.extend(pv.Color);a=pv.Color.Hsl.prototype;
a.hue=function(b){return pv.hsl(b,this.s,this.l,this.a)};a.saturation=function(b){return pv.hsl(this.h,b,this.l,this.a)};a.lightness=function(b){return pv.hsl(this.h,this.s,b,this.a)};a.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};
a.rgb=function(){function b(k){if(k>360)k-=360;else if(k<0)k+=360;if(k<60)return j+(i-j)*k/60;if(k<180)return i;if(k<240)return j+(i-j)*(240-k)/60;return j}function c(k){return Math.round(b(k)*255)}var d=this.h,f=this.s,g=this.l;d%=360;if(d<0)d+=360;f=Math.max(0,Math.min(f,1));g=Math.max(0,Math.min(g,1));var i=g<=0.5?g*(1+f):g+f-g*f,j=2*g-i;return pv.rgb(c(d+120),c(d),c(d-120),this.a)};
pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",
darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var b=pv.Color.names;for(var c in b)b[c]=pv.color(b[c])})();
pv.colors=function(){var b=pv.Scale.ordinal();b.range.apply(b,arguments);return b};pv.Colors={};pv.Colors.category10=function(){var b=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");b.domain.apply(b,arguments);return b};
pv.Colors.category20=function(){var b=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");b.domain.apply(b,arguments);return b};
pv.Colors.category19=function(){var b=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");b.domain.apply(b,arguments);return b};pv.ramp=function(){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};
pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},
css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(b){if(b.length&&b[0].reverse&&b.type!="line"&&b.type!="area"){for(var c=pv.extend(b),d=0,f=b.length-1;f>=0;d++,f--)c[d]=b[f];b=c}this.removeSiblings(this[b.type](b))};pv.SvgScene.create=function(b){return document.createElementNS(this.svg,b)};
pv.SvgScene.expect=function(b,c,d,f){if(b){if(b.tagName=="a")b=b.firstChild;if(b.tagName!=c){c=this.create(c);b.parentNode.replaceChild(c,b);b=c}}else b=this.create(c);for(var g in d){c=d[g];if(c==this.implicit.svg[g])c=null;c==null?b.removeAttribute(g):b.setAttribute(g,c)}for(g in f){c=f[g];if(c==this.implicit.css[g])c=null;if(c==null)b.style.removeProperty(g);else b.style[g]=c}return b};
pv.SvgScene.append=function(b,c,d){b.$scene={scenes:c,index:d};b=this.title(b,c[d]);b.parentNode||c.$g.appendChild(b);return b.nextSibling};pv.SvgScene.title=function(b,c){var d=b.parentNode;if(d&&d.tagName!="a")d=null;if(c.title){if(!d){d=this.create("a");b.parentNode&&b.parentNode.replaceChild(d,b);d.appendChild(b)}d.setAttributeNS(this.xlink,"title",c.title);return d}d&&d.parentNode.replaceChild(b,d);return b};
pv.SvgScene.dispatch=pv.listener(function(b){var c=b.target.$scene;if(c){var d=b.type;switch(d){case "DOMMouseScroll":d="mousewheel";b.wheel=-480*b.detail;break;case "mousewheel":b.wheel=(window.opera?12:48)*b.wheelDelta;break}pv.Mark.dispatch(d,c.scenes,c.index)&&b.preventDefault()}});pv.SvgScene.removeSiblings=function(b){for(;b;){var c=b.nextSibling;b.parentNode.removeChild(b);b=c}};pv.SvgScene.undefined=function(){};
pv.SvgScene.area=function(b){function c(n,q){for(var m=[],o=[],s=q;n<=s;n++,q--){var t=b[n],u=b[q];t=t.left+","+t.top;u=u.left+u.width+","+(u.top+u.height);if(n<s){var z=b[n+1],y=b[q-1];switch(f.interpolate){case "step-before":t+="V"+z.top;u+="H"+(y.left+y.width);break;case "step-after":t+="H"+z.left;u+="V"+(y.top+y.height);break}}m.push(t);o.push(u)}return m.concat(o).join("L")}var d=b.$g.firstChild;if(!b.length)return d;var f=b[0];if(f.segmented)return this.areaSegment(b);if(!f.visible)return d;
var g=f.fillStyle,i=f.strokeStyle;if(!g.opacity&&!i.opacity)return d;for(var j=[],k,p=0;p<b.length;p++){k=b[p];if(k.width||k.height){for(var l=p+1;l<b.length;l++){k=b[l];if(!k.width&&!k.height)break}p&&f.interpolate!="step-after"&&p--;l<b.length&&f.interpolate!="step-before"&&l++;j.push(c(p,p=l-1))}}if(!j.length)return d;d=this.expect(d,"path",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,d:"M"+j.join("ZM")+"Z",fill:g.color,"fill-opacity":g.opacity||null,
stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?f.lineWidth/this.scale:null});return this.append(d,b,0)};
pv.SvgScene.areaSegment=function(b){for(var c=b.$g.firstChild,d=0,f=b.length-1;d<f;d++){var g=b[d],i=b[d+1];if(g.visible&&i.visible){var j=g.fillStyle,k=g.strokeStyle;if(j.opacity||k.opacity){var p=g,l=i;switch(g.interpolate){case "step-before":p=i;break;case "step-after":l=g;break}c=this.expect(c,"polygon",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,points:g.left+","+p.top+" "+i.left+","+l.top+" "+(i.left+i.width)+","+(l.top+l.height)+" "+(g.left+g.width)+
","+(p.top+p.height),fill:j.color,"fill-opacity":j.opacity||null,stroke:k.color,"stroke-opacity":k.opacity||null,"stroke-width":k.opacity?g.lineWidth/this.scale:null});c=this.append(c,b,d)}}}return c};
pv.SvgScene.bar=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){var g=f.fillStyle,i=f.strokeStyle;if(g.opacity||i.opacity){c=this.expect(c,"rect",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,x:f.left,y:f.top,width:Math.max(1.0E-10,f.width),height:Math.max(1.0E-10,f.height),fill:g.color,"fill-opacity":g.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?f.lineWidth/this.scale:null});
c=this.append(c,b,d)}}}return c};
pv.SvgScene.dot=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){var g=f.fillStyle,i=f.strokeStyle;if(g.opacity||i.opacity){var j=f.radius,k=null;switch(f.shape){case "cross":k="M"+-j+","+-j+"L"+j+","+j+"M"+j+","+-j+"L"+-j+","+j;break;case "triangle":k=j;var p=j*1.1547;k="M0,"+k+"L"+p+","+-k+" "+-p+","+-k+"Z";break;case "diamond":j*=Math.SQRT2;k="M0,"+-j+"L"+j+",0 0,"+j+" "+-j+",0Z";break;case "square":k="M"+-j+","+-j+"L"+j+","+-j+" "+j+","+j+" "+-j+","+j+"Z";break;
case "tick":k="M0,0L0,"+-f.size;break}g={"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,fill:g.color,"fill-opacity":g.opacity||null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?f.lineWidth/this.scale:null};if(k){g.transform="translate("+f.left+","+f.top+")";if(f.angle)g.transform+=" rotate("+180*f.angle/Math.PI+")";g.d=k;c=this.expect(c,"path",g)}else{g.cx=f.left;g.cy=f.top;g.r=j;c=this.expect(c,"circle",g)}c=this.append(c,b,d)}}}return c};
pv.SvgScene.image=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){c=this.fill(c,b,d);if(f.image){c=this.expect(c,"foreignObject",{cursor:f.cursor,x:f.left,y:f.top,width:f.width,height:f.height});var g=c.firstChild||c.appendChild(document.createElementNS(this.xhtml,"canvas"));g.$scene={scenes:b,index:d};g.style.width=f.width;g.style.height=f.height;g.width=f.imageWidth;g.height=f.imageHeight;g.getContext("2d").putImageData(f.image,0,0)}else{c=this.expect(c,"image",
{preserveAspectRatio:"none",cursor:f.cursor,x:f.left,y:f.top,width:f.width,height:f.height});c.setAttributeNS(this.xlink,"href",f.url)}c=this.append(c,b,d);c=this.stroke(c,b,d)}}return c};
pv.SvgScene.label=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){var g=f.textStyle;if(g.opacity&&f.text){var i=0,j=0,k=0,p="start";switch(f.textBaseline){case "middle":k=".35em";break;case "top":k=".71em";j=f.textMargin;break;case "bottom":j="-"+f.textMargin;break}switch(f.textAlign){case "right":p="end";i="-"+f.textMargin;break;case "center":p="middle";break;case "left":i=f.textMargin;break}c=this.expect(c,"text",{"pointer-events":f.events,cursor:f.cursor,x:i,
y:j,dy:k,transform:"translate("+f.left+","+f.top+")"+(f.textAngle?" rotate("+180*f.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:g.color,"fill-opacity":g.opacity||null,"text-anchor":p},{font:f.font,"text-shadow":f.textShadow,"text-decoration":f.textDecoration});if(c.firstChild)c.firstChild.nodeValue=f.text;else c.appendChild(document.createTextNode(f.text));c=this.append(c,b,d)}}}return c};
pv.SvgScene.line=function(b){var c=b.$g.firstChild;if(b.length<2)return c;var d=b[0];if(d.segmented)return this.lineSegment(b);if(!d.visible)return c;var f=d.fillStyle,g=d.strokeStyle;if(!f.opacity&&!g.opacity)return c;var i="M"+d.left+","+d.top;if(d.interpolate=="basis"&&b.length>2){var j=b[0],k=j,p=j,l=b[1];i+=this.pathBasis(j,k,p,l);for(var n=2;n<b.length;n++){j=k;k=p;p=l;l=b[n];i+=this.pathBasis(j,k,p,l)}for(n=0;n<2;n++){j=k;k=p;p=l;i+=this.pathBasis(j,k,p,l)}}else if(d.interpolate=="cardinal"&&
b.length>2){l=(1-d.tension)/2;j=b[0];k=b[1];p=b[2];i+="C"+(j.left+(p.left-j.left)*l)+","+(j.top+(p.top-j.top)*l)+","+(k.left+(j.left-p.left)*l)+","+(k.top+(j.top-p.top)*l)+","+k.left+","+k.top;for(n=3;n<b.length;n++){j=k;k=p;p=b[n];i+="S"+(k.left+(j.left-p.left)*l)+","+(k.top+(j.top-p.top)*l)+","+k.left+","+k.top}i+="S"+(p.left-(p.left-j.left)*l)+","+(p.top-(p.top-j.top)*l)+","+p.left+","+p.top}else for(n=1;n<b.length;n++)i+=this.pathSegment(b[n-1],b[n]);c=this.expect(c,"path",{"shape-rendering":d.antialias?
null:"crispEdges","pointer-events":d.events,cursor:d.cursor,d:i,fill:f.color,"fill-opacity":f.opacity||null,stroke:g.color,"stroke-opacity":g.opacity||null,"stroke-width":g.opacity?d.lineWidth/this.scale:null,"stroke-linejoin":d.lineJoin});return this.append(c,b,0)};
pv.SvgScene.pathBasis=function(){function b(d,f,g,i,j){return{x:d[0]*f.left+d[1]*g.left+d[2]*i.left+d[3]*j.left,y:d[0]*f.top+d[1]*g.top+d[2]*i.top+d[3]*j.top}}var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];return function(d,f,g,i){var j=b(c[1],d,f,g,i),k=b(c[2],d,f,g,i);d=b(c[3],d,f,g,i);return"C"+j.x+","+j.y+","+k.x+","+k.y+","+d.x+","+d.y}}();
pv.SvgScene.lineSegment=function(b){for(var c=b.$g.firstChild,d=0,f=b.length-1;d<f;d++){var g=b[d],i=b[d+1];if(g.visible&&i.visible){var j=g.strokeStyle,k=pv.Color.transparent;if(j.opacity){if(g.interpolate=="linear"&&g.lineJoin=="miter"){k=j;j=pv.Color.transparent;i=this.pathJoin(b[d-1],g,i,b[d+2])}else i="M"+g.left+","+g.top+this.pathSegment(g,i);c=this.expect(c,"path",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,d:i,fill:k.color,"fill-opacity":k.opacity||
null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?g.lineWidth/this.scale:null,"stroke-linejoin":g.lineJoin});c=this.append(c,b,d)}}}return c};
pv.SvgScene.pathSegment=function(b,c){var d=1;switch(b.interpolate){case "polar-reverse":d=0;case "polar":var f=c.left-b.left,g=c.top-b.top;b=1-b.eccentricity;f=Math.sqrt(f*f+g*g)/(2*b);if(b<=0||b>1)break;return"A"+f+","+f+" 0 0,"+d+" "+c.left+","+c.top;case "step-before":return"V"+c.top+"H"+c.left;case "step-after":return"H"+c.left+"V"+c.top}return"L"+c.left+","+c.top};pv.SvgScene.lineIntersect=function(b,c,d,f){return b.plus(c.times(d.minus(b).dot(f.perp())/c.dot(f.perp())))};
pv.SvgScene.pathJoin=function(b,c,d,f){var g=pv.vector(c.left,c.top);d=pv.vector(d.left,d.top);var i=d.minus(g),j=i.perp().norm(),k=j.times(c.lineWidth/(2*this.scale));c=g.plus(k);var p=d.plus(k),l=d.minus(k);k=g.minus(k);if(b&&b.visible){b=g.minus(b.left,b.top).perp().norm().plus(j);k=this.lineIntersect(g,b,k,i);c=this.lineIntersect(g,b,c,i)}if(f&&f.visible){f=pv.vector(f.left,f.top).minus(d).perp().norm().plus(j);l=this.lineIntersect(d,f,l,i);p=this.lineIntersect(d,f,p,i)}return"M"+c.x+","+c.y+
"L"+p.x+","+p.y+" "+l.x+","+l.y+" "+k.x+","+k.y};
pv.SvgScene.panel=function(b){for(var c=b.$g,d=c&&c.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){if(!b.parent){g.canvas.style.display="inline-block";if(c&&c.parentNode!=g.canvas)d=(c=g.canvas.firstChild)&&c.firstChild;if(!c){c=g.canvas.appendChild(this.create("svg"));c.setAttribute("font-size","10px");c.setAttribute("font-family","sans-serif");c.setAttribute("fill","none");c.setAttribute("stroke","none");c.setAttribute("stroke-width",1.5);for(var i=0;i<this.events.length;i++)c.addEventListener(this.events[i],
this.dispatch,false);d=c.firstChild}b.$g=c;c.setAttribute("width",g.width+g.left+g.right);c.setAttribute("height",g.height+g.top+g.bottom)}if(g.overflow=="hidden"){i=pv.id().toString(36);var j=this.expect(d,"g",{"clip-path":"url(#"+i+")"});j.parentNode||c.appendChild(j);b.$g=c=j;d=j.firstChild;d=this.expect(d,"clipPath",{id:i});i=d.firstChild||d.appendChild(this.create("rect"));i.setAttribute("x",g.left);i.setAttribute("y",g.top);i.setAttribute("width",g.width);i.setAttribute("height",g.height);d.parentNode||
c.appendChild(d);d=d.nextSibling}d=this.fill(d,b,f);var k=this.scale,p=g.transform,l=g.left+p.x,n=g.top+p.y;this.scale*=p.k;for(i=0;i<g.children.length;i++){g.children[i].$g=d=this.expect(d,"g",{transform:"translate("+l+","+n+")"+(p.k!=1?" scale("+p.k+")":"")});this.updateAll(g.children[i]);d.parentNode||c.appendChild(d);d=d.nextSibling}this.scale=k;d=this.stroke(d,b,f);if(g.overflow=="hidden"){b.$g=c=j.parentNode;d=j.nextSibling}}}return d};
pv.SvgScene.fill=function(b,c,d){var f=c[d],g=f.fillStyle;if(g.opacity||f.events=="all"){b=this.expect(b,"rect",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,x:f.left,y:f.top,width:f.width,height:f.height,fill:g.color,"fill-opacity":g.opacity,stroke:null});b=this.append(b,c,d)}return b};
pv.SvgScene.stroke=function(b,c,d){var f=c[d],g=f.strokeStyle;if(g.opacity||f.events=="all"){b=this.expect(b,"rect",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events=="all"?"stroke":f.events,cursor:f.cursor,x:f.left,y:f.top,width:Math.max(1.0E-10,f.width),height:Math.max(1.0E-10,f.height),fill:null,stroke:g.color,"stroke-opacity":g.opacity,"stroke-width":f.lineWidth/this.scale});b=this.append(b,c,d)}return b};
pv.SvgScene.rule=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){var g=f.strokeStyle;if(g.opacity){c=this.expect(c,"line",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,x1:f.left,y1:f.top,x2:f.left+f.width,y2:f.top+f.height,stroke:g.color,"stroke-opacity":g.opacity,"stroke-width":f.lineWidth/this.scale});c=this.append(c,b,d)}}}return c};
pv.SvgScene.wedge=function(b){for(var c=b.$g.firstChild,d=0;d<b.length;d++){var f=b[d];if(f.visible){var g=f.fillStyle,i=f.strokeStyle;if(g.opacity||i.opacity){var j=f.innerRadius,k=f.outerRadius,p=Math.abs(f.angle);if(p>=2*Math.PI)j=j?"M0,"+k+"A"+k+","+k+" 0 1,1 0,"+-k+"A"+k+","+k+" 0 1,1 0,"+k+"M0,"+j+"A"+j+","+j+" 0 1,1 0,"+-j+"A"+j+","+j+" 0 1,1 0,"+j+"Z":"M0,"+k+"A"+k+","+k+" 0 1,1 0,"+-k+"A"+k+","+k+" 0 1,1 0,"+k+"Z";else{var l=Math.min(f.startAngle,f.endAngle),n=Math.max(f.startAngle,f.endAngle),
q=Math.cos(l),m=Math.cos(n);l=Math.sin(l);n=Math.sin(n);j=j?"M"+k*q+","+k*l+"A"+k+","+k+" 0 "+(p<Math.PI?"0":"1")+",1 "+k*m+","+k*n+"L"+j*m+","+j*n+"A"+j+","+j+" 0 "+(p<Math.PI?"0":"1")+",0 "+j*q+","+j*l+"Z":"M"+k*q+","+k*l+"A"+k+","+k+" 0 "+(p<Math.PI?"0":"1")+",1 "+k*m+","+k*n+"L0,0Z"}c=this.expect(c,"path",{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,transform:"translate("+f.left+","+f.top+")",d:j,fill:g.color,"fill-rule":"evenodd","fill-opacity":g.opacity||
null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?f.lineWidth/this.scale:null});c=this.append(c,b,d)}}}return c};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,c){if(!this.hasOwnProperty("properties"))this.properties=pv.extend(this.properties);this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=c);return this};
pv.Mark.prototype.propertyMethod=function(b,c,d){d||(d=pv.Mark.cast[b]);this[b]=function(f){if(c&&this.scene){var g=this.scene.defs;if(arguments.length){g[b]={id:f==null?0:pv.id(),value:f!=null&&d?d(f):f};return this}return g[b]?g[b].value:null}if(arguments.length){g=!c<<1|typeof f=="function";this.propertyValue(b,g&1&&d?function(){var i=f.apply(this,arguments);return i!=null?d(i):null}:f!=null&&d?d(f):f).type=g;return this}return this.instance()[b]}};
pv.Mark.prototype.propertyValue=function(b,c){var d=this.$properties;c={name:b,id:pv.id(),value:c};for(var f=0;f<d.length;f++)if(d[f].name==b){d.splice(f,1);break}d.push(c);return c};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String);a=pv.Mark.prototype;
a.childIndex=-1;a.index=-1;a.scale=1;a.defaults=(new pv.Mark).data(function(b){return[b]}).visible(true).antialias(true).events("painted");a.extend=function(b){this.proto=b;return this};a.add=function(b){return this.parent.add(b).extend(this)};a.def=function(b,c){this.propertyMethod(b,true);return this[b](arguments.length>1?c:null)};
a.anchor=function(b){function c(g){for(var i=d,j=[];!(f=i.scene);){g=g.parent;j.push({index:g.index,childIndex:i.childIndex});i=i.parent}for(;j.length;){g=j.pop();f=f[g.index].children[g.childIndex]}if(d.hasOwnProperty("index")){j=pv.extend(f[d.index]);j.right=j.top=j.left=j.bottom=0;return[j]}return f}var d=this,f;b||(b="center");return(new pv.Anchor(this)).name(b).def("$mark.anchor",function(){f=this.scene.target=c(this)}).data(function(){return f.map(function(g){return g.data})}).visible(function(){return f[this.index].visible}).left(function(){var g=
f[this.index],i=g.width||0;switch(this.name()){case "bottom":case "top":case "center":return g.left+(this.properties.width?0:i/2);case "left":return null}return g.left+i}).top(function(){var g=f[this.index],i=g.height||0;switch(this.name()){case "left":case "right":case "center":return g.top+(this.properties.height?0:i/2);case "top":return null}return g.top+i}).right(function(){var g=f[this.index];return this.name()=="left"?g.right+(g.width||0):null}).bottom(function(){var g=f[this.index];return this.name()==
"top"?g.bottom+(g.height||0):null}).textAlign(function(){switch(this.name()){case "bottom":case "top":case "center":return"center";case "right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"top"}return"bottom"})};a.anchorTarget=function(){return this.proto.anchorTarget()};a.margin=function(b){return this.left(b).right(b).top(b).bottom(b)};
a.instance=function(b){var c=this.scene||this.parent.instance(-1).children[this.childIndex],d=!arguments.length||this.hasOwnProperty("index")?this.index:b;return c[d<0?c.length-1:d]};a.first=function(){return this.scene[0]};a.last=function(){return this.scene[this.scene.length-1]};a.sibling=function(){return this.index==0?null:this.scene[this.index-1]};a.cousin=function(){var b=this.parent;return(b=b&&b.sibling())&&b.children?b.children[this.childIndex][this.index]:null};
a.render=function(){function b(j,k,p){j.scale=p;if(k<g.length){f.unshift(null);if(j.hasOwnProperty("index"))c(j,k,p);else{for(var l=0,n=j.scene.length;l<n;l++){j.index=l;c(j,k,p)}delete j.index}f.shift()}else{j.build();pv.Scene.scale=p;pv.Scene.updateAll(j.scene)}delete j.scale}function c(j,k,p){var l=j.scene[j.index],n;if(l.visible){var q=g[k],m=j.children[q];for(n=0;n<q;n++)j.children[n].scene=l.children[n];f[0]=l.data;if(m.scene)b(m,k+1,p*l.transform.k);else{m.scene=l.children[q];b(m,k+1,p*l.transform.k);
delete m.scene}for(n=0;n<q;n++)delete j.children[n].scene}}var d=this.parent,f=pv.Mark.stack;if(d&&!this.root.scene)this.root.render();else{for(var g=[],i=this;i.parent;i=i.parent)g.unshift(i.childIndex);for(this.bind();d&&!d.hasOwnProperty("index");)d=d.parent;this.context(d?d.scene:undefined,d?d.index:-1,function(){b(this.root,0,1)})}};pv.Mark.stack=[];a=pv.Mark.prototype;
a.bind=function(){function b(k){do for(var p=k.$properties,l=p.length-1;l>=0;l--){var n=p[l];if(!(n.name in c)){c[n.name]=n;switch(n.name){case "data":f=n;break;case "visible":g=n;break;default:d[n.type].push(n);break}}}while(k=k.proto)}var c={},d=[[],[],[],[]],f,g;b(this);b(this.defaults);d[1].reverse();d[3].reverse();var i=this;do for(var j in i.properties)j in c||d[2].push(c[j]={name:j,type:2,value:null});while(i=i.proto);i=d[0].concat(d[1]);for(j=0;j<i.length;j++)this.propertyMethod(i[j].name,
true);this.binds={properties:c,data:f,defs:i,required:[g],optional:pv.blend(d)}};
a.build=function(){var b=this.scene,c=pv.Mark.stack;if(!b){b=this.scene=[];b.mark=this;b.type=this.type;b.childIndex=this.childIndex;if(this.parent){b.parent=this.parent.scene;b.parentIndex=this.parent.index}}if(this.binds.defs.length){var d=b.defs;if(!d)b.defs=d={};for(var f=0;f<this.binds.defs.length;f++){var g=this.binds.defs[f],i=d[g.name];if(!i||g.id>i.id)d[g.name]={id:0,value:g.type&1?g.value.apply(this,c):g.value}}}d=this.binds.data;d=d.type&1?d.value.apply(this,c):d.value;c.unshift(null);
b.length=d.length;for(f=0;f<d.length;f++){pv.Mark.prototype.index=this.index=f;(g=b[f])||(b[f]=g={});g.data=c[0]=d[f];this.buildInstance(g)}pv.Mark.prototype.index=-1;delete this.index;c.shift();return this};a.buildProperties=function(b,c){for(var d=0,f=c.length;d<f;d++){var g=c[d],i=g.value;switch(g.type){case 0:case 1:i=this.scene.defs[g.name].value;break;case 3:i=i.apply(this,pv.Mark.stack);break}b[g.name]=i}};
a.buildInstance=function(b){this.buildProperties(b,this.binds.required);if(b.visible){this.buildProperties(b,this.binds.optional);this.buildImplied(b)}};
a.buildImplied=function(b){var c=b.left,d=b.right,f=b.top,g=b.bottom,i=this.properties,j=i.width?b.width:0,k=i.height?b.height:0,p=this.parent?this.parent.width():j+c+d;if(j==null)j=p-(d=d||0)-(c=c||0);else if(d==null)d=p-j-(c=c||0);else if(c==null)c=p-j-(d=d||0);p=this.parent?this.parent.height():k+f+g;if(k==null)k=p-(f=f||0)-(g=g||0);else if(g==null)g=p-k-(f=f||0);else if(f==null)f=p-k-(g=g||0);b.left=c;b.right=d;b.top=f;b.bottom=g;if(i.width)b.width=j;if(i.height)b.height=k;if(i.textStyle&&!b.textStyle)b.textStyle=
pv.Color.transparent;if(i.fillStyle&&!b.fillStyle)b.fillStyle=pv.Color.transparent;if(i.strokeStyle&&!b.strokeStyle)b.strokeStyle=pv.Color.transparent};
a.mouse=function(){var b=pv.event.pageX,c=pv.event.pageY,d=this.root.canvas();do{b-=d.offsetLeft;c-=d.offsetTop}while(d=d.offsetParent);d=pv.Transform.identity;var f=this.properties.transform?this:this.parent,g=[];do g.push(f);while(f=f.parent);for(;f=g.pop();)d=d.translate(f.left(),f.top()).times(f.transform());d=d.invert();return pv.vector(b*d.k+d.x,c*d.k+d.y)};a.event=function(b,c){this.$handlers[b]=c;return this};
a.context=function(b,c,d){function f(l,n){pv.Mark.scene=l;i.index=n;if(l){var q=l.mark,m=q,o=[];do{o.push(m);j.push(l[n].data);m.index=n;m.scene=l;n=l.parentIndex;l=l.parent}while(m=m.parent);l=o.length-1;for(n=1;l>0;l--){m=o[l];m.scale=n;n*=m.scene[m.index].transform.k}if(q.children){l=0;for(o=q.children.length;l<o;l++){m=q.children[l];m.scene=q.scene[q.index].children[l];m.scale=n}}}}function g(l){if(l){l=l.mark;var n;if(l.children)for(var q=0,m=l.children.length;q<m;q++){n=l.children[q];delete n.scene;
delete n.scale}n=l;do{j.pop();if(n.parent){delete n.scene;delete n.scale}delete n.index}while(n=n.parent)}}var i=pv.Mark.prototype,j=pv.Mark.stack,k=pv.Mark.scene,p=i.index;g(k,p);f(b,c);try{d.apply(this,j)}finally{g(b,c);f(k,p)}};pv.Mark.dispatch=function(b,c,d){var f=c.mark,g=c.parent,i=f.$handlers[b];if(!i)return g&&pv.Mark.dispatch(b,g,c.parentIndex);f.context(c,d,function(){(f=i.apply(f,pv.Mark.stack))&&f.render&&f.render()});return true};
pv.Anchor=function(b){pv.Mark.call(this);this.target=b;this.parent=b.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.anchorTarget=function(){return this.target};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String);
pv.Area.prototype.type="area";pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear");pv.Area.prototype.buildImplied=function(b){if(b.height==null)b.height=0;if(b.width==null)b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};
pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var b=this.binds,c=b.required;b=b.optional;for(var d=0,f=b.length;d<f;d++){var g=b[d];g.fixed=g.name in pv.Area.fixed;if(g.name=="segmented"){c.push(g);b.splice(d,1);d--;f--}}this.binds.$required=c;this.binds.$optional=b};
pv.Area.prototype.buildInstance=function(b){var c=this.binds;if(this.index){var d=c.fixed;if(!d){d=c.fixed=[];function f(j){return!j.fixed||(d.push(j),false)}c.required=c.required.filter(f);if(!this.scene[0].segmented)c.optional=c.optional.filter(f)}c=0;for(var g=d.length;c<g;c++){var i=d[c].name;b[i]=this.scene[0][i]}}else{c.required=c.$required;c.optional=c.$optional;c.fixed=null}pv.Mark.prototype.buildInstance.call(this,b)};
pv.Area.prototype.anchor=function(b){var c;return pv.Mark.prototype.anchor.call(this,b).def("$area.anchor",function(){c=this.scene.target}).interpolate(function(){return c[this.index].interpolate}).eccentricity(function(){return c[this.index].eccentricity}).tension(function(){return c[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};
pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};
pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));
pv.Dot.prototype.anchor=function(b){var c;return pv.Mark.prototype.anchor.call(this,b).def("$wedge.anchor",function(){c=this.scene.target}).left(function(){var d=c[this.index];switch(this.name()){case "bottom":case "top":case "center":return d.left;case "left":return null}return d.left+d.radius}).right(function(){var d=c[this.index];return this.name()=="left"?d.right+d.radius:null}).top(function(){var d=c[this.index];switch(this.name()){case "left":case "right":case "center":return d.top;case "top":return null}return d.top+
d.radius}).bottom(function(){var d=c[this.index];return this.name()=="top"?d.bottom+d.radius:null}).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "bottom":return"top"}return"bottom"})};
pv.Dot.prototype.buildImplied=function(b){if(b.radius==null)b.radius=Math.sqrt(b.size);else if(b.size==null)b.size=b.radius*b.radius;pv.Mark.prototype.buildImplied.call(this,b)};pv.Label=function(){pv.Mark.call(this)};
pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);
pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);a=pv.Line.prototype;a.type="line";a.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7);
a.bind=pv.Area.prototype.bind;a.buildInstance=pv.Area.prototype.buildInstance;a.anchor=function(b){return pv.Area.prototype.anchor.call(this,b).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center";case "right":return"left"}}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"bottom";case "bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};
pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;
pv.Rule.prototype.buildImplied=function(b){var c=b.left,d=b.right;if(b.width!=null||c==null&&d==null||d!=null&&c!=null)b.height=0;else b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(b){return typeof b=="string"?document.getElementById(b):b});a=pv.Panel.prototype;a.type="panel";
a.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");a.anchor=function(b){b=pv.Bar.prototype.anchor.call(this,b);b.parent=this;return b};a.add=function(b){b=new b;b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};a.bind=function(){pv.Mark.prototype.bind.call(this);for(var b=0;b<this.children.length;b++)this.children[b].bind()};
a.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(b.visible){if(!b.children)b.children=[];var c=this.scale*b.transform.k,d,f=this.children.length;pv.Mark.prototype.index=-1;for(var g=0;g<f;g++){d=this.children[g];d.scene=b.children[g];d.scale=c;d.build()}for(g=0;g<f;g++){d=this.children[g];b.children[g]=d.scene;delete d.scene;delete d.scale}b.children.length=f}};
a.buildImplied=function(b){if(!this.parent){var c=b.canvas;if(c){if(c.$panel!=this)for(c.$panel=this;c.lastChild;)c.removeChild(c.lastChild);var d;if(b.width==null){d=parseFloat(pv.css(c,"width"));b.width=d-b.left-b.right}if(b.height==null){d=parseFloat(pv.css(c,"height"));b.height=d-b.top-b.bottom}}else{d=this.$canvas||(this.$canvas=[]);if(!(c=d[this.index])){c=d[this.index]=document.createElement("span");if(this.$dom)this.$dom.parentNode.insertBefore(c,this.$dom);else{for(d=document.body;d.lastChild&&
d.lastChild.tagName;)d=d.lastChild;if(d!=document.body)d=d.parentNode;d.appendChild(c)}}}b.canvas=c}if(!b.transform)b.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,b)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);a=pv.Image.prototype;a.type="image";a.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);
a.image=function(b){this.$image=function(){var c=b.apply(this,arguments);return c==null?pv.Color.transparent:typeof c=="string"?pv.color(c):c};return this};a.bind=function(){pv.Bar.prototype.bind.call(this);var b=this.binds,c=this;do b.image=c.$image;while(!b.image&&(c=c.proto))};
a.buildImplied=function(b){pv.Bar.prototype.buildImplied.call(this,b);if(b.visible){if(b.imageWidth==null)b.imageWidth=b.width;if(b.imageHeight==null)b.imageHeight=b.height;if(b.url==null&&this.binds.image){var c=this.$canvas||(this.$canvas=document.createElement("canvas")),d=c.getContext("2d"),f=b.imageWidth,g=b.imageHeight,i=pv.Mark.stack;c.width=f;c.height=g;b=(b.image=d.createImageData(f,g)).data;i.unshift(null,null);for(d=c=0;c<g;c++){i[1]=c;for(var j=0;j<f;j++){i[0]=j;var k=this.binds.image.apply(this,
i);b[d++]=k.r;b[d++]=k.g;b[d++]=k.b;b[d++]=255*k.a}}i.splice(0,2)}}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);a=pv.Wedge.prototype;a.type="wedge";
a.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var b=this.sibling();return b?b.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));a.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};a.midAngle=function(){return(this.startAngle()+this.endAngle())/2};
a.anchor=function(b){function c(i){return i.innerRadius||i.angle<2*Math.PI}function d(i){return(i.innerRadius+i.outerRadius)/2}function f(i){return(i.startAngle+i.endAngle)/2}var g;return pv.Mark.prototype.anchor.call(this,b).def("$wedge.anchor",function(){g=this.scene.target}).left(function(){var i=g[this.index];if(c(i))switch(this.name()){case "outer":return i.left+i.outerRadius*Math.cos(f(i));case "inner":return i.left+i.innerRadius*Math.cos(f(i));case "start":return i.left+d(i)*Math.cos(i.startAngle);
case "center":return i.left+d(i)*Math.cos(f(i));case "end":return i.left+d(i)*Math.cos(i.endAngle)}return i.left}).top(function(){var i=g[this.index];if(c(i))switch(this.name()){case "outer":return i.top+i.outerRadius*Math.sin(f(i));case "inner":return i.top+i.innerRadius*Math.sin(f(i));case "start":return i.top+d(i)*Math.sin(i.startAngle);case "center":return i.top+d(i)*Math.sin(f(i));case "end":return i.top+d(i)*Math.sin(i.endAngle)}return i.top}).textAlign(function(){var i=g[this.index];if(c(i))switch(this.name()){case "outer":return pv.Wedge.upright(f(i))?
"right":"left";case "inner":return pv.Wedge.upright(f(i))?"left":"right"}return"center"}).textBaseline(function(){var i=g[this.index];if(c(i))switch(this.name()){case "start":return pv.Wedge.upright(i.startAngle)?"top":"bottom";case "end":return pv.Wedge.upright(i.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var i=g[this.index],j=0;if(c(i))switch(this.name()){case "center":case "inner":case "outer":j=f(i);break;case "start":j=i.startAngle;break;case "end":j=i.endAngle;break}return pv.Wedge.upright(j)?
j:j+Math.PI})};pv.Wedge.upright=function(b){b%=2*Math.PI;b=b<0?2*Math.PI+b:b;return b<Math.PI/2||b>3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(b){if(b.angle==null)b.angle=b.endAngle-b.startAngle;else if(b.endAngle==null)b.endAngle=b.startAngle+b.angle;pv.Mark.prototype.buildImplied.call(this,b)};pv.simulation=function(b){return new pv.Simulation(b)};pv.Simulation=function(b){for(var c=0;c<b.length;c++)this.particle(b[c])};a=pv.Simulation.prototype;
a.particle=function(b){b.next=this.particles;if(isNaN(b.px))b.px=b.x;if(isNaN(b.py))b.py=b.y;if(isNaN(b.fx))b.fx=0;if(isNaN(b.fy))b.fy=0;this.particles=b;return this};a.force=function(b){b.next=this.forces;this.forces=b;return this};a.constraint=function(b){b.next=this.constraints;this.constraints=b;return this};
a.stabilize=function(b){var c;arguments.length||(b=3);for(var d=0;d<b;d++){var f=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,f)}for(c=this.particles;c;c=c.next){c.px=c.x;c.py=c.y}return this};
a.step=function(){var b;for(b=this.particles;b;b=b.next){var c=b.px,d=b.py;b.px=b.x;b.py=b.y;b.x+=b.vx=b.x-c+b.fx;b.y+=b.vy=b.y-d+b.fy}c=new pv.Quadtree(this.particles);for(b=this.constraints;b;b=b.next)b.apply(this.particles,c);for(b=this.particles;b;b=b.next)b.fx=b.fy=0;for(b=this.forces;b;b=b.next)b.apply(this.particles,c)};
pv.Quadtree=function(b){function c(l,n,q,m,o,s){if(!(isNaN(n.x)||isNaN(n.y)))if(l.leaf)if(l.p){if(!(Math.abs(l.p.x-n.x)+Math.abs(l.p.y-n.y)<0.01)){var t=l.p;l.p=null;d(l,t,q,m,o,s)}d(l,n,q,m,o,s)}else l.p=n;else d(l,n,q,m,o,s)}function d(l,n,q,m,o,s){var t=(q+o)*0.5,u=(m+s)*0.5,z=n.x>=t,y=n.y>=u;l.leaf=false;switch((y<<1)+z){case 0:l=l.c1||(l.c1=new pv.Quadtree.Node);break;case 1:l=l.c2||(l.c2=new pv.Quadtree.Node);break;case 2:l=l.c3||(l.c3=new pv.Quadtree.Node);break;case 3:l=l.c4||(l.c4=new pv.Quadtree.Node);
break}if(z)q=t;else o=t;if(y)m=u;else s=u;c(l,n,q,m,o,s)}var f,g=Number.POSITIVE_INFINITY,i=g,j=Number.NEGATIVE_INFINITY,k=j;for(f=b;f;f=f.next){if(f.x<g)g=f.x;if(f.y<i)i=f.y;if(f.x>j)j=f.x;if(f.y>k)k=f.y}f=j-g;var p=k-i;if(f>p)k=i+f;else j=g+p;this.xMin=g;this.yMin=i;this.xMax=j;this.yMax=k;this.root=new pv.Quadtree.Node;for(f=b;f;f=f.next)c(this.root,f,g,i,j,k)};pv.Quadtree.Node=function(){this.leaf=true;this.p=this.c4=this.c3=this.c2=this.c1=this.next=null};pv.Force={};
pv.Force.charge=function(b){function c(l){function n(o){c(o);l.cn+=o.cn;q+=o.cn*o.cx;m+=o.cn*o.cy}var q=0,m=0;l.cn=0;if(!l.leaf){l.c1&&n(l.c1);l.c2&&n(l.c2);l.c3&&n(l.c3);l.c4&&n(l.c4)}if(l.p){l.cn+=b;q+=b*l.p.x;m+=b*l.p.y}l.cx=q/l.cn;l.cy=m/l.cn}function d(l,n,q,m,o,s){var t=l.cx-n.x,u=l.cy-n.y,z=1/Math.sqrt(t*t+u*u);if(l.leaf&&l.p!=n||(o-q)*z<k){if(!(z<j)){if(z>g)z=g;l=l.cn*z*z*z;t=t*l;u=u*l;n.fx+=t;n.fy+=u}}else if(!l.leaf){var y=(q+o)*0.5,r=(m+s)*0.5;l.c1&&d(l.c1,n,q,m,y,r);l.c2&&d(l.c2,n,y,m,
o,r);l.c3&&d(l.c3,n,q,r,y,s);l.c4&&d(l.c4,n,y,r,o,s);if(!(z<j)){if(z>g)z=g;if(l.p&&l.p!=n){l=b*z*z*z;t=t*l;u=u*l;n.fx+=t;n.fy+=u}}}}var f=2,g=1/f,i=500,j=1/i,k=0.9,p={};arguments.length||(b=-40);p.constant=function(l){if(arguments.length){b=Number(l);return p}return b};p.domain=function(l,n){if(arguments.length){f=Number(l);g=1/f;i=Number(n);j=1/i;return p}return[f,i]};p.theta=function(l){if(arguments.length){k=Number(l);return p}return k};p.apply=function(l,n){c(n.root);for(l=l;l;l=l.next)d(n.root,
l,n.xMin,n.yMin,n.xMax,n.yMax)};return p};pv.Force.drag=function(b){var c={};arguments.length||(b=0.1);c.constant=function(d){if(arguments.length){b=d;return c}return b};c.apply=function(d){if(b)for(d=d;d;d=d.next){d.fx=b*(d.fx-d.x+d.px);d.fy=b*(d.fy-d.y+d.py)}};return c};
pv.Force.spring=function(b){var c=0.1,d=20,f,g,i={};arguments.length||(b=0.1);i.links=function(j){if(arguments.length){f=j;g=j.map(function(k){return 1/Math.sqrt(Math.max(k.sourceNode.linkDegree,k.targetNode.linkDegree))});return i}return f};i.constant=function(j){if(arguments.length){b=Number(j);return i}return b};i.damping=function(j){if(arguments.length){c=Number(j);return i}return c};i.length=function(j){if(arguments.length){d=Number(j);return i}return d};i.apply=function(){for(var j=0;j<f.length;j++){var k=
f[j].sourceNode,p=f[j].targetNode,l=k.x-p.x,n=k.y-p.y,q=Math.sqrt(l*l+n*n),m=q?1/q:1;m=(b*g[j]*(q-d)+c*g[j]*(l*(k.vx-p.vx)+n*(k.vy-p.vy))*m)*m;l=-m*(q?l:0.01*(0.5-Math.random()));n=-m*(q?n:0.01*(0.5-Math.random()));k.fx+=l;k.fy+=n;p.fx-=l;p.fy-=n}};return i};pv.Constraint={};
pv.Constraint.collision=function(b){function c(l,n,q,m,o,s){if(!l.leaf){var t=(q+o)*0.5,u=(m+s)*0.5,z=u<k,y=t>g,r=t<j;if(u>i){l.c1&&y&&c(l.c1,n,q,m,t,u);l.c2&&r&&c(l.c2,n,t,m,o,u)}if(z){l.c3&&y&&c(l.c3,n,q,u,t,s);l.c4&&r&&c(l.c4,n,t,u,o,s)}}if(l.p&&l.p!=n){q=n.x-l.p.x;m=n.y-l.p.y;o=Math.sqrt(q*q+m*m);s=f+b(l.p);if(o<s){o=(o-s)/o*0.5;q*=o;m*=o;n.x-=q;n.y-=m;l.p.x+=q;l.p.y+=m}}}var d=1,f,g,i,j,k,p={};arguments.length||(f=10);p.repeat=function(l){if(arguments.length){d=Number(l);return p}return d};p.apply=
function(l,n){var q,m,o=-Infinity;for(q=l;q;q=q.next){m=b(q);if(m>o)o=m}for(var s=0;s<d;s++)for(q=l;q;q=q.next){m=(f=b(q))+o;g=q.x-m;j=q.x+m;i=q.y-m;k=q.y+m;c(n.root,q,n.xMin,n.yMin,n.xMax,n.yMax)}};return p};pv.Constraint.position=function(b){var c=1,d={};arguments.length||(b=function(f){return f.fix});d.alpha=function(f){if(arguments.length){c=Number(f);return d}return c};d.apply=function(f){for(f=f;f;f=f.next){var g=b(f);if(g){f.x+=(g.x-f.x)*c;f.y+=(g.y-f.y)*c}}};return d};
pv.Constraint.bound=function(){var b={},c,d;b.x=function(f,g){if(arguments.length){c={min:Math.min(f,g),max:Math.max(f,g)};return this}return c};b.y=function(f,g){if(arguments.length){d={min:Math.min(f,g),max:Math.max(f,g)};return this}return d};b.apply=function(f){if(c)for(var g=f;g;g=g.next)g.x=g.x<c.min?c.min:g.x>c.max?c.max:g.x;if(d)for(g=f;g;g=g.next)g.y=g.y<d.min?d.min:g.y>d.max?d.max:g.y};return b};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);
pv.Layout.prototype.property=function(b,c){this.propertyMethod(b,true,pv.Mark.cast[b]=c);return this};pv.Layout.prototype.bind=function(){pv.Panel.prototype.bind.call(this);var b=this.binds;if(!b.properties.init){var c=this.propertyValue("init",this.init);c.type=1;b.defs.push(c)}};pv.Layout.prototype.init=function(){};
pv.Layout.Network=function(){pv.Layout.call(this);var b=this;(this.node=(new pv.Mark).data(function(){return b.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(c){return c.x}).top(function(c){return c.y})).parent=this;this.link=(new pv.Mark).extend(this.node).data(function(c){return[c.sourceNode,c.targetNode]}).fillStyle(null).lineWidth(function(c,d){return d.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(c){return b.add(pv.Panel).data(function(){return b.links()}).add(c).extend(this)};
(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(c){return c.nodeName||c.nodeValue}).textAngle(function(c){c=c.midAngle;return pv.Wedge.upright(c)?c:c+Math.PI}).textAlign(function(c){return pv.Wedge.upright(c.midAngle)?"left":"right"})).parent=this};
pv.Layout.Network.prototype=pv.extend(pv.Layout).property("cache",Boolean).property("nodes",function(b){return b.map(function(c,d){if(typeof c!="object")c={nodeValue:c};c.index=d;c.linkDegree=0;return c})}).property("links",function(b){return b.map(function(c){if(isNaN(c.linkValue))c.linkValue=isNaN(c.value)?1:c.value;return c})});pv.Layout.Network.prototype.defaults=(new pv.Layout.Network).extend(pv.Layout.prototype.defaults).cache(true);
pv.Layout.Network.prototype.init=function(){var b=this.scene.defs.cache;if(this.scene.$cache&&b.value)return true;this.scene.$cache=true;b.id=0;var c=this.nodes();this.links().forEach(function(d){var f=d.sourceNode||(d.sourceNode=c[d.source]),g=d.targetNode||(d.targetNode=c[d.target]);d=d.linkValue;f.linkDegree+=d;g.linkDegree+=d})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);
pv.Layout.Hierarchy.prototype.bind=function(){pv.Layout.Network.prototype.bind.call(this);var b=this.binds;if(!b.properties.links){var c=this.propertyValue("links",pv.Layout.Hierarchy.links);c.type=1;b.defs.splice(b.defs.length-1,0,c)}};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(b){return b.parentNode}).map(function(b){return{sourceNode:b,targetNode:b.parentNode,linkValue:1}})};
pv.Layout.Hierarchy.NodeLink={init:function(){function b(m){return m.parentNode?m.depth*(l-p)+p:0}function c(m){return m.parentNode?(m.breadth-0.25)*2*Math.PI:0}function d(m){switch(i){case "left":return m.depth*j;case "right":return j-m.depth*j;case "top":return m.breadth*j;case "bottom":return j-m.breadth*j;case "radial":return j/2+b(m)*Math.cos(m.midAngle)}}function f(m){switch(i){case "left":return m.breadth*k;case "right":return k-m.breadth*k;case "top":return m.depth*k;case "bottom":return k-
m.depth*k;case "radial":return k/2+b(m)*Math.sin(m.midAngle)}}var g=this.nodes(),i=this.orient(),j=this.parent.width(),k=this.parent.height();if(i=="radial"){var p=this.innerRadius(),l=this.outerRadius();if(p==null)p=0;if(l==null)l=Math.min(j,k)/2}for(var n=0;n<g.length;n++){var q=g[n];q.midAngle=i=="radial"?c(q):0;q.x=d(q);q.y=f(q);if(q.firstChild)q.midAngle+=Math.PI}}};
pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(b){return b.dx}).height(function(b){return b.dy}).innerRadius(function(b){return b.innerRadius}).outerRadius(function(b){return b.outerRadius}).startAngle(function(b){return b.startAngle}).angle(function(b){return b.angle});this.label.textAlign("center").left(function(b){return b.x+b.dx/2}).top(function(b){return b.y+b.dy/2});delete this.link},init:function(){function b(r,v){return(r+v)/
(1+v)}function c(r){switch(n){case "left":return b(r.minDepth,s)*m;case "right":return(1-b(r.maxDepth,s))*m;case "top":return r.minBreadth*m;case "bottom":return(1-r.maxBreadth)*m;case "radial":return m/2}}function d(r){switch(n){case "left":return r.minBreadth*o;case "right":return(1-r.maxBreadth)*o;case "top":return b(r.minDepth,s)*o;case "bottom":return(1-b(r.maxDepth,s))*o;case "radial":return o/2}}function f(r){switch(n){case "left":case "right":return(r.maxDepth-r.minDepth)/(1+s)*m;case "top":case "bottom":return(r.maxBreadth-
r.minBreadth)*m;case "radial":return r.parentNode?(r.innerRadius+r.outerRadius)*Math.cos(r.midAngle):0}}function g(r){switch(n){case "left":case "right":return(r.maxBreadth-r.minBreadth)*o;case "top":case "bottom":return(r.maxDepth-r.minDepth)/(1+s)*o;case "radial":return r.parentNode?(r.innerRadius+r.outerRadius)*Math.sin(r.midAngle):0}}function i(r){return Math.max(0,b(r.minDepth,s/2))*(u-t)+t}function j(r){return b(r.maxDepth,s/2)*(u-t)+t}function k(r){return(r.parentNode?r.minBreadth-0.25:0)*
2*Math.PI}function p(r){return(r.parentNode?r.maxBreadth-r.minBreadth:1)*2*Math.PI}var l=this.nodes(),n=this.orient(),q=/^(top|bottom)$/.test(n),m=this.parent.width(),o=this.parent.height(),s=-l[0].minDepth;if(n=="radial"){var t=this.innerRadius(),u=this.outerRadius();if(t==null)t=0;if(t)s*=2;if(u==null)u=Math.min(m,o)/2}for(var z=0;z<l.length;z++){var y=l[z];y.x=c(y);y.y=d(y);if(n=="radial"){y.innerRadius=i(y);y.outerRadius=j(y);y.startAngle=k(y);y.angle=p(y);y.midAngle=y.startAngle+y.angle/2}else y.midAngle=
q?-Math.PI/2:0;y.dx=f(y);y.dy=g(y)}}};
pv.Layout.Grid=function(){pv.Layout.call(this);this.data(function(b){var c=this.rows(),d=this.cols();if(typeof d=="object")c=pv.transpose(d);if(typeof c=="object"){this.rows(c.length).cols(c[0]?c[0].length:0);return pv.blend(c)}return pv.repeat([b],c*d)}).width(function(){return this.parent.width()/this.cols()}).height(function(){return this.parent.height()/this.rows()}).left(function(){return this.width()*(this.index%this.cols())}).top(function(){return this.height()*Math.floor(this.index/this.cols())})};
pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1);
pv.Layout.Stack=function(){function b(g){return function(){return d[g](this.parent.index,this.index)}}pv.Layout.call(this);var c=function(){return null},d={t:c,l:c,r:c,b:c,w:c,h:c},f;this.init=function(){var g=this.layers(),i=g.length,j,k=this.orient(),p=/^(top|bottom)\b/.test(k),l=this.parent[p?"height":"width"](),n=[],q=[],m=[],o=pv.Mark.stack;o.unshift(null);f=[];for(var s=0;s<i;s++){m[s]=[];q[s]=[];pv.Mark.prototype.index=this.index=s;o[0]=g[s];f[s]=this.$values.apply(this,o);if(!s)j=f[s].length;
o.unshift(null);for(var t=0;t<j;t++){o[0]=f[s][t];pv.Mark.prototype.index=this.layer.index=t;s||(n[t]=this.$x.apply(this.layer,o));m[s][t]=this.$y.apply(this.layer,o)}o.shift()}delete this.layer.index;delete this.index;o.shift();switch(this.order()){case "inside-out":var u=m.map(function(A){return pv.max.index(A)});g=pv.range(i).sort(function(A,B){return u[A]-u[B]});o=m.map(function(A){return pv.sum(A)});var z=0,y=0,r=[],v=[];for(s=0;s<i;s++){t=g[s];if(z<y){z+=o[t];r.push(t)}else{y+=o[t];v.push(t)}}g=
v.reverse().concat(r);break;case "reverse":g=pv.range(i-1,-1,-1);break;default:g=pv.range(i);break}switch(this.offset()){case "silohouette":for(t=0;t<j;t++){for(s=o=0;s<i;s++)o+=m[s][t];q[g[0]][t]=(l-o)/2}break;case "wiggle":for(s=o=0;s<i;s++)o+=m[s][0];q[g[0]][0]=o=(l-o)/2;for(t=1;t<j;t++){y=l=0;r=n[t]-n[t-1];for(s=0;s<i;s++)l+=m[s][t];for(s=0;s<i;s++){v=(m[g[s]][t]-m[g[s]][t-1])/(2*r);for(z=0;z<s;z++)v+=(m[g[z]][t]-m[g[z]][t-1])/r;y+=v*m[g[s]][t]}q[g[0]][t]=o-=l?y/l*r:0}break;case "expand":for(t=
0;t<j;t++){for(s=z=q[g[0]][t]=0;s<i;s++)z+=m[s][t];if(z){z=l/z;for(s=0;s<i;s++)m[s][t]*=z}else{z=l/i;for(s=0;s<i;s++)m[s][t]=z}}break;default:for(t=0;t<j;t++)q[g[0]][t]=0;break}for(t=0;t<j;t++){o=q[g[0]][t];for(s=1;s<i;s++){o+=m[g[s-1]][t];q[g[s]][t]=o}}s=k.indexOf("-");i=p?"h":"w";j=s<0?p?"l":"b":k.charAt(s+1);k=s<0?p?"b":"l":k.charAt(0);for(var x in d)d[x]=c;d[j]=function(A,B){return n[B]};d[k]=function(A,B){return q[A][B]};d[i]=function(A,B){return m[A][B]}};(this.layer=(new pv.Mark).data(function(){return f[this.parent.index]}).top(b("t")).left(b("l")).right(b("r")).bottom(b("b")).width(b("w")).height(b("h"))).parent=
this};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");a=pv.Layout.Stack.prototype;a.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]).data(function(){return this.layers()});a.x=function(b){this.$x=pv.functor(b);return this};a.y=function(b){this.$y=pv.functor(b);return this};a.$values=pv.identity;
a.values=function(b){this.$values=pv.functor(b);return this};
pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(b){return b.dx}).height(function(b){return b.dy});this.label.visible(function(b){return!b.firstChild}).left(function(b){return b.x+b.dx/2}).top(function(b){return b.y+b.dy/2}).textAlign("center").textAngle(function(b){return b.dx>b.dy?0:-Math.PI/2});(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(b){return!b.firstChild})).parent=this;
delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);a=pv.Layout.Treemap.prototype;a.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");a.padding=function(b){return this.paddingLeft(b).paddingRight(b).paddingTop(b).paddingBottom(b)};
a.$size=Number;a.size=function(b){this.$size=pv.functor(b);return this};
a.init=function(){function b(o,s,t,u,z,y,r){for(var v=0,x=0;v<o.length;v++){var A=o[v];if(t){A.x=u+x;A.y=z;x+=A.dx=q(y*A.size/s);A.dy=r}else{A.x=u;A.y=z+x;A.dx=y;x+=A.dy=q(r*A.size/s)}}if(A)if(t)A.dx+=y-x;else A.dy+=r-x}function c(o,s){for(var t=-Infinity,u=Infinity,z=0,y=0;y<o.length;y++){var r=o[y].size;if(r<u)u=r;if(r>t)t=r;z+=r}z*=z;s*=s;return Math.max(s*t/z,z/(s*u))}function d(o,s){function t(C){var E=y==x,G=pv.sum(C,n),F=x?q(G/x):0;b(C,G,E,u,z,E?y:F,E?F:r);if(E){z+=F;r-=F}else{u+=F;y-=F}x=
Math.min(y,r);return E}var u=o.x+j,z=o.y+p,y=o.dx-j-k,r=o.dy-p-l;if(m!="squarify")b(o.childNodes,o.size,m=="slice"?true:m=="dice"?false:s&1,u,z,y,r);else{var v=[];s=Infinity;var x=Math.min(y,r),A=y*r/o.size;if(!(o.size<=0)){o.visitBefore(function(C){C.size*=A});for(o=o.childNodes.slice();o.length;){var B=o[o.length-1];if(B.size){v.push(B);A=c(v,x);if(A<=s){o.pop();s=A}else{v.pop();t(v);v.length=0;s=Infinity}}else o.pop()}if(t(v))for(s=0;s<v.length;s++)v[s].dy+=r;else for(s=0;s<v.length;s++)v[s].dx+=
y}}}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var f=this,g=f.nodes()[0],i=pv.Mark.stack,j=f.paddingLeft(),k=f.paddingRight(),p=f.paddingTop(),l=f.paddingBottom(),n=function(o){return o.size},q=f.round()?Math.round:Number,m=f.mode();i.unshift(null);g.visitAfter(function(o,s){o.depth=s;o.x=o.y=o.dx=o.dy=0;o.size=o.firstChild?pv.sum(o.childNodes,function(t){return t.size}):f.$size.apply(f,(i[0]=o.nodeValue,i))});i.shift();switch(f.order()){case "ascending":g.sort(function(o,s){return o.size-
s.size});break;case "descending":g.sort(function(o,s){return s.size-o.size});break;case "reverse":g.reverse();break}g.x=0;g.y=0;g.dx=f.parent.width();g.dy=f.parent.height();g.visitBefore(d)}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");
pv.Layout.Tree.prototype.init=function(){function b(r){var v,x,A;if(r.firstChild){v=r.firstChild;x=r.lastChild;for(var B=A=v;B;B=B.nextSibling){b(B);A=d(B,A)}j(r);x=0.5*(v.prelim+x.prelim);if(v=r.previousSibling){r.prelim=v.prelim+p(r.depth,true);r.mod=r.prelim-x}else r.prelim=x}else if(v=r.previousSibling)r.prelim=v.prelim+p(r.depth,true)}function c(r,v,x){r.breadth=r.prelim+v;v+=r.mod;for(r=r.firstChild;r;r=r.nextSibling)c(r,v,x)}function d(r,v){var x=r.previousSibling;if(x){var A=r,B=r,C=x;x=r.parentNode.firstChild;
var E=A.mod,G=B.mod,F=C.mod,J=x.mod;C=g(C);for(A=f(A);C&&A;){C=C;A=A;x=f(x);B=g(B);B.ancestor=r;var I=C.prelim+F-(A.prelim+E)+p(C.depth,false);if(I>0){i(k(C,r,v),r,I);E+=I;G+=I}F+=C.mod;E+=A.mod;J+=x.mod;G+=B.mod;C=g(C);A=f(A)}if(C&&!g(B)){B.thread=C;B.mod+=F-G}if(A&&!f(x)){x.thread=A;x.mod+=E-J;v=r}}return v}function f(r){return r.firstChild||r.thread}function g(r){return r.lastChild||r.thread}function i(r,v,x){var A=v.number-r.number;v.change-=x/A;v.shift+=x;r.change+=x/A;v.prelim+=x;v.mod+=x}function j(r){var v=
0,x=0;for(r=r.lastChild;r;r=r.previousSibling){r.prelim+=v;r.mod+=v;x+=r.change;v+=r.shift+x}}function k(r,v,x){return r.ancestor.parentNode==v.parentNode?r.ancestor:x}function p(r,v){return(v?1:u+1)/(o=="radial"?r:1)}function l(r){return o=="radial"?r.breadth/s:0}function n(r){switch(o){case "left":return r.depth;case "right":return z-r.depth;case "top":case "bottom":return r.breadth+z/2;case "radial":return z/2+r.depth*Math.cos(l(r))}}function q(r){switch(o){case "left":case "right":return r.breadth+
y/2;case "top":return r.depth;case "bottom":return y-r.depth;case "radial":return y/2+r.depth*Math.sin(l(r))}}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var m=this.nodes(),o=this.orient(),s=this.depth(),t=this.breadth(),u=this.group(),z=this.parent.width(),y=this.parent.height();m=m[0];m.visitAfter(function(r,v){r.ancestor=r;r.prelim=0;r.mod=0;r.change=0;r.shift=0;r.number=r.previousSibling?r.previousSibling.number+1:0;r.depth=v});b(m);c(m,-m.prelim,0);m.visitAfter(function(r){r.breadth*=
t;r.depth*=s;r.midAngle=l(r);r.x=n(r);r.y=q(r);if(r.firstChild)r.midAngle+=Math.PI;delete r.breadth;delete r.depth;delete r.ancestor;delete r.prelim;delete r.mod;delete r.change;delete r.shift;delete r.number;delete r.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);
pv.Layout.Indent.prototype.init=function(){function b(j,k,p){j.x=g+p++*f;j.y=i+k++*d;j.midAngle=0;for(j=j.firstChild;j;j=j.nextSibling)k=b(j,k,p);return k}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var c=this.nodes(),d=this.breadth(),f=this.depth(),g=0,i=0;b(c[0],1,1)}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.radius(function(b){return b.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};
pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(b){this.$radius=typeof b=="function"?function(){return Math.sqrt(b.apply(this,arguments))}:(b=Math.sqrt(b),function(){return b});return this};
pv.Layout.Pack.prototype.init=function(){function b(m){var o=pv.Mark.stack;o.unshift(null);for(var s=0,t=m.length;s<t;s++){var u=m[s];if(!u.firstChild){o[0]=u.nodeValue;u.radius=i.$radius.apply(i,o)}}o.shift()}function c(m){var o=[];for(m=m.firstChild;m;m=m.nextSibling){if(m.firstChild)m.radius=c(m);m.n=m.p=m;o.push(m)}switch(p){case "ascending":o.sort(function(s,t){return s.radius-t.radius});break;case "descending":o.sort(function(s,t){return t.radius-s.radius});break;case "reverse":o.reverse();
break}return d(o)}function d(m){function o(D){z=Math.min(D.x-D.radius,z);y=Math.max(D.x+D.radius,y);r=Math.min(D.y-D.radius,r);v=Math.max(D.y+D.radius,v)}function s(D,H){var K=D.n;D.n=H;H.p=D;H.n=K;K.p=H}function t(D,H){D.n=H;H.p=D}function u(D,H){var K=H.x-D.x,L=H.y-D.y;D=D.radius+H.radius;return D*D-K*K-L*L>0.001}var z=Infinity,y=-Infinity,r=Infinity,v=-Infinity,x,A,B,C,E;x=m[0];x.x=-x.radius;x.y=0;o(x);if(m.length>1){A=m[1];A.x=A.radius;A.y=0;o(A);if(m.length>2){B=m[2];f(x,A,B);o(B);s(x,B);x.p=
B;s(B,A);A=x.n;for(var G=3;G<m.length;G++){f(x,A,B=m[G]);var F=0,J=1,I=1;for(C=A.n;C!=A;C=C.n,J++)if(u(C,B)){F=1;break}if(F==1)for(E=x.p;E!=C.p;E=E.p,I++)if(u(E,B)){if(I<J){F=-1;C=E}break}if(F==0){s(x,B);A=B;o(B)}else if(F>0){t(x,C);A=C;G--}else if(F<0){t(C,A);x=C;G--}}}}x=(z+y)/2;A=(r+v)/2;for(G=B=0;G<m.length;G++){C=m[G];C.x-=x;C.y-=A;B=Math.max(B,C.radius+Math.sqrt(C.x*C.x+C.y*C.y))}return B+l}function f(m,o,s){var t=o.radius+s.radius,u=m.radius+s.radius,z=o.x-m.x;o=o.y-m.y;var y=Math.sqrt(z*z+
o*o),r=(u*u+y*y-t*t)/(2*u*y);t=Math.acos(r);r=r*u;u=Math.sin(t)*u;z/=y;o/=y;s.x=m.x+r*z+u*o;s.y=m.y+r*o-u*z}function g(m,o,s,t){for(var u=m.firstChild;u;u=u.nextSibling){u.x+=m.x;u.y+=m.y;g(u,o,s,t)}m.x=o+t*m.x;m.y=s+t*m.y;m.radius*=t}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var i=this,j=i.nodes(),k=j[0],p=i.order(),l=i.spacing();b(j);k.x=0;k.y=0;k.radius=c(k);j=this.parent.width();var n=this.parent.height(),q=1/Math.max(2*k.radius/j,2*k.radius/n);g(k,j/2,n/2,q)}};
pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,c){return Math.sqrt(c.linkValue)*1.5});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number);
pv.Layout.Force.prototype.init=function(){function b(l){return l.fix?1:l.vx*l.vx+l.vy*l.vy}if(pv.Layout.Network.prototype.init.call(this)){var c=this.scene.$force;if(c){c.next=this.binds.$force;this.binds.$force=c}}else{var d=this;c=d.nodes();for(var f=d.links(),g=this.iterations(),i=d.parent.width()/2,j=d.parent.height()/2,k=0,p;k<c.length;k++){p=c[k];if(isNaN(p.x))p.x=i+Math.random()-0.5;if(isNaN(p.y))p.y=j+Math.random()-0.5}i=pv.simulation(c);i.force(pv.Force.drag());i.force(pv.Force.charge());
i.force(pv.Force.spring().links(f));i.constraint(pv.Constraint.position());this.bound()&&i.constraint(pv.Constraint.bound().x(6,w-6).y(6,h-6));if(g==null){i.step();i.step();this.scene.$force=this.binds.$force={next:this.binds.$force,nodes:c,min:1.0E-4*(f.length+1),sim:i};if(!this.$timer)this.$timer=setInterval(function(){for(var l=false,n=d.binds.$force;n;n=n.next)if(pv.max(n.nodes,b)>n.min){l=Date.now();do n.sim.step();while(Date.now()-l<20);l=true}l&&d.parent.render()},42)}else for(k=0;k<g;k++)i.step()}};
pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var b,c=this.init;this.init=function(){var d=this.orient();b=/^(top|bottom)$/.test(d)?"step-before":/^(left|right)$/.test(d)?"step-after":"linear";c.call(this)};this.link.interpolate(function(){return b})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");
pv.Layout.Cluster.prototype.init=function(){if(!pv.Layout.Hierarchy.prototype.init.call(this)){var b=this.nodes()[0],c=this.group(),d,f,g=0,i=0.5-c/2,j=undefined;b.visitAfter(function(k){if(k.firstChild)k.depth=1+pv.max(k.childNodes,function(p){return p.depth});else{if(c&&j!=k.parentNode){j=k.parentNode;g+=c}g++;k.depth=0}});d=1/g;f=1/b.depth;j=undefined;b.visitAfter(function(k){if(k.firstChild)k.breadth=pv.mean(k.childNodes,function(p){return p.breadth});else{if(c&&j!=k.parentNode){j=k.parentNode;
i+=c}k.breadth=d*i++}k.depth=1-k.depth*f});b.visitAfter(function(k){k.minBreadth=k.firstChild?k.firstChild.minBreadth:k.breadth-d/2;k.maxBreadth=k.firstChild?k.lastChild.maxBreadth:k.breadth+d/2});b.visitBefore(function(k){k.minDepth=k.parentNode?k.parentNode.maxDepth:0;k.maxDepth=k.parentNode?k.depth+b.depth:k.minDepth+2*b.depth});b.minDepth=-f;pv.Layout.Hierarchy.NodeLink.init.call(this)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};
pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.init=function(){pv.Layout.Cluster.prototype.init.call(this)||pv.Layout.Hierarchy.Fill.init.call(this)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");
pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(b){this.$size=b;return this};
pv.Layout.Partition.prototype.init=function(){var b=this,c=b.nodes()[0],d=b.order(),f=pv.Mark.stack,g=0;f.unshift(null);c.visitAfter(function(j,k){if(k>g)g=k;j.size=j.firstChild?pv.sum(j.childNodes,function(p){return p.size}):b.$size.apply(b,(f[0]=j.nodeValue,f))});f.shift();switch(d){case "ascending":c.sort(function(j,k){return j.size-k.size});break;case "descending":c.sort(function(j,k){return k.size-j.size});break}var i=1/g;c.minBreadth=0;c.breadth=0.5;c.maxBreadth=1;c.visitBefore(function(j){for(var k=
j.minBreadth,p=j.maxBreadth-k,l=j.firstChild;l;l=l.nextSibling){l.minBreadth=k;l.maxBreadth=k+=l.size/j.size*p;l.breadth=(k+l.minBreadth)/2}});c.visitAfter(function(j,k){j.minDepth=(k-1)*i;j.maxDepth=j.depth=k*i});pv.Layout.Hierarchy.NodeLink.init.call(this)};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);
pv.Layout.Partition.Fill.prototype.init=function(){pv.Layout.Partition.prototype.init.call(this)||pv.Layout.Hierarchy.Fill.init.call(this)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,c,d,f=this.init;this.init=function(){var g=this.orient();c=this.directed();b=g=="radial"?"linear":"polar";d=g=="right"||g=="top";f.call(this)};this.link.data(function(g){var i=g.sourceNode;g=g.targetNode;return d!=(c||i.index<g.index)?[i,g]:[g,i]}).interpolate(function(){return b})};
pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");
pv.Layout.Arc.prototype.init=function(){function b(q){switch(g){case "top":return-Math.PI/2;case "bottom":return Math.PI/2;case "left":return Math.PI;case "right":return 0;case "radial":return(q-0.25)*2*Math.PI}}function c(q){switch(g){case "top":case "bottom":return q*i;case "left":return 0;case "right":return i;case "radial":return i/2+k*Math.cos(b(q))}}function d(q){switch(g){case "top":return 0;case "bottom":return j;case "left":case "right":return q*j;case "radial":return j/2+k*Math.sin(b(q))}}
if(!pv.Layout.Network.prototype.init.call(this))for(var f=this.nodes(),g=this.orient(),i=this.parent.width(),j=this.parent.height(),k=Math.min(i,j)/2,p=0;p<f.length;p++){var l=(p+0.5)/f.length,n=f[p];n.x=c(l);n.y=d(l);n.midAngle=b(l)}};
pv.Layout.Horizon=function(){pv.Layout.call(this);var b,c,d,f;this.data(function(){b=this.mode();c=Math.round((b=="color"?0.5:1)*this.parent.height());var g=this.bands(),i=this.backgroundStyle();d=pv.Scale.linear(0,g).range(i,this.negativeStyle());f=pv.Scale.linear(0,g).range(i,this.positiveStyle());return pv.range(g*2)}).overflow("hidden").height(function(){return c}).top(function(g){return b=="color"?(g&1)*c:0}).fillStyle(function(g){return g?null:this.backgroundStyle()});(this.band=(new pv.Mark).top(function(g,
i){return b=="mirror"&&i&1?(i+1>>1)*c:null}).bottom(function(g,i){return b=="mirror"?i&1?null:(i+1>>1)*-c:(i&1||-1)*(i+1>>1)*c}).fillStyle(function(g,i){return(i&1?d:f)((i>>1)+1)})).parent=this};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");
pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var b=this;this.node.data(function(){return b.scene.$rollup.nodes}).size(function(d){return d.nodes.length*20});var c=this.link.add;this.link.interpolate("polar").eccentricity(0.8).add=function(d){d=c.call(this,d);d.parent.data(function(){return b.scene.$rollup.links});return d}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(b){this.$x=pv.functor(b);return this};
pv.Layout.Rollup.prototype.y=function(b){this.$y=pv.functor(b);return this};
pv.Layout.Rollup.prototype.init=function(){function b(m){return i[m]+","+j[m]}if(!pv.Layout.Network.prototype.init.call(this)){var c=this.nodes(),d=this.links(),f=this.directed(),g=c.length,i=[],j=[],k=0,p={},l={},n=pv.Mark.stack;n.unshift(null);for(var q=0;q<g;q++){pv.Mark.prototype.index=this.index=q;n[0]=c[q];i[q]=this.$x.apply(this.node,n);j[q]=this.$y.apply(this.node,n)}delete this.index;n.shift();for(q=0;q<c.length;q++){g=b(q);n=p[g];if(!n){n=p[g]=pv.extend(c[q]);n.index=k++;n.x=i[q];n.y=j[q];
n.nodes=[]}n.nodes.push(c[q])}for(q=0;q<d.length;q++){k=d[q].targetNode;c=p[b(d[q].sourceNode.index)];k=p[b(k.index)];g=!f&&c.index>k.index?k.index+","+c.index:c.index+","+k.index;(n=l[g])||(n=l[g]={sourceNode:c,targetNode:k,linkValue:0,links:[]});n.links.push(d[q]);n.linkValue+=d[q].linkValue}this.scene.$rollup={nodes:pv.values(p),links:pv.values(l)}}};
pv.Layout.Matrix=function(){function b(){return c.scene.$matrix}pv.Layout.Network.call(this);var c=this;this.link.data(function(){return b().pairs}).left(function(){return b().dx*(this.index%b().n)}).top(function(){return b().dy*Math.floor(this.index/b().n)}).width(function(){return b().dx}).height(function(){return b().dy}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(d){return d.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return b().labels}).left(function(){return this.index&
1?b().dx*((this.index>>1)+0.5):null}).top(function(){return this.index&1?null:b().dy*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(b){this.$sort=b;return this};
pv.Layout.Matrix.prototype.init=function(){if(!pv.Layout.Network.prototype.init.call(this)){var b=this.nodes(),c=this.links(),d=this.directed(),f=this.$sort,g=b.length,i=pv.range(g),j=this.scene.$matrix={n:g,dx:this.parent.width()/g,dy:this.parent.height()/g,labels:[],pairs:[]},k={};f&&i.sort(function(m,o){return f(b[m],b[o])});for(var p=0;p<g;p++)for(var l=0;l<g;l++){var n=i[p],q=i[l];j.pairs.push(k[n+"."+q]={row:p,col:l,sourceNode:b[n],targetNode:b[q],linkValue:0})}for(p=0;p<g;p++){n=i[p];j.labels.push(b[n],
b[n])}for(p=0;p<c.length;p++){j=c[p];g=j.sourceNode.index;i=j.targetNode.index;j=j.linkValue;k[g+"."+i].linkValue+=j;d||(k[i+"."+g].linkValue+=j)}}};pv.Behavior={};
pv.Behavior.drag=function(){function b(p){g=this.index;f=this.scene;var l=this.mouse();j=((i=p).fix=pv.vector(p.x,p.y)).minus(l);k={x:this.parent.width()-(p.dx||0),y:this.parent.height()-(p.dy||0)}}function c(){f&&f.mark.context(f,g,function(){var p=this.mouse();i.x=i.fix.x=Math.max(0,Math.min(j.x+p.x,k.x));i.y=i.fix.y=Math.max(0,Math.min(j.y+p.y,k.y));this.parent.render()})}function d(){if(f){i.fix=null;f.mark.context(f,g,function(){this.parent.render()});f=null}}var f,g,i,j,k;b.render=function(p){render=
p;return b};pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",d);return b};
pv.Behavior.point=function(b){function c(l,n){l=l[n];n={cost:Infinity};for(var q=0,m=l.visible&&l.children.length;q<m;q++){var o=l.children[q],s=o.mark,t;if(s.type=="panel"){s.scene=o;for(var u=0,z=o.length;u<z;u++){s.index=u;t=c(o,u);if(t.cost<n.cost)n=t}delete s.scene;delete s.index}else if(s.$handlers.point){s=s.mouse();u=0;for(z=o.length;u<z;u++){var y=o[u];t=s.x-y.left;y=s.y-y.top;var r=j*t*t+k*y*y;if(r<n.cost){n.distance=t*t+y*y;n.cost=r;n.scene=o;n.index=u}}}}return n}function d(){var l=c(this.scene,
this.index);if(l.cost==Infinity||l.distance>p)l=null;if(g){if(l&&g.scene==l.scene&&g.index==l.index)return;pv.Mark.dispatch("unpoint",g.scene,g.index)}if(g=l){pv.Mark.dispatch("point",l.scene,l.index);pv.listen(this.root.canvas(),"mouseout",f)}}function f(l){if(g&&!pv.ancestor(this,l.relatedTarget)){pv.Mark.dispatch("unpoint",g.scene,g.index);g=null}}var g,i=null,j=1,k=1,p=arguments.length?b*b:900;d.collapse=function(l){if(arguments.length){i=String(l);switch(i){case "y":j=1;k=0;break;case "x":j=
0;k=1;break;default:k=j=1;break}return d}return i};return d};
pv.Behavior.select=function(){function b(k){g=this.index;f=this.scene;j=this.mouse();i=k;i.x=j.x;i.y=j.y;i.dx=i.dy=0}function c(){f&&f.mark.context(f,g,function(){var k=this.mouse();i.x=Math.max(0,Math.min(j.x,k.x));i.y=Math.max(0,Math.min(j.y,k.y));i.dx=Math.min(this.width(),Math.max(k.x,j.x))-i.x;i.dy=Math.min(this.height(),Math.max(k.y,j.y))-i.y;this.parent.render()})}function d(){f=null}var f,g,i,j;pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",d);return b};
pv.Behavior.pan=function(){function b(){g=this.index;f=this.scene;j=pv.vector(pv.event.pageX,pv.event.pageY);i=this.transform();k=1/(i.k*this.scale)}function c(){f&&f.mark.context(f,g,function(){this.transform(i.translate((pv.event.pageX-j.x)*k,(pv.event.pageY-j.y)*k)).render()})}function d(){f=null}var f,g,i,j,k;pv.listen(window,"mousemove",c);pv.listen(window,"mouseup",d);return b};
pv.Behavior.zoom=function(b){arguments.length||(b=1/48);return function(){var c=this.mouse(),d=pv.event.wheel*b;this.transform(this.transform().translate(c.x,c.y).scale(d<0?1E3/(1E3-d):(1E3+d)/1E3).translate(-c.x,-c.y)).render()}};pv.Geo=function(){};
pv.Geo.projections={mercator:{project:function(b){return{x:b.lng/180,y:b.lat>85?1:b.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(b.lat)/2))/Math.PI}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(2*Math.atan(Math.exp(b.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(b){return{x:b.lng/180,y:Math.sin(pv.radians(b.lat))}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(Math.asin(b.y))}}},sinusoidal:{project:function(b){return{x:pv.radians(b.lng)*Math.cos(pv.radians(b.lat))/
Math.PI,y:b.lat/90}},invert:function(b){return{lng:pv.degrees(b.x*Math.PI/Math.cos(b.y*Math.PI/2)),lat:b.y*90}}},aitoff:{project:function(b){var c=pv.radians(b.lng);b=pv.radians(b.lat);var d=Math.acos(Math.cos(b)*Math.cos(c/2));return{x:2*(d?Math.cos(b)*Math.sin(c/2)*d/Math.sin(d):0)/Math.PI,y:2*(d?Math.sin(b)*d/Math.sin(d):0)/Math.PI}},invert:function(b){var c=b.y*Math.PI/2;return{lng:pv.degrees(b.x*Math.PI/2/Math.cos(c)),lat:pv.degrees(c)}}},hammer:{project:function(b){var c=pv.radians(b.lng);b=
pv.radians(b.lat);var d=Math.sqrt(1+Math.cos(b)*Math.cos(c/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(c/2)/d/3,y:Math.SQRT2*Math.sin(b)/d/1.5}},invert:function(b){var c=b.x*3;b=b.y*1.5;var d=Math.sqrt(1-c*c/16-b*b/4);return{lng:pv.degrees(2*Math.atan2(d*c,2*(2*d*d-1))),lat:pv.degrees(Math.asin(d*b))}}},identity:{project:function(b){return{x:b.lng/180,y:b.lat/90}},invert:function(b){return{lng:b.x*180,lat:b.y*90}}}};
pv.Geo.scale=function(b){function c(n){if(!p||n.lng!=p.lng||n.lat!=p.lat){p=n;n=i.project(n);l={x:j(n.x),y:k(n.y)}}return l}var d={x:0,y:0},f={x:1,y:1},g=[],i=pv.Geo.projections.identity,j=pv.Scale.linear(-1,1).range(0,1),k=pv.Scale.linear(-1,1).range(1,0),p,l;c.x=function(n){return c(n).x};c.y=function(n){return c(n).y};c.ticks={lng:function(n){var q;if(g.length>1){var m=pv.Scale.linear();if(n==undefined)n=10;q=m.domain(g,function(o){return o.lat}).ticks(n);n=m.domain(g,function(o){return o.lng}).ticks(n)}else{q=
pv.range(-80,81,10);n=pv.range(-180,181,10)}return n.map(function(o){return q.map(function(s){return{lat:s,lng:o}})})},lat:function(n){return pv.transpose(c.ticks.lng(n))}};c.invert=function(n){return i.invert({x:j.invert(n.x),y:k.invert(n.y)})};c.domain=function(n,q){if(arguments.length){g=n instanceof Array?arguments.length>1?pv.map(n,q):n:Array.prototype.slice.call(arguments);if(g.length>1){var m=g.map(i.project);j.domain(m,function(o){return o.x});k.domain(m,function(o){return o.y})}else{j.domain(-1,
1);k.domain(-1,1)}p=null;return this}return g};c.range=function(n,q){if(arguments.length){if(typeof n=="object"){d={x:Number(n.x),y:Number(n.y)};f={x:Number(q.x),y:Number(q.y)}}else{d={x:0,y:0};f={x:Number(n),y:Number(q)}}j.range(d.x,f.x);k.range(f.y,d.y);p=null;return this}return[d,f]};c.projection=function(n){if(arguments.length){i=typeof n=="string"?pv.Geo.projections[n]||pv.Geo.projections.identity:n;return this.domain(g)}return n};c.by=function(n){function q(){return c(n.apply(this,arguments))}
for(var m in c)q[m]=c[m];return q};arguments.length&&c.projection(b);return c};pv.listen(window,"load",function(){for(pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis")try{window.eval(pv.parse(pv.$.s.text))}catch(b){pv.error(b)}}delete pv.$});
