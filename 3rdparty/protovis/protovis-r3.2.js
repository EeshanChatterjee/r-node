// 07e31b5
var a;if(!Array.prototype.map)Array.prototype.map=function(b,d){for(var f=this.length,g=new Array(f),h=0;h<f;h++)if(h in this)g[h]=b.call(d,this[h],h,this);return g};if(!Array.prototype.filter)Array.prototype.filter=function(b,d){for(var f=this.length,g=[],h=0;h<f;h++)if(h in this){var j=this[h];b.call(d,j,h,this)&&g.push(j)}return g};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,d){for(var f=this.length>>>0,g=0;g<f;g++)g in this&&b.call(d,this[g],g,this)};
if(!Array.prototype.reduce)Array.prototype.reduce=function(b,d){var f=this.length;if(!f&&arguments.length==1)throw new Error("reduce: empty array, no initial value");var g=0;if(arguments.length<2)for(;;){if(g in this){d=this[g++];break}if(++g>=f)throw new Error("reduce: no values, no initial value");}for(;g<f;g++)if(g in this)d=b(d,this[g],g,this);return d};var pv={};pv.version={major:3,minor:2};pv.identity=function(b){return b};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};
pv.parent=function(){return this.parent.index};pv.extend=function(b){function d(){}d.prototype=b.prototype||b;return new d};
try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(b){for(var d=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),f,g,h=0,j="";f=d.exec(b);){f=f.index+f[0].length;if(b.charAt(f)!="{"){j+=b.substring(h,f)+"{return ";h=f;for(var i=0;i>=0&&f<b.length;f++){var k=b.charAt(f);switch(k){case '"':case "'":for(;++f<b.length&&(g=b.charAt(f))!=k;)g=="\\"&&f++;break;case "[":case "(":i++;break;case "]":case ")":i--;break;case ";":case ",":i==0&&i--;break}}j+=pv.parse(b.substring(h,--f))+
";}";h=f}d.lastIndex=f}j+=b.substring(h);return j}}pv.css=function(b,d){return window.getComputedStyle?window.getComputedStyle(b,null).getPropertyValue(d):b.currentStyle[d]};pv.error=function(b){typeof console=="undefined"?alert(b):console.error(b)};pv.listen=function(b,d,f){f=pv.listener(f);return b.addEventListener?b.addEventListener(d,f,false):b.attachEvent("on"+d,f)};pv.listener=function(b){return b.$listener||(b.$listener=function(d){try{pv.event=d;return b.call(this,d)}finally{delete pv.event}})};
pv.ancestor=function(b,d){for(;d;){if(d==b)return true;d=d.parentNode}return false};pv.id=function(){var b=1;return function(){return b++}}();pv.Format={};pv.Format.re=function(b){return b.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(b,d,f){d=d-String(f).length;return d<1?f:(new Array(d+1)).join(b)+f};
pv.Format.date=function(b){function d(g){return b.replace(/%[a-zA-Z0-9]/g,function(h){switch(h){case "%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][g.getDay()];case "%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][g.getDay()];case "%h":case "%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][g.getMonth()];case "%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][g.getMonth()];
case "%c":return g.toLocaleString();case "%C":return f("0",2,Math.floor(g.getFullYear()/100)%100);case "%d":return f("0",2,g.getDate());case "%x":case "%D":return f("0",2,g.getMonth()+1)+"/"+f("0",2,g.getDate())+"/"+f("0",2,g.getFullYear()%100);case "%e":return f(" ",2,g.getDate());case "%H":return f("0",2,g.getHours());case "%I":return(h=g.getHours()%12)?f("0",2,h):12;case "%m":return f("0",2,g.getMonth()+1);case "%M":return f("0",2,g.getMinutes());case "%n":return"\n";case "%p":return g.getHours()<
12?"AM":"PM";case "%T":case "%X":case "%r":h=g.getHours()%12;return(h?f("0",2,h):12)+":"+f("0",2,g.getMinutes())+":"+f("0",2,g.getSeconds())+" "+(g.getHours()<12?"AM":"PM");case "%R":return f("0",2,g.getHours())+":"+f("0",2,g.getMinutes());case "%S":return f("0",2,g.getSeconds());case "%Q":return f("0",3,g.getMilliseconds());case "%t":return"\t";case "%u":return(h=g.getDay())?h:1;case "%w":return g.getDay();case "%y":return f("0",2,g.getFullYear()%100);case "%Y":return g.getFullYear();case "%%":return"%"}return h})}
var f=pv.Format.pad;d.parse=function(g){var h=1970,j=0,i=1,k=0,o=0,m=0,n=[function(){}],q=pv.Format.re(b).replace(/%[a-zA-Z0-9]/g,function(l){switch(l){case "%b":n.push(function(p){j={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[p]});return"([A-Za-z]+)";case "%h":case "%B":n.push(function(p){j={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[p]});return"([A-Za-z]+)";case "%e":case "%d":n.push(function(p){i=
p});return"([0-9]+)";case "%I":case "%H":n.push(function(p){k=p});return"([0-9]+)";case "%m":n.push(function(p){j=p-1});return"([0-9]+)";case "%M":n.push(function(p){o=p});return"([0-9]+)";case "%p":n.push(function(p){if(k==12){if(p=="am")k=0}else if(p=="pm")k=Number(k)+12});return"(am|pm)";case "%S":n.push(function(p){m=p});return"([0-9]+)";case "%y":n.push(function(p){p=Number(p);h=p+(0<=p&&p<69?2E3:p>=69&&p<100?1900:0)});return"([0-9]+)";case "%Y":n.push(function(p){h=p});return"([0-9]+)";case "%%":n.push(function(){});
return"%"}return l});(g=g.match(q))&&g.forEach(function(l,p){n[p](l)});return new Date(h,j,i,k,o,m)};return d};
pv.Format.time=function(b){function d(g){g=Number(g);switch(b){case "short":if(g>=31536E6)return(g/31536E6).toFixed(1)+" years";else if(g>=6048E5)return(g/6048E5).toFixed(1)+" weeks";else if(g>=864E5)return(g/864E5).toFixed(1)+" days";else if(g>=36E5)return(g/36E5).toFixed(1)+" hours";else if(g>=6E4)return(g/6E4).toFixed(1)+" minutes";return(g/1E3).toFixed(1)+" seconds";case "long":var h=[],j=g%36E5/6E4>>0;h.push(f("0",2,g%6E4/1E3>>0));if(g>=36E5){var i=g%864E5/36E5>>0;h.push(f("0",2,j));if(g>=864E5){h.push(f("0",
2,i));h.push(Math.floor(g/864E5).toFixed())}else h.push(i.toFixed())}else h.push(j.toFixed());return h.reverse().join(":")}}var f=pv.Format.pad;d.parse=function(g){switch(b){case "short":for(var h=/([0-9,.]+)\s*([a-z]+)/g,j,i=0;j=h.exec(g);){var k=parseFloat(j[0].replace(",","")),o=0;switch(j[2].toLowerCase()){case "year":case "years":o=31536E6;break;case "week":case "weeks":o=6048E5;break;case "day":case "days":o=864E5;break;case "hour":case "hours":o=36E5;break;case "minute":case "minutes":o=6E4;
break;case "second":case "seconds":o=1E3;break}i+=k*o}return i;case "long":j=g.replace(",","").split(":").reverse();i=0;if(j.length)i+=parseFloat(j[0])*1E3;if(j.length>1)i+=parseFloat(j[1])*6E4;if(j.length>2)i+=parseFloat(j[2])*36E5;if(j.length>3)i+=parseFloat(j[3])*864E5;return i}};return d};
pv.Format.number=function(){function b(l){if(Infinity>j)l=Math.round(l*i)/i;var p=String(Math.abs(l)).split("."),t=p[0];l=l<0?"-":"";if(t.length>f)t=t.substring(t.length-f);if(m&&t.length<d)t=l+(new Array(d-t.length+1)).join(k)+t;if(t.length>3)t=t.replace(/\B(?=(?:\d{3})+(?!\d))/g,q);if(!m&&t.length<g)t=(new Array(g-t.length+1)).join(k)+l+t;p[0]=t;t=p[1]||"";if(t.length<h)p[1]=t+(new Array(h-t.length+1)).join(o);return p.join(n)}var d=0,f=Infinity,g=0,h=0,j=0,i=1,k="0",o="0",m=true,n=".",q=",";b.parse=
function(l){var p=pv.Format.re;l=String(l).replace(new RegExp("^("+p(k)+")*"),"").replace(new RegExp("("+p(o)+")*$"),"").split(n);p=l[0].replace(new RegExp(p(q),"g"),"");if(p.length>f)p=p.substring(p.length-f);l=l[1]?Number("0."+l[1]):0;if(Infinity>j)l=Math.round(l*i)/i;return Math.round(p)+l};b.integerDigits=function(l,p){if(arguments.length){d=Number(l);f=arguments.length>1?Number(p):d;g=d+Math.floor(d/3)*q.length;return this}return[d,f]};b.fractionDigits=function(l,p){if(arguments.length){h=Number(l);
j=arguments.length>1?Number(p):h;i=Math.pow(10,j);return this}return[h,j]};b.integerPad=function(l){if(arguments.length){k=String(l);m=/\d/.test(k);return this}return k};b.fractionPad=function(l){if(arguments.length){o=String(l);return this}return o};b.decimal=function(l){if(arguments.length){n=String(l);return this}return n};b.group=function(l){if(arguments.length){q=l?String(l):"";g=d+Math.floor(d/3)*q.length;return this}return q};return b};pv.Format.csv=function(){return new pv.CsvFormat};
pv.CsvFormat=function(){};pv.CsvFormat.prototype.header=function(b){if(arguments.length){this.$header=b;return this}return this.$header};
pv.CsvFormat.prototype.parse=function(b){function d(){if(j.lastIndex==b.length)return g;if(k){k=false;return f}var q=j.lastIndex;if(b.charAt(q)=='"'){var l=q;a:for(;l++<b.length;)switch(b.charAt(l)){case '"':if(b.charAt(l+1)=='"'){l++;break}break a}if(b.charAt(l+1)=="\n")k=true;j.lastIndex=l+2;return b.substring(q+1,l).replace(/""/g,'"')}if(l=j.exec(b)){if(l[0]=="\n")k=true;return b.substring(q,l.index)}j.lastIndex=b.length;return b.substring(q)}var f={},g={},h=[],j=/[,\n]/g,i,k;if(this.$header){for(var o=
[];(i=d())!==f&&i!==g;)o.push(i);for(;(i=d())!==g;){var m={},n=0;for(h.push(m);i!==f&&i!==g;){m[o[n++]]=i;i=d()}}}else for(;(i=d())!==g;){o=[];for(h.push(o);i!==f&&i!==g;){o.push(i);i=d()}}return h};
pv.CsvFormat.prototype.format=function(b){if(!b.length)return"";var d=[];if(this.$header){var f=pv.keys(b[0]);d.push(f.map(pv.CsvFormat.quote).join(","));for(var g=0;g<b.length;g++)d.push(f.map(function(h){return pv.CsvFormat.quote(b[g][h])}).join(","))}else for(g=0;g<b.length;g++)d.push(b[g].map(pv.CsvFormat.quote).join(","));return d.join("\n")};pv.CsvFormat.quote=function(b){return/[",\n]/.test(b)?'"'+b.replace(/\"/g,'""')+'"':b};
pv.map=function(b,d){var f={};return d?b.map(function(g,h){f.index=h;return d.call(f,g)}):b.slice()};pv.repeat=function(b,d){if(arguments.length==1)d=2;return pv.blend(pv.range(d).map(function(){return b}))};pv.cross=function(b,d){for(var f=[],g=0,h=b.length,j=d.length;g<h;g++)for(var i=0,k=b[g];i<j;i++)f.push([k,d[i]]);return f};pv.blend=function(b){return Array.prototype.concat.apply([],b)};
pv.transpose=function(b){var d=b.length,f=pv.max(b,function(i){return i.length});if(f>d){b.length=f;for(var g=d;g<f;g++)b[g]=new Array(d);for(g=0;g<d;g++)for(var h=g+1;h<f;h++){var j=b[g][h];b[g][h]=b[h][g];b[h][g]=j}}else{for(g=0;g<f;g++)b[g].length=d;for(g=0;g<d;g++)for(h=0;h<g;h++){j=b[g][h];b[g][h]=b[h][g];b[h][g]=j}}b.length=f;for(g=0;g<f;g++)b[g].length=d;return b};pv.normalize=function(b,d){b=pv.map(b,d);d=pv.sum(b);for(var f=0;f<b.length;f++)b[f]/=d;return b};
pv.permute=function(b,d,f){if(!f)f=pv.identity;var g=new Array(d.length),h={};d.forEach(function(j,i){h.index=j;g[i]=f.call(h,b[j])});return g};pv.numerate=function(b,d){if(!d)d=pv.identity;var f={},g={};b.forEach(function(h,j){g.index=j;f[d.call(g,h)]=j});return f};pv.naturalOrder=function(b,d){return b<d?-1:b>d?1:0};pv.reverseOrder=function(b,d){return d<b?-1:d>b?1:0};
pv.search=function(b,d,f){if(!f)f=pv.identity;for(var g=0,h=b.length-1;g<=h;){var j=g+h>>1,i=f(b[j]);if(i<d)g=j+1;else if(i>d)h=j-1;else return j}return-g-1};pv.search.index=function(b,d,f){b=pv.search(b,d,f);return b<0?-b-1:b};pv.range=function(b,d,f){if(arguments.length==1){d=b;b=0}if(f==undefined)f=1;if((d-b)/f==Infinity)throw new Error("range must be finite");var g=[],h=0,j;if(f<0)for(;(j=b+f*h++)>d;)g.push(j);else for(;(j=b+f*h++)<d;)g.push(j);return g};
pv.random=function(b,d,f){if(arguments.length==1){d=b;b=0}if(f==undefined)f=1;return f?Math.floor(Math.random()*(d-b)/f)*f+b:Math.random()*(d-b)+b};pv.sum=function(b,d){var f={};return b.reduce(d?function(g,h,j){f.index=j;return g+d.call(f,h)}:function(g,h){return g+h},0)};pv.max=function(b,d){if(d==pv.index)return b.length-1;return Math.max.apply(null,d?pv.map(b,d):b)};
pv.max.index=function(b,d){if(!b.length)return-1;if(d==pv.index)return b.length-1;if(!d)d=pv.identity;for(var f=0,g=-Infinity,h={},j=0;j<b.length;j++){h.index=j;var i=d.call(h,b[j]);if(i>g){g=i;f=j}}return f};pv.min=function(b,d){if(d==pv.index)return 0;return Math.min.apply(null,d?pv.map(b,d):b)};pv.min.index=function(b,d){if(!b.length)return-1;if(d==pv.index)return 0;if(!d)d=pv.identity;for(var f=0,g=Infinity,h={},j=0;j<b.length;j++){h.index=j;var i=d.call(h,b[j]);if(i<g){g=i;f=j}}return f};
pv.mean=function(b,d){return pv.sum(b,d)/b.length};pv.median=function(b,d){if(d==pv.index)return(b.length-1)/2;b=pv.map(b,d).sort(pv.naturalOrder);if(b.length%2)return b[Math.floor(b.length/2)];d=b.length/2;return(b[d-1]+b[d])/2};pv.variance=function(b,d){if(b.length<1)return NaN;if(b.length==1)return 0;var f=pv.mean(b,d),g=0,h={};if(!d)d=pv.identity;for(var j=0;j<b.length;j++){h.index=j;var i=d.call(h,b[j])-f;g+=i*i}return g};
pv.deviation=function(b,d){return Math.sqrt(pv.variance(b,d)/(b.length-1))};pv.log=function(b,d){return Math.log(b)/Math.log(d)};pv.logSymmetric=function(b,d){return b==0?0:b<0?-pv.log(-b,d):pv.log(b,d)};pv.logAdjusted=function(b,d){if(!isFinite(b))return b;var f=b<0;if(b<d)b+=(d-b)/d;return f?-pv.log(b,d):pv.log(b,d)};pv.logFloor=function(b,d){return b>0?Math.pow(d,Math.floor(pv.log(b,d))):-Math.pow(d,-Math.floor(-pv.log(-b,d)))};
pv.logCeil=function(b,d){return b>0?Math.pow(d,Math.ceil(pv.log(b,d))):-Math.pow(d,-Math.ceil(-pv.log(-b,d)))};(function(){var b=Math.PI/180,d=180/Math.PI;pv.radians=function(f){return b*f};pv.degrees=function(f){return d*f}})();pv.keys=function(b){var d=[];for(var f in b)d.push(f);return d};pv.entries=function(b){var d=[];for(var f in b)d.push({key:f,value:b[f]});return d};pv.values=function(b){var d=[];for(var f in b)d.push(b[f]);return d};
pv.dict=function(b,d){for(var f={},g={},h=0;h<b.length;h++)if(h in b){var j=b[h];g.index=h;f[j]=d.call(g,j)}return f};pv.dom=function(b){return new pv.Dom(b)};pv.Dom=function(b){this.$map=b};pv.Dom.prototype.$leaf=function(b){return typeof b!="object"};pv.Dom.prototype.leaf=function(b){if(arguments.length){this.$leaf=b;return this}return this.$leaf};
pv.Dom.prototype.root=function(b){function d(h){var j=new pv.Dom.Node;for(var i in h){var k=h[i];j.appendChild(f(k)?new pv.Dom.Node(k):d(k)).nodeName=i}return j}var f=this.$leaf,g=d(this.$map);g.nodeName=b;return g};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(b){this.nodeValue=b;this.childNodes=[]};a=pv.Dom.Node.prototype;a.parentNode=null;a.firstChild=null;a.lastChild=null;a.previousSibling=null;a.nextSibling=null;
a.removeChild=function(b){var d=this.childNodes.indexOf(b);if(d==-1)throw new Error("child not found");this.childNodes.splice(d,1);if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;delete b.nextSibling;delete b.previousSibling;delete b.parentNode;return b};
a.appendChild=function(b){b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;if(b.previousSibling=this.lastChild)this.lastChild.nextSibling=b;else this.firstChild=b;this.lastChild=b;this.childNodes.push(b);return b};
a.insertBefore=function(b,d){if(!d)return this.appendChild(b);var f=this.childNodes.indexOf(d);if(f==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=d;if(b.previousSibling=d.previousSibling)d.previousSibling.nextSibling=b;else{if(d==this.lastChild)this.lastChild=b;this.firstChild=b}this.childNodes.splice(f,0,b);return b};
a.replaceChild=function(b,d){var f=this.childNodes.indexOf(d);if(f==-1)throw new Error("child not found");b.parentNode&&b.parentNode.removeChild(b);b.parentNode=this;b.nextSibling=d.nextSibling;if(b.previousSibling=d.previousSibling)d.previousSibling.nextSibling=b;else this.firstChild=b;if(d.nextSibling)d.nextSibling.previousSibling=b;else this.lastChild=b;this.childNodes[f]=b;return d};a.visitBefore=function(b){function d(f,g){b(f,g);for(f=f.firstChild;f;f=f.nextSibling)d(f,g+1)}d(this,0)};
a.visitAfter=function(b){function d(f,g){for(var h=f.firstChild;h;h=h.nextSibling)d(h,g+1);b(f,g)}d(this,0)};a.sort=function(b){if(this.firstChild){this.childNodes.sort(b);var d=this.firstChild=this.childNodes[0],f;delete d.previousSibling;for(var g=1;g<this.childNodes.length;g++){d.sort(b);f=this.childNodes[g];f.previousSibling=d;d=d.nextSibling=f}this.lastChild=d;delete d.nextSibling;d.sort(b)}return this};
a.reverse=function(){var b=[];this.visitAfter(function(d){for(;d.lastChild;)b.push(d.removeChild(d.lastChild));for(var f;f=b.pop();)d.insertBefore(f,d.firstChild)});return this};a.nodes=function(){function b(f){d.push(f);f.childNodes.forEach(b)}var d=[];b(this,d);return d};
a.toggle=function(b){if(b)return this.toggled?this.visitBefore(function(f){f.toggled&&f.toggle()}):this.visitAfter(function(f){f.toggled||f.toggle()});b=this;if(b.toggled){for(var d;d=b.toggled.pop();)b.appendChild(d);delete b.toggled}else if(b.lastChild)for(b.toggled=[];b.lastChild;)b.toggled.push(b.removeChild(b.lastChild))};pv.nodes=function(b){for(var d=new pv.Dom.Node,f=0;f<b.length;f++)d.appendChild(new pv.Dom.Node(b[f]));return d.nodes()};pv.tree=function(b){return new pv.Tree(b)};
pv.Tree=function(b){this.array=b};pv.Tree.prototype.keys=function(b){this.k=b;return this};pv.Tree.prototype.value=function(b){this.v=b;return this};pv.Tree.prototype.map=function(){for(var b={},d={},f=0;f<this.array.length;f++){d.index=f;for(var g=this.array[f],h=this.k.call(d,g),j=b,i=0;i<h.length-1;i++)j=j[h[i]]||(j[h[i]]={});j[h[i]]=this.v?this.v.call(d,g):g}return b};pv.nest=function(b){return new pv.Nest(b)};pv.Nest=function(b){this.array=b;this.keys=[]};a=pv.Nest.prototype;
a.key=function(b){this.keys.push(b);return this};a.sortKeys=function(b){this.keys[this.keys.length-1].order=b||pv.naturalOrder;return this};a.sortValues=function(b){this.order=b||pv.naturalOrder;return this};a.map=function(){for(var b={},d=[],f,g=0;g<this.array.length;g++){var h=this.array[g],j=b;for(f=0;f<this.keys.length-1;f++){var i=this.keys[f](h);j[i]||(j[i]={});j=j[i]}i=this.keys[f](h);if(!j[i]){f=[];d.push(f);j[i]=f}j[i].push(h)}if(this.order)for(f=0;f<d.length;f++)d[f].sort(this.order);return b};
a.entries=function(){function b(f){var g=[];for(var h in f){var j=f[h];g.push({key:h,values:j instanceof Array?j:b(j)})}return g}function d(f,g){var h=this.keys[g].order;h&&f.sort(function(i,k){return h(i.key,k.key)});if(++g<this.keys.length)for(var j=0;j<f.length;j++)d.call(this,f[j].values,g);return f}return d.call(this,b(this.map()),0)};a.rollup=function(b){function d(f){for(var g in f){var h=f[g];if(h instanceof Array)f[g]=b(h);else d(h)}return f}return d(this.map())};pv.flatten=function(b){return new pv.Flatten(b)};
pv.Flatten=function(b){this.map=b;this.keys=[]};pv.Flatten.prototype.key=function(b,d){this.keys.push({name:b,value:d});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(b){this.keys.length=0;this.$leaf=b;return this};
pv.Flatten.prototype.array=function(){function b(i,k){if(k<g.length-1)for(var o in i){f.push(o);b(i[o],k+1);f.pop()}else d.push(f.concat(i))}var d=[],f=[],g=this.keys,h=this.$leaf;if(h){function j(i,k){if(h(i))d.push({keys:f.slice(),value:i});else for(var o in i){f.push(o);j(i[o],k+1);f.pop()}}j(this.map,0);return d}b(this.map,0);return d.map(function(i){for(var k={},o=0;o<g.length;o++){var m=g[o],n=i[o];k[m.name]=m.value?m.value.call(null,n):n}return k})};
pv.vector=function(b,d){return new pv.Vector(b,d)};pv.Vector=function(b,d){this.x=b;this.y=d};a=pv.Vector.prototype;a.perp=function(){return new pv.Vector(-this.y,this.x)};a.norm=function(){var b=this.length();return this.times(b?1/b:1)};a.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.times=function(b){return new pv.Vector(this.x*b,this.y*b)};a.plus=function(b,d){return arguments.length==1?new pv.Vector(this.x+b.x,this.y+b.y):new pv.Vector(this.x+b,this.y+d)};
a.minus=function(b,d){return arguments.length==1?new pv.Vector(this.x-b.x,this.y-b.y):new pv.Vector(this.x-b,this.y-d)};a.dot=function(b,d){return arguments.length==1?this.x*b.x+this.y*b.y:this.x*b+this.y*d};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(b,d){var f=new pv.Transform;f.k=this.k;f.x=this.k*b+this.x;f.y=this.k*d+this.y;return f};
pv.Transform.prototype.scale=function(b){var d=new pv.Transform;d.k=this.k*b;d.x=this.x;d.y=this.y;return d};pv.Transform.prototype.invert=function(){var b=new pv.Transform,d=1/this.k;b.k=d;b.x=-this.x*d;b.y=-this.y*d;return b};pv.Transform.prototype.times=function(b){var d=new pv.Transform;d.k=this.k*b.k;d.x=this.k*b.x+this.x;d.y=this.k*b.y+this.y;return d};pv.Scale=function(){};
pv.Scale.interpolator=function(b,d){if(typeof b=="number")return function(f){return f*(d-b)+b};b=pv.color(b).rgb();d=pv.color(d).rgb();return function(f){var g=b.a*(1-f)+d.a*f;if(g<1.0E-5)g=0;return b.a==0?pv.rgb(d.r,d.g,d.b,g):d.a==0?pv.rgb(b.r,b.g,b.b,g):pv.rgb(Math.round(b.r*(1-f)+d.r*f),Math.round(b.g*(1-f)+d.g*f),Math.round(b.b*(1-f)+d.b*f),g)}};
pv.Scale.quantitative=function(){function b(q){return new Date(q)}function d(q){var l=pv.search(f,q);if(l<0)l=-l-2;l=Math.max(0,Math.min(j.length-1,l));return j[l]((o(q)-g[l])/(g[l+1]-g[l]))}var f=[0,1],g=[0,1],h=[0,1],j=[pv.identity],i=Number,k=false,o=pv.identity,m=pv.identity,n=String;d.transform=function(q,l){o=function(p){return k?-q(-p):q(p)};m=function(p){return k?-l(-p):l(p)};g=f.map(o);return this};d.domain=function(q,l,p){if(arguments.length){var t;if(q instanceof Array){if(arguments.length<
2)l=pv.identity;if(arguments.length<3)p=l;t=q.length&&l(q[0]);f=q.length?[pv.min(q,l),pv.max(q,p)]:[]}else{t=q;f=Array.prototype.slice.call(arguments).map(Number)}if(f.length){if(f.length==1)f=[f[0],f[0]]}else f=[-Infinity,Infinity];k=(f[0]||f[f.length-1])<0;g=f.map(o);i=t instanceof Date?b:Number;return this}return f.map(i)};d.range=function(){if(arguments.length){h=Array.prototype.slice.call(arguments);if(h.length){if(h.length==1)h=[h[0],h[0]]}else h=[-Infinity,Infinity];j=[];for(var q=0;q<h.length-
1;q++)j.push(pv.Scale.interpolator(h[q],h[q+1]));return this}return h};d.invert=function(q){var l=pv.search(h,q);if(l<0)l=-l-2;l=Math.max(0,Math.min(j.length-1,l));return i(m(g[l]+(q-h[l])/(h[l+1]-h[l])*(g[l+1]-g[l])))};d.ticks=function(q){var l=f[0],p=f[f.length-1],t=p<l,u=t?p:l;p=t?l:p;var v=p-u;if(!v||!isFinite(v)){if(i==b)n=pv.Format.date("%x");return[i(u)]}if(i==b){function z(y,A){switch(A){case 31536E6:y.setMonth(0);case 2592E6:y.setDate(1);case 6048E5:A==6048E5&&y.setDate(y.getDate()-y.getDay());
case 864E5:y.setHours(0);case 36E5:y.setMinutes(0);case 6E4:y.setSeconds(0);case 1E3:y.setMilliseconds(0)}}var w,s,x=1;if(v>=63072E6){w=31536E6;s="%Y";l=function(y){y.setFullYear(y.getFullYear()+x)}}else if(v>=5184E6){w=2592E6;s="%m/%Y";l=function(y){y.setMonth(y.getMonth()+x)}}else if(v>=12096E5){w=6048E5;s="%m/%d";l=function(y){y.setDate(y.getDate()+7*x)}}else if(v>=1728E5){w=864E5;s="%m/%d";l=function(y){y.setDate(y.getDate()+x)}}else if(v>=72E5){w=36E5;s="%I:%M %p";l=function(y){y.setHours(y.getHours()+
x)}}else if(v>=18E4){w=6E4;s="%I:%M %p";l=function(y){y.setMinutes(y.getMinutes()+x)}}else if(v>=3E3){w=1E3;s="%I:%M:%S";l=function(y){y.setSeconds(y.getSeconds()+x)}}else{w=1;s="%S.%Qs";l=function(y){y.setTime(y.getTime()+x)}}n=pv.Format.date(s);u=new Date(u);s=[];z(u,w);v=v/w;if(v>10)switch(w){case 36E5:x=v>20?6:3;u.setHours(Math.floor(u.getHours()/x)*x);break;case 2592E6:x=3;u.setMonth(Math.floor(u.getMonth()/x)*x);break;case 6E4:x=v>30?15:v>15?10:5;u.setMinutes(Math.floor(u.getMinutes()/x)*x);
break;case 1E3:x=v>90?15:v>60?10:5;u.setSeconds(Math.floor(u.getSeconds()/x)*x);break;case 1:x=v>1E3?250:v>200?100:v>100?50:v>50?25:5;u.setMilliseconds(Math.floor(u.getMilliseconds()/x)*x);break;default:x=pv.logCeil(v/15,10);if(v/x<2)x/=5;else if(v/x<5)x/=2;u.setFullYear(Math.floor(u.getFullYear()/x)*x);break}for(;;){l(u);if(u>p)break;s.push(new Date(u))}return t?s.reverse():s}arguments.length||(q=10);x=pv.logFloor(v/q,10);l=q/(v/x);if(l<=0.15)x*=10;else if(l<=0.35)x*=5;else if(l<=0.75)x*=2;l=Math.ceil(u/
x)*x;p=Math.floor(p/x)*x;w=Math.max(0,-Math.floor(pv.log(x,10)+0.01));n=function(y){return y.toFixed(w)};p=pv.range(l,p+x,x);return t?p.reverse():p};d.tickFormat=function(q){return n(q)};d.nice=function(){if(f.length!=2)return this;var q=f[0],l=f[f.length-1],p=l<q,t=p?l:q;q=p?q:l;l=q-t;if(!l||!isFinite(l))return this;l=Math.pow(10,Math.round(Math.log(l)/Math.log(10))-1);f=[Math.floor(t/l)*l,Math.ceil(q/l)*l];p&&f.reverse();g=f.map(o);return this};d.by=function(q){function l(){return d(q.apply(this,
arguments))}for(var p in d)l[p]=d[p];return l};d.domain.apply(d,arguments);return d};pv.Scale.linear=function(){var b=pv.Scale.quantitative();b.domain.apply(b,arguments);return b};
pv.Scale.log=function(){var b=pv.Scale.quantitative(1,10),d,f,g=function(j){return Math.log(j)/f},h=function(j){return Math.pow(d,j)};b.ticks=function(){var j=b.domain(),i=j[0]<0,k=Math.floor(i?-g(-j[0]):g(j[0])),o=Math.ceil(i?-g(-j[1]):g(j[1])),m=[];if(i)for(m.push(-h(-k));k++<o;)for(i=d-1;i>0;i--)m.push(-h(-k)*i);else{for(;k<o;k++)for(i=1;i<d;i++)m.push(h(k)*i);m.push(h(k))}for(k=0;m[k]<j[0];k++);for(o=m.length;m[o-1]>j[1];o--);return m.slice(k,o)};b.tickFormat=function(j){return j.toPrecision(1)};
b.nice=function(){var j=b.domain();return b.domain(pv.logFloor(j[0],d),pv.logCeil(j[1],d))};b.base=function(j){if(arguments.length){d=Number(j);f=Math.log(d);b.transform(g,h);return this}return d};b.domain.apply(b,arguments);return b.base(10)};pv.Scale.root=function(){var b=pv.Scale.quantitative();b.power=function(d){if(arguments.length){var f=Number(d),g=1/f;b.transform(function(h){return Math.pow(h,g)},function(h){return Math.pow(h,f)});return this}return f};b.domain.apply(b,arguments);return b.power(2)};
pv.Scale.ordinal=function(){function b(h){h in f||(f[h]=d.push(h)-1);return g[f[h]%g.length]}var d=[],f={},g=[];b.domain=function(h,j){if(arguments.length){h=h instanceof Array?arguments.length>1?pv.map(h,j):h:Array.prototype.slice.call(arguments);d=[];for(var i={},k=0;k<h.length;k++){var o=h[k];if(!(o in i)){i[o]=true;d.push(o)}}f=pv.numerate(d);return this}return d};b.range=function(h,j){if(arguments.length){g=h instanceof Array?arguments.length>1?pv.map(h,j):h:Array.prototype.slice.call(arguments);
if(typeof g[0]=="string")g=g.map(pv.color);return this}return g};b.split=function(h,j){var i=(j-h)/this.domain().length;g=pv.range(h+i/2,j,i);return this};b.splitFlush=function(h,j){var i=this.domain().length,k=(j-h)/(i-1);g=i==1?[(h+j)/2]:pv.range(h,j+k/2,k);return this};b.splitBanded=function(h,j,i){if(arguments.length<3)i=1;if(i<0){var k=this.domain().length;k=(j-h- -i*k)/(k+1);g=pv.range(h+k,j,k-i);g.band=-i}else{k=(j-h)/(this.domain().length+(1-i));g=pv.range(h+k*(1-i),j,k);g.band=k*i}return this};
b.by=function(h){function j(){return b(h.apply(this,arguments))}for(var i in b)j[i]=b[i];return j};b.domain.apply(b,arguments);return b};
pv.histogram=function(b,d){var f=true;return{bins:function(g){var h=pv.map(b,d),j=[];arguments.length||(g=pv.Scale.linear(h).ticks());for(var i=0;i<g.length-1;i++){var k=j[i]=[];k.x=g[i];k.dx=g[i+1]-g[i];k.y=0}for(i=0;i<h.length;i++){k=pv.search.index(g,h[i])-1;k=j[Math.max(0,Math.min(j.length-1,k))];k.y++;k.push(b[i])}if(!f)for(i=0;i<j.length;i++)j[i].y/=h.length;return j},frequency:function(g){if(arguments.length){f=Boolean(g);return this}return f}}};
pv.color=function(b){if(b=="transparent")return pv.Color.transparent;if(b instanceof pv.Color)return b.rgb();var d=/([a-z]+)\((.*)\)/i.exec(b);if(d){var f=d[2].split(","),g=1;switch(d[1]){case "hsla":case "rgba":g=parseFloat(f[3]);if(!g)return pv.Color.transparent;break}switch(d[1]){case "hsla":case "hsl":b=parseFloat(f[0]);var h=parseFloat(f[1])/100;f=parseFloat(f[2])/100;return(new pv.Color.Hsl(b,h,f,g)).rgb();case "rgba":case "rgb":function j(o){var m=parseFloat(o);return o[o.length-1]=="%"?Math.round(m*
2.55):m}h=j(f[0]);var i=j(f[1]),k=j(f[2]);return pv.rgb(h,i,k,g)}}if(g=pv.Color.names[b])return g;if(b.charAt(0)=="#"){if(b.length==4){h=b.charAt(1);h+=h;i=b.charAt(2);i+=i;k=b.charAt(3);k+=k}else if(b.length==7){h=b.substring(1,3);i=b.substring(3,5);k=b.substring(5,7)}return pv.rgb(parseInt(h,16),parseInt(i,16),parseInt(k,16),1)}return new pv.Color(b,1)};pv.Color=function(b,d){this.color=b;this.opacity=d};pv.Color.prototype.brighter=function(b){return this.rgb().brighter(b)};
pv.Color.prototype.darker=function(b){return this.rgb().darker(b)};pv.rgb=function(b,d,f,g){return new pv.Color.Rgb(b,d,f,arguments.length==4?g:1)};pv.Color.Rgb=function(b,d,f,g){pv.Color.call(this,g?"rgb("+b+","+d+","+f+")":"none",g);this.r=b;this.g=d;this.b=f;this.a=g};pv.Color.Rgb.prototype=pv.extend(pv.Color);a=pv.Color.Rgb.prototype;a.red=function(b){return pv.rgb(b,this.g,this.b,this.a)};a.green=function(b){return pv.rgb(this.r,b,this.b,this.a)};
a.blue=function(b){return pv.rgb(this.r,this.g,b,this.a)};a.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};a.rgb=function(){return this};a.brighter=function(b){b=Math.pow(0.7,arguments.length?b:1);var d=this.r,f=this.g,g=this.b;if(!d&&!f&&!g)return pv.rgb(30,30,30,this.a);if(d&&d<30)d=30;if(f&&f<30)f=30;if(g&&g<30)g=30;return pv.rgb(Math.min(255,Math.floor(d/b)),Math.min(255,Math.floor(f/b)),Math.min(255,Math.floor(g/b)),this.a)};
a.darker=function(b){b=Math.pow(0.7,arguments.length?b:1);return pv.rgb(Math.max(0,Math.floor(b*this.r)),Math.max(0,Math.floor(b*this.g)),Math.max(0,Math.floor(b*this.b)),this.a)};pv.hsl=function(b,d,f,g){return new pv.Color.Hsl(b,d,f,arguments.length==4?g:1)};pv.Color.Hsl=function(b,d,f,g){pv.Color.call(this,"hsl("+b+","+d*100+"%,"+f*100+"%)",g);this.h=b;this.s=d;this.l=f;this.a=g};pv.Color.Hsl.prototype=pv.extend(pv.Color);a=pv.Color.Hsl.prototype;
a.hue=function(b){return pv.hsl(b,this.s,this.l,this.a)};a.saturation=function(b){return pv.hsl(this.h,b,this.l,this.a)};a.lightness=function(b){return pv.hsl(this.h,this.s,b,this.a)};a.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};
a.rgb=function(){function b(k){if(k>360)k-=360;else if(k<0)k+=360;if(k<60)return i+(j-i)*k/60;if(k<180)return j;if(k<240)return i+(j-i)*(240-k)/60;return i}function d(k){return Math.round(b(k)*255)}var f=this.h,g=this.s,h=this.l;f%=360;if(f<0)f+=360;g=Math.max(0,Math.min(g,1));h=Math.max(0,Math.min(h,1));var j=h<=0.5?h*(1+g):h+g-h*g,i=2*h-j;return pv.rgb(d(f+120),d(f),d(f-120),this.a)};
pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",
darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};(function(){var b=pv.Color.names;for(var d in b)b[d]=pv.color(b[d])})();pv.Color.transparent=pv.rgb(0,0,0,0);
pv.colors=function(){var b=pv.Scale.ordinal();b.range.apply(b,arguments);return b};pv.Colors={};pv.Colors.category10=function(){var b=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");b.domain.apply(b,arguments);return b};
pv.Colors.category20=function(){var b=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");b.domain.apply(b,arguments);return b};
pv.Colors.category19=function(){var b=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");b.domain.apply(b,arguments);return b};pv.ramp=function(){var b=pv.Scale.linear();b.range.apply(b,arguments);return b};
pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},
css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(b){if(b.length&&b[0].reverse&&b.type!="line"&&b.type!="area"){for(var d=pv.extend(b),f=0,g=b.length-1;g>=0;f++,g--)d[f]=b[g];b=d}this.removeSiblings(this[b.type](b))};pv.SvgScene.create=function(b){return document.createElementNS(this.svg,b)};
pv.SvgScene.expect=function(b,d,f,g){if(b){if(b.tagName=="a")b=b.firstChild;if(b.tagName!=d){d=this.create(d);b.parentNode.replaceChild(d,b);b=d}}else b=this.create(d);for(var h in f){d=f[h];if(d==this.implicit.svg[h])d=null;d==null?b.removeAttribute(h):b.setAttribute(h,d)}for(h in g){d=g[h];if(d==this.implicit.css[h])d=null;if(d==null)b.style.removeProperty(h);else b.style[h]=d}return b};
pv.SvgScene.append=function(b,d,f){b.$scene={scenes:d,index:f};b=this.title(b,d[f]);b.parentNode||d.$g.appendChild(b);return b.nextSibling};pv.SvgScene.title=function(b,d){var f=b.parentNode;if(f&&f.tagName!="a")f=null;if(d.title){if(!f){f=this.create("a");b.parentNode&&b.parentNode.replaceChild(f,b);f.appendChild(b)}f.setAttributeNS(this.xlink,"title",d.title);return f}f&&f.parentNode.replaceChild(b,f);return b};
pv.SvgScene.dispatch=pv.listener(function(b){var d=b.target.$scene;if(d){var f=b.type;switch(f){case "DOMMouseScroll":f="mousewheel";b.wheel=-480*b.detail;break;case "mousewheel":b.wheel=(window.opera?12:48)*b.wheelDelta;break}pv.Mark.dispatch(f,d.scenes,d.index)&&b.preventDefault()}});pv.SvgScene.removeSiblings=function(b){for(;b;){var d=b.nextSibling;b.parentNode.removeChild(b);b=d}};pv.SvgScene.undefined=function(){};
pv.SvgScene.area=function(b){function d(n,q){for(var l=[],p=[],t=q;n<=t;n++,q--){var u=b[n],v=b[q];u=u.left+","+u.top;v=v.left+v.width+","+(v.top+v.height);if(n<t){var z=b[n+1],w=b[q-1];switch(g.interpolate){case "step-before":u+="V"+z.top;v+="H"+(w.left+w.width);break;case "step-after":u+="H"+z.left;v+="V"+(w.top+w.height);break}}l.push(u);p.push(v)}return l.concat(p).join("L")}var f=b.$g.firstChild;if(!b.length)return f;var g=b[0];if(g.segmented)return this.areaSegment(b);if(!g.visible)return f;
var h=g.fillStyle,j=g.strokeStyle;if(!h.opacity&&!j.opacity)return f;for(var i=[],k,o=0;o<b.length;o++){k=b[o];if(k.width||k.height){for(var m=o+1;m<b.length;m++){k=b[m];if(!k.width&&!k.height)break}o&&g.interpolate!="step-after"&&o--;m<b.length&&g.interpolate!="step-before"&&m++;i.push(d(o,o=m-1))}}if(!i.length)return f;f=this.expect(f,"path",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,d:"M"+i.join("ZM")+"Z",fill:h.color,"fill-opacity":h.opacity||null,
stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?g.lineWidth/this.scale:null});return this.append(f,b,0)};
pv.SvgScene.areaSegment=function(b){for(var d=b.$g.firstChild,f=0,g=b.length-1;f<g;f++){var h=b[f],j=b[f+1];if(h.visible&&j.visible){var i=h.fillStyle,k=h.strokeStyle;if(i.opacity||k.opacity){var o=h,m=j;switch(h.interpolate){case "step-before":o=j;break;case "step-after":m=h;break}d=this.expect(d,"polygon",{"shape-rendering":h.antialias?null:"crispEdges","pointer-events":h.events,cursor:h.cursor,points:h.left+","+o.top+" "+j.left+","+m.top+" "+(j.left+j.width)+","+(m.top+m.height)+" "+(h.left+h.width)+
","+(o.top+o.height),fill:i.color,"fill-opacity":i.opacity||null,stroke:k.color,"stroke-opacity":k.opacity||null,"stroke-width":k.opacity?h.lineWidth/this.scale:null});d=this.append(d,b,f)}}}return d};
pv.SvgScene.bar=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){var h=g.fillStyle,j=g.strokeStyle;if(h.opacity||j.opacity){d=this.expect(d,"rect",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,x:g.left,y:g.top,width:Math.max(1.0E-10,g.width),height:Math.max(1.0E-10,g.height),fill:h.color,"fill-opacity":h.opacity||null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?g.lineWidth/this.scale:null});
d=this.append(d,b,f)}}}return d};
pv.SvgScene.dot=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){var h=g.fillStyle,j=g.strokeStyle;if(h.opacity||j.opacity){var i=g.radius,k=null;switch(g.shape){case "cross":k="M"+-i+","+-i+"L"+i+","+i+"M"+i+","+-i+"L"+-i+","+i;break;case "triangle":k=i;var o=i*1.1547;k="M0,"+k+"L"+o+","+-k+" "+-o+","+-k+"Z";break;case "diamond":i*=Math.SQRT2;k="M0,"+-i+"L"+i+",0 0,"+i+" "+-i+",0Z";break;case "square":k="M"+-i+","+-i+"L"+i+","+-i+" "+i+","+i+" "+-i+","+i+"Z";break;
case "tick":k="M0,0L0,"+-g.size;break}h={"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,fill:h.color,"fill-opacity":h.opacity||null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?g.lineWidth/this.scale:null};if(k){h.transform="translate("+g.left+","+g.top+")";if(g.angle)h.transform+=" rotate("+180*g.angle/Math.PI+")";h.d=k;d=this.expect(d,"path",h)}else{h.cx=g.left;h.cy=g.top;h.r=i;d=this.expect(d,"circle",h)}d=this.append(d,b,f)}}}return d};
pv.SvgScene.image=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){d=this.fill(d,b,f);if(g.image){d=this.expect(d,"foreignObject",{cursor:g.cursor,x:g.left,y:g.top,width:g.width,height:g.height});var h=d.firstChild||d.appendChild(document.createElementNS(this.xhtml,"canvas"));h.$scene={scenes:b,index:f};h.style.width=g.width;h.style.height=g.height;h.width=g.imageWidth;h.height=g.imageHeight;h.getContext("2d").putImageData(g.image,0,0)}else{d=this.expect(d,"image",
{preserveAspectRatio:"none",cursor:g.cursor,x:g.left,y:g.top,width:g.width,height:g.height});d.setAttributeNS(this.xlink,"href",g.url)}d=this.append(d,b,f);d=this.stroke(d,b,f)}}return d};
pv.SvgScene.label=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){var h=g.textStyle;if(h.opacity&&g.text){var j=0,i=0,k=0,o="start";switch(g.textBaseline){case "middle":k=".35em";break;case "top":k=".71em";i=g.textMargin;break;case "bottom":i="-"+g.textMargin;break}switch(g.textAlign){case "right":o="end";j="-"+g.textMargin;break;case "center":o="middle";break;case "left":j=g.textMargin;break}d=this.expect(d,"text",{"pointer-events":g.events,cursor:g.cursor,x:j,
y:i,dy:k,transform:"translate("+g.left+","+g.top+")"+(g.textAngle?" rotate("+180*g.textAngle/Math.PI+")":"")+(this.scale!=1?" scale("+1/this.scale+")":""),fill:h.color,"fill-opacity":h.opacity||null,"text-anchor":o},{font:g.font,"text-shadow":g.textShadow,"text-decoration":g.textDecoration});if(d.firstChild)d.firstChild.nodeValue=g.text;else d.appendChild(document.createTextNode(g.text));d=this.append(d,b,f)}}}return d};
pv.SvgScene.line=function(b){var d=b.$g.firstChild;if(b.length<2)return d;var f=b[0];if(f.segmented)return this.lineSegment(b);if(!f.visible)return d;var g=f.fillStyle,h=f.strokeStyle;if(!g.opacity&&!h.opacity)return d;var j="M"+f.left+","+f.top;if(f.interpolate=="basis"&&b.length>2){var i=b[0],k=i,o=i,m=b[1];j+=this.pathBasis(i,k,o,m);for(var n=2;n<b.length;n++){i=k;k=o;o=m;m=b[n];j+=this.pathBasis(i,k,o,m)}for(n=0;n<2;n++){i=k;k=o;o=m;j+=this.pathBasis(i,k,o,m)}}else if(f.interpolate=="cardinal"&&
b.length>2){m=(1-f.tension)/2;i=b[0];k=b[1];o=b[2];j+="C"+(i.left+(o.left-i.left)*m)+","+(i.top+(o.top-i.top)*m)+","+(k.left+(i.left-o.left)*m)+","+(k.top+(i.top-o.top)*m)+","+k.left+","+k.top;for(n=3;n<b.length;n++){i=k;k=o;o=b[n];j+="S"+(k.left+(i.left-o.left)*m)+","+(k.top+(i.top-o.top)*m)+","+k.left+","+k.top}j+="S"+(o.left-(o.left-i.left)*m)+","+(o.top-(o.top-i.top)*m)+","+o.left+","+o.top}else for(n=1;n<b.length;n++)j+=this.pathSegment(b[n-1],b[n]);d=this.expect(d,"path",{"shape-rendering":f.antialias?
null:"crispEdges","pointer-events":f.events,cursor:f.cursor,d:j,fill:g.color,"fill-opacity":g.opacity||null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?f.lineWidth/this.scale:null,"stroke-linejoin":f.lineJoin});return this.append(d,b,0)};
pv.SvgScene.pathBasis=function(){function b(f,g,h,j,i){return{x:f[0]*g.left+f[1]*h.left+f[2]*j.left+f[3]*i.left,y:f[0]*g.top+f[1]*h.top+f[2]*j.top+f[3]*i.top}}var d=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];return function(f,g,h,j){var i=b(d[1],f,g,h,j),k=b(d[2],f,g,h,j);f=b(d[3],f,g,h,j);return"C"+i.x+","+i.y+","+k.x+","+k.y+","+f.x+","+f.y}}();
pv.SvgScene.lineSegment=function(b){for(var d=b.$g.firstChild,f=0,g=b.length-1;f<g;f++){var h=b[f],j=b[f+1];if(h.visible&&j.visible){var i=h.strokeStyle,k=pv.Color.transparent;if(i.opacity){if(h.interpolate=="linear"&&h.lineJoin=="miter"){k=i;i=pv.Color.transparent;j=this.pathJoin(b[f-1],h,j,b[f+2])}else j="M"+h.left+","+h.top+this.pathSegment(h,j);d=this.expect(d,"path",{"shape-rendering":h.antialias?null:"crispEdges","pointer-events":h.events,cursor:h.cursor,d:j,fill:k.color,"fill-opacity":k.opacity||
null,stroke:i.color,"stroke-opacity":i.opacity||null,"stroke-width":i.opacity?h.lineWidth/this.scale:null,"stroke-linejoin":h.lineJoin});d=this.append(d,b,f)}}}return d};
pv.SvgScene.pathSegment=function(b,d){var f=1;switch(b.interpolate){case "polar-reverse":f=0;case "polar":var g=d.left-b.left,h=d.top-b.top;b=1-b.eccentricity;g=Math.sqrt(g*g+h*h)/(2*b);if(b<=0||b>1)break;return"A"+g+","+g+" 0 0,"+f+" "+d.left+","+d.top;case "step-before":return"V"+d.top+"H"+d.left;case "step-after":return"H"+d.left+"V"+d.top}return"L"+d.left+","+d.top};pv.SvgScene.lineIntersect=function(b,d,f,g){return b.plus(d.times(f.minus(b).dot(g.perp())/d.dot(g.perp())))};
pv.SvgScene.pathJoin=function(b,d,f,g){var h=pv.vector(d.left,d.top);f=pv.vector(f.left,f.top);var j=f.minus(h),i=j.perp().norm(),k=i.times(d.lineWidth/(2*this.scale));d=h.plus(k);var o=f.plus(k),m=f.minus(k);k=h.minus(k);if(b&&b.visible){b=h.minus(b.left,b.top).perp().norm().plus(i);k=this.lineIntersect(h,b,k,j);d=this.lineIntersect(h,b,d,j)}if(g&&g.visible){g=pv.vector(g.left,g.top).minus(f).perp().norm().plus(i);m=this.lineIntersect(f,g,m,j);o=this.lineIntersect(f,g,o,j)}return"M"+d.x+","+d.y+
"L"+o.x+","+o.y+" "+m.x+","+m.y+" "+k.x+","+k.y};
pv.SvgScene.panel=function(b){for(var d=b.$g,f=d&&d.firstChild,g=0;g<b.length;g++){var h=b[g];if(h.visible){if(!b.parent){h.canvas.style.display="inline-block";if(d&&d.parentNode!=h.canvas)f=(d=h.canvas.firstChild)&&d.firstChild;if(!d){d=h.canvas.appendChild(this.create("svg"));d.setAttribute("font-size","10px");d.setAttribute("font-family","sans-serif");d.setAttribute("fill","none");d.setAttribute("stroke","none");d.setAttribute("stroke-width",1.5);for(var j=0;j<this.events.length;j++)d.addEventListener(this.events[j],
this.dispatch,false);f=d.firstChild}b.$g=d;d.setAttribute("width",h.width+h.left+h.right);d.setAttribute("height",h.height+h.top+h.bottom)}if(h.overflow=="hidden"){j=pv.id().toString(36);var i=this.expect(f,"g",{"clip-path":"url(#"+j+")"});i.parentNode||d.appendChild(i);b.$g=d=i;f=i.firstChild;f=this.expect(f,"clipPath",{id:j});j=f.firstChild||f.appendChild(this.create("rect"));j.setAttribute("x",h.left);j.setAttribute("y",h.top);j.setAttribute("width",h.width);j.setAttribute("height",h.height);f.parentNode||
d.appendChild(f);f=f.nextSibling}f=this.fill(f,b,g);var k=this.scale,o=h.transform,m=h.left+o.x,n=h.top+o.y;this.scale*=o.k;for(j=0;j<h.children.length;j++){h.children[j].$g=f=this.expect(f,"g",{transform:"translate("+m+","+n+")"+(o.k!=1?" scale("+o.k+")":"")});this.updateAll(h.children[j]);f.parentNode||d.appendChild(f);f=f.nextSibling}this.scale=k;f=this.stroke(f,b,g);if(h.overflow=="hidden"){b.$g=d=i.parentNode;f=i.nextSibling}}}return f};
pv.SvgScene.fill=function(b,d,f){var g=d[f],h=g.fillStyle;if(h.opacity||g.events=="all"){b=this.expect(b,"rect",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,x:g.left,y:g.top,width:g.width,height:g.height,fill:h.color,"fill-opacity":h.opacity,stroke:null});b=this.append(b,d,f)}return b};
pv.SvgScene.stroke=function(b,d,f){var g=d[f],h=g.strokeStyle;if(h.opacity||g.events=="all"){b=this.expect(b,"rect",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events=="all"?"stroke":g.events,cursor:g.cursor,x:g.left,y:g.top,width:Math.max(1.0E-10,g.width),height:Math.max(1.0E-10,g.height),fill:null,stroke:h.color,"stroke-opacity":h.opacity,"stroke-width":g.lineWidth/this.scale});b=this.append(b,d,f)}return b};
pv.SvgScene.rule=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){var h=g.strokeStyle;if(h.opacity){d=this.expect(d,"line",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,x1:g.left,y1:g.top,x2:g.left+g.width,y2:g.top+g.height,stroke:h.color,"stroke-opacity":h.opacity,"stroke-width":g.lineWidth/this.scale});d=this.append(d,b,f)}}}return d};
pv.SvgScene.wedge=function(b){for(var d=b.$g.firstChild,f=0;f<b.length;f++){var g=b[f];if(g.visible){var h=g.fillStyle,j=g.strokeStyle;if(h.opacity||j.opacity){var i=g.innerRadius,k=g.outerRadius,o=Math.abs(g.angle);if(o>=2*Math.PI)i=i?"M0,"+k+"A"+k+","+k+" 0 1,1 0,"+-k+"A"+k+","+k+" 0 1,1 0,"+k+"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":"M0,"+k+"A"+k+","+k+" 0 1,1 0,"+-k+"A"+k+","+k+" 0 1,1 0,"+k+"Z";else{var m=Math.min(g.startAngle,g.endAngle),n=Math.max(g.startAngle,g.endAngle),
q=Math.cos(m),l=Math.cos(n);m=Math.sin(m);n=Math.sin(n);i=i?"M"+k*q+","+k*m+"A"+k+","+k+" 0 "+(o<Math.PI?"0":"1")+",1 "+k*l+","+k*n+"L"+i*l+","+i*n+"A"+i+","+i+" 0 "+(o<Math.PI?"0":"1")+",0 "+i*q+","+i*m+"Z":"M"+k*q+","+k*m+"A"+k+","+k+" 0 "+(o<Math.PI?"0":"1")+",1 "+k*l+","+k*n+"L0,0Z"}d=this.expect(d,"path",{"shape-rendering":g.antialias?null:"crispEdges","pointer-events":g.events,cursor:g.cursor,transform:"translate("+g.left+","+g.top+")",d:i,fill:h.color,"fill-rule":"evenodd","fill-opacity":h.opacity||
null,stroke:j.color,"stroke-opacity":j.opacity||null,"stroke-width":j.opacity?g.lineWidth/this.scale:null});d=this.append(d,b,f)}}}return d};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,d){if(!this.hasOwnProperty("properties"))this.properties=pv.extend(this.properties);this.properties[b]=true;pv.Mark.prototype.propertyMethod(b,false,pv.Mark.cast[b]=d);return this};
pv.Mark.prototype.propertyMethod=function(b,d,f){f||(f=pv.Mark.cast[b]);this[b]=function(g){if(d&&this.scene){var h=this.scene.defs;if(arguments.length){h[b]={id:g==undefined?0:pv.id(),value:g!=null&&f?f(g):g};return this}return h[b]?h[b].value:null}if(arguments.length){h=!d<<1|typeof g=="function";this.propertyValue(b,h&1&&f?function(){var j=g.apply(this,arguments);return j!=null?f(j):null}:g!=null&&f?f(g):g).type=h;return this}return this.instance()[b]}};
pv.Mark.prototype.propertyValue=function(b,d){var f=this.$properties;d={name:b,id:pv.id(),value:d};for(var g=0;g<f.length;g++)if(f[g].name==b){f.splice(g,1);break}f.push(d);return d};pv.Mark.prototype.property("data").property("visible",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String);a=pv.Mark.prototype;
a.childIndex=-1;a.index=-1;a.scale=1;a.defaults=(new pv.Mark).data(function(b){return[b]}).visible(true).antialias(true).events("painted");a.extend=function(b){this.proto=b;return this};a.add=function(b){return this.parent.add(b).extend(this)};a.def=function(b,d){this.propertyMethod(b,true);return this[b](d)};
a.anchor=function(b){var d=this;return(new pv.Anchor(this)).name(b).data(function(){return d.scene.map(function(f){return f.data})}).visible(function(){return d.instance().visible}).left(function(){var f=d.instance(),g=f.width||0;switch(this.name()){case "bottom":case "top":case "center":return f.left+(this.properties.width?0:g/2);case "left":return null}return f.left+g}).top(function(){var f=d.instance(),g=f.height||0;switch(this.name()){case "left":case "right":case "center":return f.top+(this.properties.height?
0:g/2);case "top":return null}return f.top+g}).right(function(){var f=d.instance();return this.name()=="left"?f.right+(f.width||0):null}).bottom(function(){var f=d.instance();return this.name()=="top"?f.bottom+(f.height||0):null}).textAlign(function(){switch(this.name()){case "bottom":case "top":case "center":return"center";case "right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"top"}return"bottom"})};
a.anchorTarget=function(){return this.proto.anchorTarget()};a.margin=function(b){return this.left(b).right(b).top(b).bottom(b)};a.instance=function(b){var d=this.scene||this.parent.instance(-1).children[this.childIndex],f=!arguments.length||this.hasOwnProperty("index")?this.index:b;return d[f<0?d.length-1:f]};a.first=function(){return this.scene[0]};a.last=function(){return this.scene[this.scene.length-1]};a.sibling=function(){return this.index==0?null:this.scene[this.index-1]};
a.cousin=function(){var b=this.parent;return(b=b&&b.sibling())&&b.children?b.children[this.childIndex][this.index]:null};
a.render=function(){function b(i,k,o){i.scale=o;if(k<h.length){g.unshift(null);if(i.hasOwnProperty("index"))d(i,k,o);else{for(var m=0,n=i.scene.length;m<n;m++){i.index=m;d(i,k,o)}delete i.index}g.shift()}else{i.build();pv.Scene.scale=o;pv.Scene.updateAll(i.scene)}delete i.scale}function d(i,k,o){var m=i.scene[i.index],n;if(m.visible){var q=h[k],l=i.children[q];for(n=0;n<q;n++)i.children[n].scene=m.children[n];g[0]=m.data;if(l.scene)b(l,k+1,o*m.transform.k);else{l.scene=m.children[q];b(l,k+1,o*m.transform.k);
delete l.scene}for(n=0;n<q;n++)delete i.children[n].scene}}var f=this.parent,g=pv.Mark.stack;if(f&&!this.root.scene)this.root.render();else{for(var h=[],j=this;j.parent;j=j.parent)h.unshift(j.childIndex);for(this.bind();f&&!f.hasOwnProperty("index");)f=f.parent;this.context(f?f.scene:undefined,f?f.index:-1,function(){b(this.root,0,1)})}};pv.Mark.stack=[];a=pv.Mark.prototype;
a.bind=function(){function b(k){do for(var o=k.$properties,m=o.length-1;m>=0;m--){var n=o[m];if(!(n.name in d)){d[n.name]=n;switch(n.name){case "data":g=n;break;case "visible":h=n;break;default:f[n.type].push(n);break}}}while(k=k.proto)}var d={},f=[[],[],[],[]],g,h;b(this);b(this.defaults);f[1].reverse();f[3].reverse();var j=this;do for(var i in j.properties)i in d||f[2].push(d[i]={name:i,type:2,value:null});while(j=j.proto);j=f[0].concat(f[1]);for(i=0;i<j.length;i++)this.propertyMethod(j[i].name,
true);this.binds={properties:d,data:g,defs:j,required:[h],optional:pv.blend(f)}};
a.build=function(){var b=this.scene,d=pv.Mark.stack;if(!b){b=this.scene=[];b.mark=this;b.type=this.type;b.childIndex=this.childIndex;if(this.parent){b.parent=this.parent.scene;b.parentIndex=this.parent.index}}if(this.binds.defs.length){var f=b.defs;if(!f)b.defs=f={};for(var g=0;g<this.binds.defs.length;g++){var h=this.binds.defs[g],j=f[h.name];if(!j||h.id>j.id)f[h.name]={id:0,value:h.type&1?h.value.apply(this,d):h.value}}}f=this.binds.data;f=f.type&1?f.value.apply(this,d):f.value;d.unshift(null);
b.length=f.length;for(g=0;g<f.length;g++){pv.Mark.prototype.index=this.index=g;(h=b[g])||(b[g]=h={});h.data=d[0]=f[g];this.buildInstance(h)}pv.Mark.prototype.index=-1;delete this.index;d.shift();return this};a.buildProperties=function(b,d){for(var f=0,g=d.length;f<g;f++){var h=d[f],j=h.value;switch(h.type){case 0:case 1:j=this.scene.defs[h.name].value;break;case 3:j=j.apply(this,pv.Mark.stack);break}b[h.name]=j}};
a.buildInstance=function(b){this.buildProperties(b,this.binds.required);if(b.visible){this.buildProperties(b,this.binds.optional);this.buildImplied(b)}};
a.buildImplied=function(b){var d=b.left,f=b.right,g=b.top,h=b.bottom,j=this.properties,i=j.width?b.width:0,k=j.height?b.height:0,o=this.parent?this.parent.width():i+d+f;if(i==null)i=o-(f=f||0)-(d=d||0);else if(f==null)f=o-i-(d=d||0);else if(d==null)d=o-i-(f=f||0);o=this.parent?this.parent.height():k+g+h;if(k==null)k=o-(g=g||0)-(h=h||0);else if(h==null)h=o-k-(g=g||0);else if(g==null)g=o-k-(h=h||0);b.left=d;b.right=f;b.top=g;b.bottom=h;if(j.width)b.width=i;if(j.height)b.height=k;if(j.textStyle&&!b.textStyle)b.textStyle=
pv.Color.transparent;if(j.fillStyle&&!b.fillStyle)b.fillStyle=pv.Color.transparent;if(j.strokeStyle&&!b.strokeStyle)b.strokeStyle=pv.Color.transparent};
a.mouse=function(){var b=pv.event.pageX,d=pv.event.pageY,f=this.root.canvas();do{b-=f.offsetLeft;d-=f.offsetTop}while(f=f.offsetParent);f=pv.Transform.identity;var g=this.properties.transform?this:this.parent;pz=[];do pz.push(g);while(g=g.parent);for(;g=pz.pop();)f=f.translate(g.left(),g.top()).times(g.transform());f=f.invert();return pv.vector(b*f.k+f.x,d*f.k+f.y)};a.event=function(b,d){this.$handlers[b]=d;return this};
a.context=function(b,d,f){function g(m,n){pv.Mark.scene=m;j.index=n;if(m){var q=m.mark,l=q,p=[];do{p.push(l);i.push(m[n].data);l.index=n;l.scene=m;n=m.parentIndex;m=m.parent}while(l=l.parent);m=p.length-1;for(n=1;m>0;m--){l=p[m];l.scale=n;n*=l.scene[l.index].transform.k}if(q.children){m=0;for(p=q.children.length;m<p;m++){l=q.children[m];l.scene=q.scene[q.index].children[m];l.scale=n}}}}function h(m){if(m){m=m.mark;var n;if(m.children)for(var q=0,l=m.children.length;q<l;q++){n=m.children[q];delete n.scene;
delete n.scale}n=m;do{i.pop();if(n.parent){delete n.scene;delete n.scale}delete n.index}while(n=n.parent)}}var j=pv.Mark.prototype,i=pv.Mark.stack,k=pv.Mark.scene,o=j.index;h(k,o);g(b,d);try{f.apply(this,i)}finally{h(b,d);g(k,o)}};pv.Mark.dispatch=function(b,d,f){var g=d.mark,h=d.parent,j=g.$handlers[b];if(!j)return h&&pv.Mark.dispatch(b,h,d.parentIndex);g.context(d,f,function(){(g=j.apply(g,pv.Mark.stack))&&g.render&&g.render()});return true};
pv.Anchor=function(b){pv.Mark.call(this);this.target=b;this.parent=b.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.anchorTarget=function(){return this.target};pv.Area=function(){pv.Mark.call(this)};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String);
pv.Area.prototype.type="area";pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear");pv.Area.prototype.buildImplied=function(b){if(b.height==null)b.height=0;if(b.width==null)b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};
pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var b=this.binds,d=b.required;b=b.optional;for(var f=0,g=b.length;f<g;f++){var h=b[f];h.fixed=h.name in pv.Area.fixed;if(h.name=="segmented"){d.push(h);b.splice(f,1);f--;g--}}this.binds.$required=d;this.binds.$optional=b};
pv.Area.prototype.buildInstance=function(b){var d=this.binds;if(this.index){var f=d.fixed;if(!f){f=d.fixed=[];function g(i){return!i.fixed||(f.push(i),false)}d.required=d.required.filter(g);if(!this.scene[0].segmented)d.optional=d.optional.filter(g)}d=0;for(var h=f.length;d<h;d++){var j=f[d].name;b[j]=this.scene[0][j]}}else{d.required=d.$required;d.optional=d.$optional;d.fixed=null}pv.Mark.prototype.buildInstance.call(this,b)};pv.Bar=function(){pv.Mark.call(this)};
pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};
pv.Dot.prototype=pv.extend(pv.Mark).property("size",Number).property("radius",Number).property("shape",String).property("angle",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent));
pv.Dot.prototype.anchor=function(b){var d=this;return pv.Mark.prototype.anchor.call(this,b).left(function(){var f=d.instance();switch(this.name()){case "bottom":case "top":case "center":return f.left;case "left":return null}return f.left+f.radius}).right(function(){var f=d.instance();return this.name()=="left"?f.right+f.radius:null}).top(function(){var f=d.instance();switch(this.name()){case "left":case "right":case "center":return f.top;case "top":return null}return f.top+f.radius}).bottom(function(){var f=
d.instance();return this.name()=="top"?f.bottom+f.radius:null}).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "bottom":return"top"}return"bottom"})};
pv.Dot.prototype.buildImplied=function(b){if(b.radius==null)b.radius=Math.sqrt(b.size);else if(b.size==null)b.size=b.radius*b.radius;pv.Mark.prototype.buildImplied.call(this,b)};pv.Label=function(){pv.Mark.call(this)};
pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);
pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.color).property("fillStyle",pv.color).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);a=pv.Line.prototype;a.type="line";a.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7);
a.bind=pv.Area.prototype.bind;a.buildInstance=pv.Area.prototype.buildInstance;a.anchor=function(b){return pv.Mark.prototype.anchor.call(this,b).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center";case "right":return"left"}}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"bottom";case "bottom":return"top"}})};pv.Rule=function(){pv.Mark.call(this)};
pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.color);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black");pv.Rule.prototype.anchor=pv.Line.prototype.anchor;
pv.Rule.prototype.buildImplied=function(b){var d=b.left,f=b.right;if(b.width!=null||d==null&&f==null||f!=null&&d!=null)b.height=0;else b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(b){return typeof b=="string"?document.getElementById(b):b});a=pv.Panel.prototype;a.type="panel";
a.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");a.anchor=function(b){var d=pv.extend(this);d.parent=this;d.instance=function(){var f=pv.extend(this.parent.instance());f.right=f.top=f.left=f.bottom=0;return f};return pv.Bar.prototype.anchor.call(d,b).data(function(f){return[f]})};a.add=function(b){b=new b;b.parent=this;b.root=this.root;b.childIndex=this.children.length;this.children.push(b);return b};
a.bind=function(){pv.Mark.prototype.bind.call(this);for(var b=0;b<this.children.length;b++)this.children[b].bind()};
a.buildInstance=function(b){pv.Bar.prototype.buildInstance.call(this,b);if(b.visible){if(!b.children)b.children=[];var d=this.scale*b.transform.k,f,g=this.children.length;pv.Mark.prototype.index=-1;for(var h=0;h<g;h++){f=this.children[h];f.scene=b.children[h];f.scale=d;f.build()}for(h=0;h<g;h++){f=this.children[h];b.children[h]=f.scene;delete f.scene;delete f.scale}b.children.length=g}};
a.buildImplied=function(b){if(!this.parent){var d=b.canvas;if(d){if(d.$panel!=this)for(d.$panel=this;d.lastChild;)d.removeChild(d.lastChild);var f;if(b.width==null){f=parseFloat(pv.css(d,"width"));b.width=f-b.left-b.right}if(b.height==null){f=parseFloat(pv.css(d,"height"));b.height=f-b.top-b.bottom}}else{f=this.$canvas||(this.$canvas=[]);if(!(d=f[this.index])){d=f[this.index]=document.createElement("span");if(this.$dom)this.$dom.parentNode.insertBefore(d,this.$dom);else{for(f=document.body;f.lastChild&&
f.lastChild.tagName;)f=f.lastChild;if(f!=document.body)f=f.parentNode;f.appendChild(d)}}}b.canvas=d}if(!b.transform)b.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,b)};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);a=pv.Image.prototype;a.type="image";a.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);
a.image=function(b){this.$image=function(){var d=b.apply(this,arguments);return d==null?pv.Color.transparent:typeof d=="string"?pv.color(d):d};return this};a.bind=function(){pv.Bar.prototype.bind.call(this);var b=this.binds,d=this;do b.image=d.$image;while(!b.image&&(d=d.proto))};
a.buildImplied=function(b){pv.Bar.prototype.buildImplied.call(this,b);if(b.visible){if(b.imageWidth==null)b.imageWidth=b.width;if(b.imageHeight==null)b.imageHeight=b.height;if(b.url==null&&this.binds.image){var d=this.$canvas||(this.$canvas=document.createElement("canvas")),f=d.getContext("2d"),g=b.imageWidth,h=b.imageHeight,j=pv.Mark.stack;d.width=g;d.height=h;b=(b.image=f.createImageData(g,h)).data;j.unshift(null,null);for(f=d=0;d<h;d++){j[1]=d;for(var i=0;i<g;i++){j[0]=i;var k=this.binds.image.apply(this,
j);b[f++]=k.r;b[f++]=k.g;b[f++]=k.b;b[f++]=255*k.a}}j.splice(0,2)}}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.color).property("fillStyle",pv.color);a=pv.Wedge.prototype;a.type="wedge";
a.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var b=this.sibling();return b?b.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));a.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};a.midAngle=function(){return(this.startAngle()+this.endAngle())/2};
a.anchor=function(b){function d(j){return j.innerRadius||j.angle<2*Math.PI}function f(j){return(j.innerRadius+j.outerRadius)/2}function g(j){return(j.startAngle+j.endAngle)/2}var h=this;return pv.Mark.prototype.anchor.call(this,b).left(function(){var j=h.instance();if(d(j))switch(this.name()){case "outer":return j.left+j.outerRadius*Math.cos(g(j));case "inner":return j.left+j.innerRadius*Math.cos(g(j));case "start":return j.left+f(j)*Math.cos(j.startAngle);case "center":return j.left+f(j)*Math.cos(g(j));
case "end":return j.left+f(j)*Math.cos(j.endAngle)}return j.left}).top(function(){var j=h.instance();if(d(j))switch(this.name()){case "outer":return j.top+j.outerRadius*Math.sin(g(j));case "inner":return j.top+j.innerRadius*Math.sin(g(j));case "start":return j.top+f(j)*Math.sin(j.startAngle);case "center":return j.top+f(j)*Math.sin(g(j));case "end":return j.top+f(j)*Math.sin(j.endAngle)}return j.top}).textAlign(function(){var j=h.instance();if(d(j))switch(this.name()){case "outer":return pv.Wedge.upright(g(j))?
"right":"left";case "inner":return pv.Wedge.upright(g(j))?"left":"right"}return"center"}).textBaseline(function(){var j=h.instance();if(d(j))switch(this.name()){case "start":return pv.Wedge.upright(j.startAngle)?"top":"bottom";case "end":return pv.Wedge.upright(j.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var j=h.instance(),i=0;if(d(j))switch(this.name()){case "center":case "inner":case "outer":i=g(j);break;case "start":i=j.startAngle;break;case "end":i=j.endAngle;break}return pv.Wedge.upright(i)?
i:i+Math.PI})};pv.Wedge.upright=function(b){b%=2*Math.PI;b=b<0?2*Math.PI+b:b;return b<Math.PI/2||b>3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(b){if(b.angle==null)b.angle=b.endAngle-b.startAngle;else if(b.endAngle==null)b.endAngle=b.startAngle+b.angle;pv.Mark.prototype.buildImplied.call(this,b)};pv.simulation=function(b){return new pv.Simulation(b)};pv.Simulation=function(b){for(var d=0;d<b.length;d++)this.particle(b[d])};a=pv.Simulation.prototype;
a.particle=function(b){b.next=this.particles;if(isNaN(b.px))b.px=b.x;if(isNaN(b.py))b.py=b.y;if(isNaN(b.fx))b.fx=0;if(isNaN(b.fy))b.fy=0;this.particles=b;return this};a.force=function(b){b.next=this.forces;this.forces=b;return this};a.constraint=function(b){b.next=this.constraints;this.constraints=b;return this};
a.stabilize=function(b){arguments.length||(b=3);for(var d=0;d<b;d++){var f=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,f)}for(d=this.particles;d;d=d.next){d.px=d.x;d.py=d.y}return this};
a.step=function(){var b;for(b=this.particles;b;b=b.next){var d=b.px,f=b.py;b.px=b.x;b.py=b.y;if(!b.fixed){b.x+=b.vx=b.x-d+b.fx;b.y+=b.vy=b.y-f+b.fy}}d=new pv.Quadtree(this.particles);for(b=this.constraints;b;b=b.next)b.apply(this.particles,d);for(b=this.particles;b;b=b.next)b.fx=b.fy=0;for(b=this.forces;b;b=b.next)b.apply(this.particles,d);for(b=this.particles;b;b=b.next)if(b.fixed){b.x=b.px;b.y=b.py}};
pv.Quadtree=function(b){function d(m,n,q,l,p,t){if(m.leaf)if(m.p){if(!(Math.abs(m.p.x-n.x)+Math.abs(m.p.y-n.y)<0.01)){var u=m.p;m.p=null;f(m,u,q,l,p,t)}f(m,n,q,l,p,t)}else m.p=n;else f(m,n,q,l,p,t)}function f(m,n,q,l,p,t){var u=(q+p)*0.5,v=(l+t)*0.5,z=n.x>=u,w=n.y>=v;m.leaf=false;switch((w<<1)+z){case 0:m=m.c1||(m.c1=new pv.Quadtree.Node);break;case 1:m=m.c2||(m.c2=new pv.Quadtree.Node);break;case 2:m=m.c3||(m.c3=new pv.Quadtree.Node);break;case 3:m=m.c4||(m.c4=new pv.Quadtree.Node);break}if(z)q=
u;else p=u;if(w)l=v;else t=v;d(m,n,q,l,p,t)}var g,h=Number.POSITIVE_INFINITY,j=h,i=Number.NEGATIVE_INFINITY,k=i;for(g=b;g;g=g.next){if(g.x<h)h=g.x;if(g.y<j)j=g.y;if(g.x>i)i=g.x;if(g.y>k)k=g.y}g=i-h;var o=k-j;if(g>o)k=j+g;else i=h+o;this.xMin=h;this.yMin=j;this.xMax=i;this.yMax=k;this.root=new pv.Quadtree.Node;for(g=b;g;g=g.next)d(this.root,g,h,j,i,k)};pv.Quadtree.Node=function(){this.leaf=true;this.p=this.c4=this.c3=this.c2=this.c1=this.next=null};pv.Force={};
pv.Force.charge=function(b){function d(m){function n(p){d(p);m.cn+=p.cn;q+=p.cn*p.cx;l+=p.cn*p.cy}var q=0,l=0;m.cn=0;if(!m.leaf){m.c1&&n(m.c1);m.c2&&n(m.c2);m.c3&&n(m.c3);m.c4&&n(m.c4)}if(m.p){m.cn+=b;q+=b*m.p.x;l+=b*m.p.y}m.cx=q/m.cn;m.cy=l/m.cn}function f(m,n,q,l,p,t){var u=m.cx-n.x,v=m.cy-n.y,z=1/Math.sqrt(u*u+v*v);if(m.leaf&&m.p!=n||(p-q)*z<k){if(!(z<i)){if(z>h)z=h;m=m.cn*z*z*z;u=u*m;v=v*m;n.fx+=u;n.fy+=v}}else if(!m.leaf){var w=(q+p)*0.5,s=(l+t)*0.5;m.c1&&f(m.c1,n,q,l,w,s);m.c2&&f(m.c2,n,w,l,
p,s);m.c3&&f(m.c3,n,q,s,w,t);m.c4&&f(m.c4,n,w,s,p,t);if(!(z<i)){if(z>h)z=h;if(m.p&&m.p!=n){m=b*z*z*z;u=u*m;v=v*m;n.fx+=u;n.fy+=v}}}}var g=2,h=1/g,j=500,i=1/j,k=0.9,o={};arguments.length||(b=-40);o.constant=function(m){if(arguments.length){b=Number(m);return o}return b};o.domain=function(m,n){if(arguments.length){g=Number(m);h=1/g;j=Number(n);i=1/j;return o}return[g,j]};o.theta=function(m){if(arguments.length){k=Number(m);return o}return k};o.apply=function(m,n){d(n.root);for(m=m;m;m=m.next)f(n.root,
m,n.xMin,n.yMin,n.xMax,n.yMax)};return o};pv.Force.drag=function(b){var d={};arguments.length||(b=0.1);d.constant=function(f){if(arguments.length){b=f;return d}return b};d.apply=function(f){if(b)for(f=f;f;f=f.next){f.fx=b*(f.fx-f.x+f.px);f.fy=b*(f.fy-f.y+f.py)}};return d};
pv.Force.spring=function(b){var d=0.1,f=20,g,h,j={};arguments.length||(b=0.1);j.links=function(i){if(arguments.length){g=i;h=i.map(function(k){return 1/Math.sqrt(Math.max(k.sourceNode.linkDegree,k.targetNode.linkDegree))});return j}return g};j.constant=function(i){if(arguments.length){b=Number(i);return j}return b};j.damping=function(i){if(arguments.length){d=Number(i);return j}return d};j.length=function(i){if(arguments.length){f=Number(i);return j}return f};j.apply=function(){for(var i=0;i<g.length;i++){var k=
g[i].sourceNode,o=g[i].targetNode,m=k.x-o.x,n=k.y-o.y,q=Math.sqrt(m*m+n*n),l=q?1/q:1;l=(b*h[i]*(q-f)+d*h[i]*(m*(k.vx-o.vx)+n*(k.vy-o.vy))*l)*l;m=-l*(q?m:0.01*(0.5-Math.random()));n=-l*(q?n:0.01*(0.5-Math.random()));k.fx+=m;k.fy+=n;o.fx-=m;o.fy-=n}};return j};pv.Constraint={};
pv.Constraint.collision=function(b){function d(m,n,q,l,p,t){if(!m.leaf){var u=(q+p)*0.5,v=(l+t)*0.5,z=v<k,w=u>h,s=u<i;if(v>j){m.c1&&w&&d(m.c1,n,q,l,u,v);m.c2&&s&&d(m.c2,n,u,l,p,v)}if(z){m.c3&&w&&d(m.c3,n,q,v,u,t);m.c4&&s&&d(m.c4,n,u,v,p,t)}}if(m.p&&m.p!=n){q=n.x-m.p.x;l=n.y-m.p.y;p=Math.sqrt(q*q+l*l);t=g+b(m.p);if(p<t){p=(p-t)/p*0.5;q*=p;l*=p;n.x-=q;n.y-=l;m.p.x+=q;m.p.y+=l}}}var f=1,g,h,j,i,k,o={};arguments.length||(r=10);o.repeat=function(m){if(arguments.length){f=Number(m);return o}return f};o.apply=
function(m,n){var q,l,p=-Infinity;for(q=m;q;q=q.next){l=b(q);if(l>p)p=l}for(var t=0;t<f;t++)for(q=m;q;q=q.next){l=(g=b(q))+p;h=q.x-l;i=q.x+l;j=q.y-l;k=q.y+l;d(n.root,q,n.xMin,n.yMin,n.xMax,n.yMax)}};return o};pv.Constraint.position=function(b){var d=1,f={};if(!arguments.length)b=pv.identity;f.alpha=function(g){if(arguments.length){d=Number(g);return f}return d};f.apply=function(g){for(g=g;g;g=g.next){var h=b(g);g.x+=(h.x-g.x)*d;g.y+=(h.y-g.y)*d}};return f};
pv.Constraint.bound=function(){var b={},d,f;b.x=function(g,h){if(arguments.length){d={min:Math.min(g,h),max:Math.max(g,h)};return this}return d};b.y=function(g,h){if(arguments.length){f={min:Math.min(g,h),max:Math.max(g,h)};return this}return f};b.apply=function(g){if(d)for(var h=g;h;h=h.next)h.x=h.x<d.min?d.min:h.x>d.max?d.max:h.x;if(f)for(h=g;h;h=h.next)h.y=h.y<f.min?f.min:h.y>f.max?f.max:h.y};return b};pv.Layout=function(){pv.Mark.call(this)};pv.Layout.prototype=pv.extend(pv.Mark);
pv.Layout.prototype.property=function(b,d){this.propertyMethod(b,true,d);return this};pv.Layout.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var b=this.binds,d=b.data,f=d.value;b.data={id:d.id,type:d.type|1,value:d.type&1?function(){var g=f.apply(this,arguments);this.init(g);return g}:function(){this.init(f);return f}}};pv.Layout.prototype.init=function(){};
pv.Layout.Network=function(){pv.Layout.call(this);var b=this;this.node=(new pv.Mark).data(function(){return b.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(d){return d.x}).top(function(d){return d.y});this.node.add=function(d){d=b.parent.add(d).extend(this);d.link=b.link;d.node=b.node;d.label=b.label;return d};this.link=(new pv.Mark).extend(this.node).data(function(d){return[d.sourceNode,d.targetNode]}).fillStyle(null).lineWidth(function(d,f){return f.linkValue*1.5}).strokeStyle("rgba(0,0,0,.2)");
this.link.add=function(d){d=b.parent.add(pv.Panel).data(function(){return b.links()}).add(d).extend(this);d.link=b.link;d.node=b.node;d.label=b.label;return d};this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(d){return d.nodeName||d.nodeValue}).textAngle(function(d){d=d.angle;return pv.Wedge.upright(d)?d:d+Math.PI}).textAlign(function(d){return pv.Wedge.upright(d.angle)?"left":"right"});this.label.add=this.node.add};
pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(b){return b.map(function(d,f){if(typeof d!="object")d={nodeValue:d};d.index=f;d.linkDegree=0;return d})}).property("links",function(b){return b.map(function(d){if(isNaN(d.linkValue))d.linkValue=isNaN(d.value)?1:d.value;return d})});pv.Layout.Network.prototype.bind=function(){pv.Layout.prototype.bind.call(this);var b=this.binds,d=b.properties.nodes;if((b=b.properties.links)&&d.id>b.id)b.id=d.id};
pv.Layout.Network.prototype.init=function(){var b=this.scene.defs;if(b.nodes.id)return true;b.links.id=b.nodes.id=pv.id();var d=this.nodes();this.links().forEach(function(f){var g=f.sourceNode||(f.sourceNode=d[f.source]),h=f.targetNode||(f.targetNode=d[f.target]);f=f.linkValue;g.linkDegree+=f;h.linkDegree+=f})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.data=pv.Layout.Hierarchy.prototype.nodes;
pv.Layout.Hierarchy.prototype.bind=function(){pv.Layout.Network.prototype.bind.call(this);var b=this.binds;if(!b.properties.links){var d=this.propertyValue("links",pv.Layout.Hierarchy.links);d.type=1;b.defs.push(d)}};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(b){return b.parentNode}).map(function(b){return{sourceNode:b,targetNode:b.parentNode,linkValue:1}})};
pv.Layout.Hierarchy.NodeLink={init:function(){function b(l){return l.parentNode?l.depth*(m-o)+o:0}function d(l){return j=="radial"?l.parentNode?(l.breadth-0.25)*2*Math.PI:0:0}function f(l){switch(j){case "left":return l.depth*i;case "right":return i-l.depth*i;case "top":return l.breadth*i;case "bottom":return i-l.breadth*i;case "radial":return i/2+b(l)*Math.cos(l.angle)}}function g(l){switch(j){case "left":return l.breadth*k;case "right":return k-l.breadth*k;case "top":return l.depth*k;case "bottom":return k-
l.depth*k;case "radial":return k/2+b(l)*Math.sin(l.angle)}}var h=this.nodes(),j=this.orient(),i=this.parent.width(),k=this.parent.height();if(j=="radial"){var o=this.innerRadius(),m=this.outerRadius();if(o==null)o=0;if(m==null)m=Math.min(i,k)/2}for(var n=0;n<h.length;n++){var q=h[n];q.angle=d(q);q.x=f(q);q.y=g(q);if(q.firstChild)q.angle+=Math.PI}}};
pv.Layout.Hierarchy.Fill={constructor:function(){var b=this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(d){return d.dx}).height(function(d){return d.dy}).innerRadius(function(d){return d.innerRadius}).outerRadius(function(d){return d.outerRadius}).startAngle(function(d){return d.startAngle}).angle(function(d){return d.angle});this.add=function(d){return this.parent.add(d).extend(b)};delete this.node;delete this.label;delete this.link},init:function(){function b(w,s){return(w+s)/(1+s)}
function d(w){switch(n){case "left":return b(w.minDepth,p)*q;case "right":return(1-b(w.maxDepth,p))*q;case "top":return w.minBreadth*q;case "bottom":return(1-w.maxBreadth)*q;case "radial":return q/2}}function f(w){switch(n){case "left":return w.minBreadth*l;case "right":return(1-w.maxBreadth)*l;case "top":return b(w.minDepth,p)*l;case "bottom":return(1-b(w.maxDepth,p))*l;case "radial":return l/2}}function g(w){switch(n){case "left":case "right":return(w.maxDepth-w.minDepth)/(1+p)*q;case "top":case "bottom":return(w.maxBreadth-
w.minBreadth)*q}}function h(w){switch(n){case "left":case "right":return(w.maxBreadth-w.minBreadth)*l;case "top":case "bottom":return(w.maxDepth-w.minDepth)/(1+p)*l}}function j(w){return Math.max(0,b(w.minDepth,p/2))*(u-t)+t}function i(w){return b(w.maxDepth,p/2)*(u-t)+t}function k(w){return(w.parentNode?w.minBreadth-0.25:0)*2*Math.PI}function o(w){return(w.parentNode?w.maxBreadth-w.minBreadth:1)*2*Math.PI}var m=this.nodes(),n=this.orient(),q=this.parent.width(),l=this.parent.height(),p=-m[0].minDepth;
if(n=="radial"){var t=this.innerRadius(),u=this.outerRadius();if(t==null)t=0;if(t)p*=2;if(u==null)u=Math.min(q,l)/2}for(var v=0;v<m.length;v++){var z=m[v];z.x=d(z);z.y=f(z);z.dx=g(z);z.dy=h(z);z.innerRadius=j(z);z.outerRadius=i(z);z.startAngle=k(z);z.angle=o(z)}}};
pv.Layout.Grid=function(){pv.Layout.call(this);var b=this;this.data(function(d){return pv.range(b.rows()*b.cols()).map(function(){return d})});this.propertyMethod("data",false,function(d){b.rows(d.length).cols(d[0]?d[0].length:0);return pv.blend(d)});this.rows(1).cols(1).width(function(){return this.parent.width()/this.cols()}).height(function(){return this.parent.height()/this.rows()}).left(function(){return this.width()*(this.index%this.cols())}).top(function(){return this.height()*Math.floor(this.index/
this.cols())})};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows",Number).property("cols",Number);
pv.Layout.Stack=function(){pv.Layout.call(this);var b=this,d=(new pv.Mark).data(pv.identity).visible(function(){return this.index==b.scene.$stack.max[this.parent.index]}).textBaseline("middle").textAlign("center");this.add=function(f){function g(){return h.parent.scene[this.parent.index].children[0][this.index]}var h=b.parent.add(pv.Panel).extend(b).data(function(){var i=b.scene.$stack.data;b.prebuild(i,this.children[0]);return i}).visible(function(){return b.scene[this.index].visible}).add(f).data(pv.identity),
j=h.bind;h.bind=function(){b.prebind(j,this)};h.label=(new pv.Mark).extend(d).left(function(){var i=g.call(this);return i.left+i.width/2}).bottom(function(){var i=g.call(this);return i.bottom+i.height/2});h.label.add=function(i){return b.parent.add(pv.Panel).data(function(){return b.scene.$stack.data}).add(i).extend(this)};return h}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("order",String).property("offset",String);pv.Layout.Stack.prototype.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom").offset("zero");
pv.Layout.Stack.prototype.init=function(b){this.scene.$stack={data:b}};pv.Layout.Stack.prototype.prebind=function(b,d){var f=d.binds?d.binds.$stack:{};b.call(d);var g={left:1,right:1,top:1,bottom:1,width:1,height:1},h=d.binds.properties;for(var j in g){var i=h[j];if(!i.original){var k=f[j]=d.propertyValue(j,i.value);k.type=i.type;k.original=i.value}}b.call(d);d.binds.$stack=f};
pv.Layout.Stack.prototype.prebuild=function(b,d){var f=this.orient(),g=/^(top|bottom)$/.test(f),h=b.length,j=b[0].length,i=this.parent[g?"height":"width"](),k=[],o=[],m=[],n=[],q=d.parent,l=d.binds.$stack,p=l[g?"height":"width"],t=g?l.left:l.top;f=l[f];if(t.value==null)t=g?l.right:l.bottom;var u=pv.Mark.stack;u.unshift(null);for(g=0;g<h;g++){m[g]=[];o[g]=[];n[g]=this.scene[g].visible;q.index=g;for(l=0;l<j;l++){u[0]=b[g][l];pv.Mark.prototype.index=d.index=l;g||(k[l]=t.original.apply(d,u));m[g][l]=
n[g]?p.original.apply(d,u):0}}delete q.index;delete d.index;u.shift();switch(this.order()){case "inside-out":var v=m.map(function(x){return pv.max.index(x)});d=pv.range(h).sort(function(x,y){return v[x]-v[y]});q=m.map(function(x){return pv.sum(x)});var z=u=0,w=[],s=[];for(g=0;g<h;g++){l=d[g];if(u<z){u+=q[l];w.push(l)}else{z+=q[l];s.push(l)}}d=s.reverse().concat(w);break;case "reverse":d=pv.range(h-1,-1,-1);break;default:d=pv.range(h);break}switch(this.offset()){case "silohouette":for(l=0;l<j;l++){for(g=
n=0;g<h;g++)n+=m[g][l];o[d[0]][l]=(i-n)/2}break;case "wiggle":for(g=n=0;g<h;g++)n+=m[g][0];o[d[0]][0]=n=(i-n)/2;for(l=1;l<j;l++){u=i=0;z=k[l]-k[l-1];for(g=0;g<h;g++)i+=m[g][l];for(g=0;g<h;g++){w=(m[d[g]][l]-m[d[g]][l-1])/(2*z);for(q=0;q<g;q++)w+=(m[d[q]][l]-m[d[q]][l-1])/z;u+=w*m[d[g]][l]}o[d[0]][l]=n-=i?u/i*z:0}break;case "expand":u=pv.sum(n);for(l=0;l<j;l++){for(g=q=o[d[0]][l]=0;g<h;g++)q+=m[g][l];if(q){q=i/q;for(g=0;g<h;g++)m[g][l]*=q}else{q=i/u;for(g=0;g<h;g++)m[g][l]=n[g]?q:0}}break;default:for(l=
0;l<j;l++)o[d[0]][l]=0;break}for(l=0;l<j;l++){n=o[d[0]][l];for(g=1;g<h;g++){n+=m[d[g-1]][l];o[d[g]][l]=n}}this.scene.$stack.max=m.map(function(x){return pv.max.index(x)});t.type=f.type=p.type=3;t.value=function(){return k[this.index]};f.value=function(){return o[this.parent.index][this.index]};p.value=function(){return m[this.parent.index][this.index]};return b};
pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);var b=this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(d){return d.dx}).height(function(d){return d.dy});this.add=function(d){return d.prototype instanceof pv.Layout?this.parent.add(pv.Panel).extend(b).strokeStyle(null).fillStyle(null).visible(function(f){return!f.firstChild}).add(d):this.parent.add(d).extend(b)};delete this.node;delete this.label;delete this.link};
pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.$size=Number;pv.Layout.Treemap.prototype.size=function(b){this.$size=b;return this};
pv.Layout.Treemap.prototype.init=function(){function b(p,t,u,v,z,w,s){for(var x=0,y=0;x<p.length;x++){var A=p[x];if(u){A.x=v+y;A.y=z;y+=A.dx=q(w*A.size/t);A.dy=s}else{A.x=v;A.y=z+y;A.dx=w;y+=A.dy=q(s*A.size/t)}}if(A)if(u)A.dx+=w-y;else A.dy+=s-y}function d(p,t){for(var u=-Infinity,v=Infinity,z=0,w=0;w<p.length;w++){var s=p[w].size;if(s<v)v=s;if(s>u)u=s;z+=s}z*=z;t*=t;return Math.max(t*u/z,z/(t*v))}function f(p,t){function u(B){var E=w==y,G=pv.sum(B,n),F=y?q(G/y):0;b(B,G,E,v,z,E?w:F,E?F:s);if(E){z+=
F;s-=F}else{v+=F;w-=F}y=Math.min(w,s);return E}var v=p.x+i,z=p.y+o,w=p.dx-i-k,s=p.dy-o-m;if(l!="squarify")b(p.childNodes,p.size,l=="slice"?true:l=="dice"?false:t&1,v,z,w,s);else{var x=[];t=Infinity;var y=Math.min(w,s),A=w*s/p.size;if(!(p.size<=0)){p.visitBefore(function(B){B.size*=A});for(p=p.childNodes.slice();p.length;){var C=p[p.length-1];if(C.size){x.push(C);A=d(x,y);if(A<=t){p.pop();t=A}else{x.pop();u(x);x.length=0;t=Infinity}}else p.pop()}if(u(x))for(t=0;t<x.length;t++)x[t].dy+=s;else for(t=
0;t<x.length;t++)x[t].dx+=w}}}var g=this,h=g.nodes()[0],j=pv.Mark.stack,i=g.left(),k=g.right(),o=g.top(),m=g.bottom(),n=function(p){return p.size},q=g.round()?Math.round:Number,l=g.mode();j.unshift(null);h.visitAfter(function(p,t){p.depth=t;p.x=p.y=p.dx=p.dy=0;p.size=p.firstChild?pv.sum(p.childNodes,function(u){return u.size}):g.$size.apply(g,(j[0]=p.nodeValue,j))});j.shift();switch(g.order()){case "ascending":h.sort(function(p,t){return p.size-t.size});break;case "descending":h.sort(function(p,t){return t.size-
p.size});break;case "reverse":h.reverse();break}h.x=0;h.y=0;h.dx=g.parent.width();h.dy=g.parent.height();h.visitBefore(f)};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");
pv.Layout.Tree.prototype.init=function(){function b(s){var x,y,A;if(s.firstChild){x=s.firstChild;y=s.lastChild;for(var C=A=x;C;C=C.nextSibling){b(C);A=f(C,A)}i(s);y=0.5*(x.prelim+y.prelim);if(x=s.previousSibling){s.prelim=x.prelim+o(s.depth,true);s.mod=s.prelim-y}else s.prelim=y}else if(x=s.previousSibling)s.prelim=x.prelim+o(s.depth,true)}function d(s,x,y){s.breadth=s.prelim+x;x+=s.mod;for(s=s.firstChild;s;s=s.nextSibling)d(s,x,y)}function f(s,x){var y=s.previousSibling;if(y){var A=s,C=s,B=y;y=s.parentNode.firstChild;
var E=A.mod,G=C.mod,F=B.mod,J=y.mod;B=h(B);for(A=g(A);B&&A;){B=B;A=A;y=g(y);C=h(C);C.ancestor=s;var I=B.prelim+F-(A.prelim+E)+o(B.depth,false);if(I>0){j(k(B,s,x),s,I);E+=I;G+=I}F+=B.mod;E+=A.mod;J+=y.mod;G+=C.mod;B=h(B);A=g(A)}if(B&&!h(C)){C.thread=B;C.mod+=F-G}if(A&&!g(y)){y.thread=A;y.mod+=E-J;x=s}}return x}function g(s){return s.firstChild||s.thread}function h(s){return s.lastChild||s.thread}function j(s,x,y){var A=x.number-s.number;x.change-=y/A;x.shift+=y;s.change+=y/A;x.prelim+=y;x.mod+=y}function i(s){var x=
0,y=0;for(s=s.lastChild;s;s=s.previousSibling){s.prelim+=x;s.mod+=x;y+=s.change;x+=s.shift+y}}function k(s,x,y){return s.ancestor.parentNode==x.parentNode?s.ancestor:y}function o(s,x){return(x?1:v+1)/(p=="radial"?s:1)}function m(s){return p=="radial"?s.breadth/t:0}function n(s){switch(p){case "left":return s.depth;case "right":return z-s.depth;case "top":case "bottom":return s.breadth+z/2;case "radial":return z/2+s.depth*Math.cos(m(s))}}function q(s){switch(p){case "left":case "right":return s.breadth+
w/2;case "top":return s.depth;case "bottom":return w-s.depth;case "radial":return w/2+s.depth*Math.sin(m(s))}}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var l=this.nodes(),p=this.orient(),t=this.depth(),u=this.breadth(),v=this.group(),z=this.parent.width(),w=this.parent.height();l=l[0];l.visitAfter(function(s,x){s.ancestor=s;s.prelim=0;s.mod=0;s.change=0;s.shift=0;s.number=s.previousSibling?s.previousSibling.number+1:0;s.depth=x});b(l);d(l,-l.prelim,0);l.visitAfter(function(s){s.breadth*=
u;s.depth*=t;s.angle=m(s);s.x=n(s);s.y=q(s);if(s.firstChild)s.angle+=Math.PI;delete s.breadth;delete s.depth;delete s.ancestor;delete s.prelim;delete s.mod;delete s.change;delete s.shift;delete s.number;delete s.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);
pv.Layout.Indent.prototype.init=function(){function b(i,k,o){i.x=h+o++*g;i.y=j+k++*f;i.angle=0;for(i=i.firstChild;i;i=i.nextSibling)k=b(i,k,o);return k}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var d=this.nodes(),f=this.breadth(),g=this.depth(),h=0,j=0;b(d[0],1,1)}};
pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);var b=this.node.radius(function(d){return d.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.add=function(d){return this.parent.add(d).extend(b)};delete this.node;delete this.label;delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");
pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(b){this.$radius=typeof b=="function"?function(){return Math.sqrt(b.apply(this,arguments))}:(b=Math.sqrt(b),function(){return b});return this};
pv.Layout.Pack.prototype.init=function(){function b(l){var p=pv.Mark.stack;p.unshift(null);for(var t=0,u=l.length;t<u;t++){var v=l[t];if(!v.firstChild){p[0]=v.nodeValue;v.radius=j.$radius.apply(j,p)}}p.shift()}function d(l){var p=[];for(l=l.firstChild;l;l=l.nextSibling){if(l.firstChild)l.radius=d(l);l.n=l.p=l;p.push(l)}switch(o){case "ascending":p.sort(function(t,u){return t.radius-u.radius});break;case "descending":p.sort(function(t,u){return u.radius-t.radius});break;case "reverse":p.reverse();
break}return f(p)}function f(l){function p(D){z=Math.min(D.x-D.radius,z);w=Math.max(D.x+D.radius,w);s=Math.min(D.y-D.radius,s);x=Math.max(D.y+D.radius,x)}function t(D,H){var K=D.n;D.n=H;H.p=D;H.n=K;K.p=H}function u(D,H){D.n=H;H.p=D}function v(D,H){var K=H.x-D.x,L=H.y-D.y;D=D.radius+H.radius;return D*D-K*K-L*L>0.001}var z=Infinity,w=-Infinity,s=Infinity,x=-Infinity,y,A,C,B,E;y=l[0];y.x=-y.radius;y.y=0;p(y);if(l.length>1){A=l[1];A.x=A.radius;A.y=0;p(A);if(l.length>2){C=l[2];g(y,A,C);p(C);t(y,C);y.p=
C;t(C,A);A=y.n;for(var G=3;G<l.length;G++){g(y,A,C=l[G]);var F=0,J=1,I=1;for(B=A.n;B!=A;B=B.n,J++)if(v(B,C)){F=1;break}if(F==1)for(E=y.p;E!=B.p;E=E.p,I++)if(v(E,C)){if(I<J){F=-1;B=E}break}if(F==0){t(y,C);A=C;p(C)}else if(F>0){u(y,B);A=B;G--}else if(F<0){u(B,A);y=B;G--}}}}y=(z+w)/2;A=(s+x)/2;for(G=C=0;G<l.length;G++){B=l[G];B.x-=y;B.y-=A;C=Math.max(C,B.radius+Math.sqrt(B.x*B.x+B.y*B.y))}return C+m}function g(l,p,t){var u=p.radius+t.radius,v=l.radius+t.radius,z=p.x-l.x;p=p.y-l.y;var w=Math.sqrt(z*z+
p*p),s=(v*v+w*w-u*u)/(2*v*w);u=Math.acos(s);s=s*v;v=Math.sin(u)*v;z/=w;p/=w;t.x=l.x+s*z+v*p;t.y=l.y+s*p-v*z}function h(l,p,t,u){for(var v=l.firstChild;v;v=v.nextSibling){v.x+=l.x;v.y+=l.y;h(v,p,t,u)}l.x=p+u*l.x;l.y=t+u*l.y;l.radius*=u}if(!pv.Layout.Hierarchy.prototype.init.call(this)){var j=this,i=j.nodes(),k=i[0],o=j.order(),m=j.spacing();b(i);k.x=0;k.y=0;k.radius=d(k);i=this.parent.width();var n=this.parent.height(),q=1/Math.max(2*k.radius/i,2*k.radius/n);h(k,i/2,n/2,q)}};
pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,d){return Math.sqrt(d.linkValue)*1.5})};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number);
pv.Layout.Force.prototype.init=function(){if(!pv.Layout.Network.prototype.init.call(this)){for(var b=this.nodes(),d=this.links(),f=this.parent.width(),g=this.parent.height(),h=f/2,j=g/2,i=0;i<b.length;i++){var k=b[i],o=Math.random()*2*Math.PI;k.x=h+=10*(f/g)*Math.cos(o);k.y=j+=10*(g/f)*Math.sin(o)}var m=pv.simulation(b);m.force(pv.Force.drag());m.force(pv.Force.charge());m.force(pv.Force.spring().links(d));this.bound()&&m.constraint(pv.Constraint.bound().x(6,f-6).y(6,g-6));k=this.iterations();if(k==
null){function n(t){return t.fixed?1:t.vx*t.vx+t.vy*t.vy}m.step();var q=1,l=1.0E-4*(d.length+1),p=this.parent;setInterval(function(){if(q>l){var t=Date.now();do m.step();while(Date.now()-t<20);p.render()}q=pv.max(b,n)},42)}else for(i=0;i<k;i++)m.step()}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var b,d=this.init;this.init=function(){var f=this.orient();b=/^(top|bottom)$/.test(f)?"step-before":/^(left|right)$/.test(f)?"step-after":"linear";d.call(this)};this.link.interpolate(function(){return b})};
pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");
pv.Layout.Cluster.prototype.init=function(){if(!pv.Layout.Hierarchy.prototype.init.call(this)){var b=this.nodes()[0],d=this.group(),f,g,h=0,j=0.5-d/2,i=undefined;b.visitAfter(function(k){if(k.firstChild)k.depth=1+pv.max(k.childNodes,function(o){return o.depth});else{if(d&&i!=k.parentNode){i=k.parentNode;h+=d}h++;k.depth=0}});f=1/h;g=1/b.depth;i=undefined;b.visitAfter(function(k){if(k.firstChild)k.breadth=pv.mean(k.childNodes,function(o){return o.breadth});else{if(d&&i!=k.parentNode){i=k.parentNode;
j+=d}k.breadth=f*j++}k.depth=1-k.depth*g});b.visitAfter(function(k){k.minBreadth=k.firstChild?k.firstChild.minBreadth:k.breadth-f/2;k.maxBreadth=k.firstChild?k.lastChild.maxBreadth:k.breadth+f/2});b.visitBefore(function(k){k.minDepth=k.parentNode?k.parentNode.maxDepth:0;k.maxDepth=k.parentNode?k.depth+b.depth:k.minDepth+2*b.depth});b.minDepth=-g;pv.Layout.Hierarchy.NodeLink.init.call(this)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};
pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.init=function(){pv.Layout.Cluster.prototype.init.call(this)||pv.Layout.Hierarchy.Fill.init.call(this)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");
pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(b){this.$size=b;return this};
pv.Layout.Partition.prototype.init=function(){var b=this,d=b.nodes()[0],f=b.order(),g=pv.Mark.stack,h=0;g.unshift(null);d.visitAfter(function(i,k){if(k>h)h=k;i.size=i.firstChild?pv.sum(i.childNodes,function(o){return o.size}):b.$size.apply(b,(g[0]=i.nodeValue,g))});g.shift();switch(f){case "ascending":d.sort(function(i,k){return i.size-k.size});break;case "descending":d.sort(function(i,k){return k.size-i.size});break}var j=1/h;d.minBreadth=0;d.breadth=0.5;d.maxBreadth=1;d.visitBefore(function(i){for(var k=
i.minBreadth,o=i.maxBreadth-k,m=i.firstChild;m;m=m.nextSibling){m.minBreadth=k;m.maxBreadth=k+=m.size/i.size*o;m.breadth=(k+m.minBreadth)/2}});d.visitAfter(function(i,k){i.minDepth=(k-1)*j;i.maxDepth=i.depth=k*j});pv.Layout.Hierarchy.NodeLink.init.call(this)};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);
pv.Layout.Partition.Fill.prototype.init=function(){pv.Layout.Partition.prototype.init.call(this)||pv.Layout.Hierarchy.Fill.init.call(this)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,d,f,g=this.init;this.init=function(){var h=this.orient();d=this.directed();b=h=="radial"?"linear":"polar";f=h=="right"||h=="top";g.call(this)};this.link.data(function(h){var j=h.sourceNode;h=h.targetNode;return f!=(d||j.index<h.index)?[j,h]:[h,j]}).interpolate(function(){return b})};
pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");
pv.Layout.Arc.prototype.init=function(){function b(q){switch(h){case "top":return-Math.PI/2;case "bottom":return Math.PI/2;case "left":return Math.PI;case "right":return 0;case "radial":return(q-0.25)*2*Math.PI}}function d(q){switch(h){case "top":case "bottom":return q*j;case "left":return 0;case "right":return j;case "radial":return j/2+k*Math.cos(b(q))}}function f(q){switch(h){case "top":return 0;case "bottom":return i;case "left":case "right":return q*i;case "radial":return i/2+k*Math.sin(b(q))}}
if(!pv.Layout.Network.prototype.init.call(this))for(var g=this.nodes(),h=this.orient(),j=this.parent.width(),i=this.parent.height(),k=Math.min(j,i)/2,o=0;o<g.length;o++){var m=(o+0.5)/g.length,n=g[o];n.x=d(m);n.y=f(m);n.angle=b(m)}};
pv.Layout.Horizon=function(){function b(){d=this.mode();f=Math.round((d=="color"?0.5:1)*this.parent.height());var i=this.bands(),k=this.backgroundStyle();g=pv.Scale.linear(0,i).range(k,this.negativeStyle());h=pv.Scale.linear(0,i).range(k,this.positiveStyle());return pv.range(i*2)}pv.Layout.call(this);var d,f,g,h;this.propertyValue("fillStyle",function(i){return i?null:this.backgroundStyle()}).type=3;this.bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728").data(b).overflow("hidden").height(function(){return f}).top(function(i){return d==
"color"?(i&1)*f:0});this.band=(new pv.Mark).top(function(i,k){return d=="mirror"&&k&1?(k+1>>1)*f:null}).bottom(function(i,k){return d=="mirror"?k&1?null:(k+1>>1)*-f:(k&1||-1)*(k+1>>1)*f}).fillStyle(function(i,k){return(k&1?g:h)((k>>1)+1)});var j=this.add;this.add=function(i){return j.call(this,pv.Panel).add(i).extend(this.band)}};
pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("negativeStyle",pv.color).property("positiveStyle",pv.color);pv.Layout.Horizon.prototype.fillStyle=pv.Layout.Horizon.prototype.backgroundStyle;
pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var b=this;this.data(function(){return b.nodes()});this.node.data(function(){return b.scene.$rollup.nodes}).size(function(f){return f.nodes.length*20});var d=this.link.add;this.link.interpolate("polar").eccentricity(0.8).add=function(f){f=d.call(this,f);f.parent.data(function(){return b.scene.$rollup.links});return f}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);
pv.Layout.Rollup.prototype.init=function(){pv.Layout.Network.prototype.init.call(this)||delete this.scene.$rollup};
pv.Layout.Rollup.prototype.build=function(){function b(q){return d[q].left+","+d[q].top}pv.Layout.Network.prototype.build.call(this);if(!this.scene.$rollup){for(var d=this.scene,f=this.nodes(),g=this.links(),h=this.directed(),j=0,i={},k={},o=0;o<f.length;o++){var m=b(o),n=i[m];if(!n){n=i[m]=pv.extend(f[o]);n.index=j++;n.x=d[o].left;n.y=d[o].top;n.nodes=[]}n.nodes.push(f[o])}for(o=0;o<g.length;o++){j=g[o].targetNode;f=i[b(g[o].sourceNode.index)];j=i[b(j.index)];m=!h&&f.index>j.index?j.index+","+f.index:
f.index+","+j.index;(n=k[m])||(n=k[m]={sourceNode:f,targetNode:j,linkValue:0,links:[]});n.links.push(g[o]);n.linkValue+=g[o].linkValue}this.scene.$rollup={nodes:pv.values(i),links:pv.values(k)}}};
pv.Layout.Matrix=function(){function b(){return d.scene.$matrix}pv.Layout.Network.call(this);var d=this;this.link.data(function(){return b().pairs}).left(function(){return b().dx*(this.index%b().n)}).top(function(){return b().dy*Math.floor(this.index/b().n)}).width(function(){return b().dx}).height(function(){return b().dy}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(f){return f.linkValue?"#555":"#eee"});this.link.add=this.node.add;this.label.data(function(){return b().labels}).left(function(){return this.index&
1?b().dx*((this.index>>1)+0.5):null}).top(function(){return this.index&1?null:b().dy*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0}).textBaseline("middle");delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(b){this.$sort=b;return this};
pv.Layout.Matrix.prototype.init=function(){if(!pv.Layout.Network.prototype.init.call(this)){var b=this.nodes(),d=this.links(),f=this.directed(),g=this.$sort,h=b.length,j=pv.range(h),i=this.scene.$matrix={n:h,dx:this.parent.width()/h,dy:this.parent.height()/h,labels:[],pairs:[]},k={};g&&j.sort(function(l,p){return g(b[l],b[p])});for(var o=0;o<h;o++)for(var m=0;m<h;m++){var n=j[o],q=j[m];i.pairs.push(k[n+"."+q]={row:o,col:m,sourceNode:b[n],targetNode:b[q],linkValue:0})}for(o=0;o<h;o++){n=j[o];i.labels.push(b[n],
b[n])}for(o=0;o<d.length;o++){i=d[o];h=i.sourceNode.index;j=i.targetNode.index;i=i.linkValue;k[h+"."+j].linkValue+=i;f||(k[j+"."+h].linkValue+=i)}}};pv.Behavior={};
pv.Behavior.drag=function(){function b(k){h=this.index;g=this.scene;var o=this.mouse();i=pv.vector(k.x,k.y).minus(o);j=k;j.fixed=true}function d(){g&&g.mark.context(g,h,function(){var k=this.mouse();j.x=i.x+k.x;j.y=i.y+k.y})}function f(){if(g){d();j.fixed=false;g=j=null}}var g,h,j,i;pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",f);return b};
pv.Behavior.point=function(b){function d(m,n){m=m[n];n={cost:Infinity};for(var q=0,l=m.children.length;q<l;q++){var p=m.children[q],t=p.mark,u;if(t.type=="panel"){t.scene=p;for(var v=0,z=p.length;v<z;v++){t.index=v;u=d(p,v);if(u.cost<n.cost)n=u}delete t.scene;delete t.index}else if(t.$handlers.point){t=t.mouse();v=0;for(z=p.length;v<z;v++){var w=p[v];u=t.x-w.left;w=t.y-w.top;var s=i*u*u+k*w*w;if(s<n.cost){n.distance=u*u+w*w;n.cost=s;n.scene=p;n.index=v}}}}return n}function f(){var m=d(this.scene,
this.index);if(m.cost==Infinity||m.distance>o)m=null;if(h){if(m&&h.scene==m.scene&&h.index==m.index)return;pv.Mark.dispatch("unpoint",h.scene,h.index)}if(h=m){pv.Mark.dispatch("point",m.scene,m.index);pv.listen(this.root.canvas(),"mouseout",g)}}function g(m){if(h&&!pv.ancestor(this,m.relatedTarget)){pv.Mark.dispatch("unpoint",h.scene,h.index);h=null}}var h,j=null,i=1,k=1,o=arguments.length?b*b:900;f.collapse=function(m){if(arguments.length){j=String(m);switch(j){case "y":i=1;k=0;break;case "x":i=
0;k=1;break;default:k=i=1;break}return f}return j};return f};
pv.Behavior.select=function(b){function d(){var q=j,l=o,p=k;do{q.index=p;q.scene=l;p=l.parentIndex;l=l.parent}while(q=q.parent)}function f(){j=this;k=j.index;o=j.scene;i=this.mouse();n={};n.left=i.x;n.top=i.y;n.right=j.width()-i.x;n.bottom=j.height()-i.y;n.width=0;n.height=0;m=Array.prototype.concat.apply([n],arguments);b.apply(this,m)}function g(){if(j){d();var q=j.mouse();n.left=Math.max(0,Math.min(i.x,q.x));n.top=Math.max(0,Math.min(i.y,q.y));n.right=Math.max(0,j.width()-Math.max(i.x,q.x));n.bottom=
Math.max(0,j.height()-Math.max(i.y,q.y));n.width=Math.max(0,j.width()-n.left-n.right);n.height=Math.max(0,j.height()-n.top-n.bottom);b.apply(j,m)}}function h(){g();j=null}var j,i,k,o,m,n;pv.listen(window,"mousemove",g);pv.listen(window,"mouseup",h);return f};
pv.Behavior.pan=function(){function b(){h=this.index;g=this.scene;i=pv.vector(pv.event.pageX,pv.event.pageY);j=this.transform();k=1/(j.k*this.scale)}function d(){g&&g.mark.context(g,h,function(){this.transform(j.translate((pv.event.pageX-i.x)*k,(pv.event.pageY-i.y)*k)).render()})}function f(){d();g=null}var g,h,j,i,k;pv.listen(window,"mousemove",d);pv.listen(window,"mouseup",f);return b};
pv.Behavior.zoom=function(b){arguments.length||(b=1/48);return function(){var d=this.mouse(),f=pv.event.wheel*b;this.transform(this.transform().translate(d.x,d.y).scale(f<0?1E3/(1E3-f):(1E3+f)/1E3).translate(-d.x,-d.y)).render()}};pv.Geo=function(){};
pv.Geo.projections={mercator:{project:function(b){return{x:b.lng/180,y:b.lat>85?1:b.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(b.lat)/2))/Math.PI}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(2*Math.atan(Math.exp(b.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(b){return{x:b.lng/180,y:Math.sin(pv.radians(b.lat))}},invert:function(b){return{lng:b.x*180,lat:pv.degrees(Math.asin(b.y))}}},sinusoidal:{project:function(b){return{x:pv.radians(b.lng)*Math.cos(pv.radians(b.lat))/
Math.PI,y:b.lat/90}},invert:function(b){return{lng:pv.degrees(b.x*Math.PI/Math.cos(b.y*Math.PI/2)),lat:b.y*90}}},aitoff:{project:function(b){var d=pv.radians(b.lng);b=pv.radians(b.lat);var f=Math.acos(Math.cos(b)*Math.cos(d/2));return{x:2*(f?Math.cos(b)*Math.sin(d/2)*f/Math.sin(f):0)/Math.PI,y:2*(f?Math.sin(b)*f/Math.sin(f):0)/Math.PI}},invert:function(b){var d=b.y*Math.PI/2;return{lng:pv.degrees(b.x*Math.PI/2/Math.cos(d)),lat:pv.degrees(d)}}},hammer:{project:function(b){var d=pv.radians(b.lng);b=
pv.radians(b.lat);var f=Math.sqrt(1+Math.cos(b)*Math.cos(d/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(d/2)/f/3,y:Math.SQRT2*Math.sin(b)/f/1.5}},invert:function(b){var d=b.x*3;b=b.y*1.5;var f=Math.sqrt(1-d*d/16-b*b/4);return{lng:pv.degrees(2*Math.atan2(f*d,2*(2*f*f-1))),lat:pv.degrees(Math.asin(f*b))}}},identity:{project:function(b){return{x:b.lng/180,y:b.lat/90}},invert:function(b){return{lng:b.x*180,lat:b.y*90}}}};
pv.Geo.scale=function(b){function d(n){if(!o||n.lng!=o.lng||n.lat!=o.lat){o=n;n=j.project(n);m={x:i(n.x),y:k(n.y)}}return m}var f={x:0,y:0},g={x:1,y:1},h=[],j=pv.Geo.projections.identity,i=pv.Scale.linear(-1,1).range(0,1),k=pv.Scale.linear(-1,1).range(1,0),o,m;d.x=function(n){return d(n).x};d.y=function(n){return d(n).y};d.ticks={lng:function(n){var q;if(h.length>1){var l=pv.Scale.linear();if(n==undefined)n=10;q=l.domain(h,function(p){return p.lat}).ticks(n);n=l.domain(h,function(p){return p.lng}).ticks(n)}else{q=
pv.range(-80,81,10);n=pv.range(-180,181,10)}return n.map(function(p){return q.map(function(t){return{lat:t,lng:p}})})},lat:function(n){return pv.transpose(d.ticks.lng(n))}};d.invert=function(n){return j.invert({x:i.invert(n.x),y:k.invert(n.y)})};d.domain=function(n,q){if(arguments.length){h=n instanceof Array?arguments.length>1?pv.map(n,q):n:Array.prototype.slice.call(arguments);if(h.length>1){var l=h.map(j.project);i.domain(l,function(p){return p.x});k.domain(l,function(p){return p.y})}else{i.domain(-1,
1);k.domain(-1,1)}o=null;return this}return h};d.range=function(n,q){if(arguments.length){if(typeof n=="object"){f={x:Number(n.x),y:Number(n.y)};g={x:Number(q.x),y:Number(q.y)}}else{f={x:0,y:0};g={x:Number(n),y:Number(q)}}i.range(f.x,g.x);k.range(g.y,f.y);o=null;return this}return[f,g]};d.projection=function(n){if(arguments.length){j=typeof n=="string"?pv.Geo.projections[n]||pv.Geo.projections.identity:n;return this.domain(h)}return proj};d.by=function(n){function q(){return d(n.apply(this,arguments))}
for(var l in d)q[l]=d[l];return q};arguments.length&&d.projection(b);return d};pv.listen(window,"load",function(){for(pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.i<pv.$.x.length;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis")try{window.eval(pv.parse(pv.$.s.text))}catch(b){pv.error(b)}}delete pv.$});
