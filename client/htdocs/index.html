<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/reset-min.css">
        <link rel="stylesheet" type="text/css" href="css/r-node-ui.css">
        <link rel="stylesheet" href="js/jquery/fancybox/jquery.fancybox-1.3.1.css" type="text/css" media="screen">
        <link rel="stylesheet" type="text/css" href="js/jquery/jcarousel/lib/jquery.jcarousel.css" />
        <link rel="stylesheet" type="text/css" href="js/jquery/jcarousel/skins/tango/skin.css" />

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
        <script type="text/javascript" src="http://localhost/protovis-v3.2/protovis-d3.2.js"></script>
        <script type="text/javascript" src="js/jquery/fancybox/jquery.fancybox-1.3.1.js"></script>
        <script type="text/javascript" src="js/jquery/jcarousel/lib/jquery.jcarousel.pack.js"></script>
        <script type="text/javascript" src="js/shared/display-r.js"></script>
        <script type="text/javascript" src="js/shared/parser.js"></script>
        <script type="text/javascript" src="js/shared/graphs.js"></script>
        <title>R</title>
    </head>
    <body>
        <div id="outerHolder">
            <div id="banner"></div>
            <div id="console"></div>
            <div id="entrydiv">
                <input id="entryfield" type="text" />
            </div>
            <div id="plot" style="display: none; height: 400; width: 800; overflow:none"></div>

            <script type="text/javascript">

                function doPlot (plotter, data) {
                    plotter.plot ("plot", data);
                    $('#plot').trigger('click');
                }

                var rParser = new rnode.R.Parser();
                var rDisplay = new rnode.R.Display().setPlotter(doPlot);
                var myCarousel = null;

                function addToConsole(t, isResponse) {
                    $('#console').append ("<pre class='" + (isResponse ? "r-response" : "r-request") + "'>" + t + "</pre>");
                }

                function queryR(s) {
                    var x = rParser.parse (s);
                    $.ajax({
                        url: "/R/" + encodeURIComponent(x),
                        success: function (data) {
                            var results = $.parseJSON(data);
                            addToConsole(rDisplay.display(results), true);
                            $("#console").attr({ scrollTop: $("#console").attr("scrollHeight") });
                        }
                    });
                }
                $(document).ready(function() {
                    $('#entryfield').focus();



                    $.ajax({
                        url: "/blurb",
                        success: function (data) {
                            addToConsole (data);
                        }
                    });

                    $('#entryfield').change(function () {
                        var q = $(this).val();
                        addToConsole("> " + q, false);
                        queryR(q);
                        $(this).val('');
                    });

                    $("#plot").fancybox({
                        'scrolling': 'no',
                        'titleShow': false,
                        'onClosed': function () {
                            $('#plot').html('');
                            console.log ($('#graph-carousel').jcarousel());
                        }
                    });

                    myCarousel = $('#graph-carousel').jcarousel({ });
                });
            </script>
        </div>
        <ul id="graph-carousel">

        </ul>
        <script>
        </script>
    </body>
</html>
